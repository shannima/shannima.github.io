

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="使用docker单机部署fabric网络，比之前二进制部署更便捷，推荐使用。">
  <meta name="author" content="Shannima">
  <meta name="keywords" content="">
  <meta name="description" content="使用docker单机部署fabric网络，比之前二进制部署更便捷，推荐使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="docker单机部署生产网络">
<meta property="og:url" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/index.html">
<meta property="og:site_name" content="Moindy&#39;Blog">
<meta property="og:description" content="使用docker单机部署fabric网络，比之前二进制部署更便捷，推荐使用。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220413192101096.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200455760.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200524124.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201129927.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201530947.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201548190.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201853548.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201925263.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202612838.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202836601.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407203900445.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407204001783.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407205722777.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210112843.png">
<meta property="og:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210136865.png">
<meta property="article:published_time" content="2022-04-13T14:06:16.000Z">
<meta property="article:modified_time" content="2022-04-13T12:16:46.582Z">
<meta property="article:author" content="Shannima">
<meta property="article:tag" content="chaincode">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220413192101096.png">
  
  <title>docker单机部署生产网络 - Moindy&#39;Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="//source/css/mac.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"099cc08191e54f6c390011944cda9157","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Moindy&#39;Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="docker单机部署生产网络">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-04-13 22:06" pubdate>
        2022年4月13日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      61k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      189 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">docker单机部署生产网络</h1>
            
            <div class="markdown-body">
              <h3 id="hyperledger-fabric-Docker方式部署多机环境"><a href="#hyperledger-fabric-Docker方式部署多机环境" class="headerlink" title="hyperledger fabric Docker方式部署多机环境"></a>hyperledger fabric Docker方式部署多机环境</h3><h4 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h4><p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220413192101096.png" srcset="/img/loading.gif" lazyload alt="网络拓扑图"></p>
<p>因为是单机部署所以统一使用一个ip</p>
<table>
<thead>
<tr>
<th>节点</th>
<th>宿主机 IP</th>
<th>hosts</th>
<th>端口</th>
</tr>
</thead>
<tbody><tr>
<td>cli</td>
<td>192.168.177.128</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>orderer0</td>
<td>192.168.177.128</td>
<td>orderer0.example.com</td>
<td>7050</td>
</tr>
<tr>
<td>orderer1</td>
<td>192.168.177.128</td>
<td>orderer1.example.com</td>
<td>8050</td>
</tr>
<tr>
<td>orderer2</td>
<td>192.168.177.128</td>
<td>orderer2.example.com</td>
<td>9050</td>
</tr>
<tr>
<td>org1-peer0</td>
<td>192.168.177.128</td>
<td>peer0.org1.example.com</td>
<td>7051</td>
</tr>
<tr>
<td>org1-peer1</td>
<td>192.168.177.128</td>
<td>peer1.org1.example.com</td>
<td>8051</td>
</tr>
<tr>
<td>org2-peer0</td>
<td>192.168.177.128</td>
<td>peer0.org2.example.com90</td>
<td>9051</td>
</tr>
<tr>
<td>org2-peer1</td>
<td>192.168.177.128</td>
<td>peer1.org2.example.com</td>
<td>10051</td>
</tr>
</tbody></table>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">vim /etc/hosts<br><br>#hosts文件中新增每个DNS解析的ip<br><span class="hljs-number">192.168.177.128</span>	orderer0.example.com<br><span class="hljs-number">192.168.177.128</span>	orderer1.example.com<br><span class="hljs-number">192.168.177.128</span>	orderer2.example.com<br><br><span class="hljs-number">192.168.177.128</span>	peer0.org1.example.com<br><span class="hljs-number">192.168.177.128</span>	peer1.org1.example.com<br><span class="hljs-number">192.168.177.128</span>	peer0.org2.example.com<br><span class="hljs-number">192.168.177.128</span>	peer1.org2.example.com<br></code></pre></td></tr></table></figure>

<p>首先需要使用fabric中的cryptogen generate生成组织身份文件(msp,tls,ca证书等文件)并保存在crypto-config文件夹中</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">./cryptogen <span class="hljs-keyword">generate</span> --<span class="hljs-keyword">config</span>=../crypto-<span class="hljs-keyword">config</span><span class="hljs-variable">.yaml</span> --<span class="hljs-keyword">output</span> ../crypto-<span class="hljs-keyword">config</span><br></code></pre></td></tr></table></figure>

<p>crypto-config.yaml配置文件如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-comment"># &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes</span><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-attr">OrdererOrgs:</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Orderer</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Orderer</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Specs&quot; - See PeerOrgs below for complete description</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Specs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer0</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">Hostname:</span> <span class="hljs-string">orderer2</span><br>        <span class="hljs-attr">SANS:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-comment"># &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes</span><br><span class="hljs-comment"># ---------------------------------------------------------------------------</span><br><span class="hljs-attr">PeerOrgs:</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Org1</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Org1</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">org1.example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;CA&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Uncomment this section to enable the explicit definition of the CA for this</span><br>    <span class="hljs-comment"># organization.  This entry is a Spec.  See &quot;Specs&quot; section below for details.</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># CA:</span><br>    <span class="hljs-comment">#    Hostname: ca # implicitly ca.org1.example.com</span><br>    <span class="hljs-comment">#    Country: US</span><br>    <span class="hljs-comment">#    Province: California</span><br>    <span class="hljs-comment">#    Locality: San Francisco</span><br>    <span class="hljs-comment">#    OrganizationalUnit: Hyperledger Fabric</span><br>    <span class="hljs-comment">#    StreetAddress: address for org # default nil</span><br>    <span class="hljs-comment">#    PostalCode: postalCode for org # default nil</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Specs&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Uncomment this section to enable the explicit definition of hosts in your</span><br>    <span class="hljs-comment"># configuration.  Most users will want to use Template, below</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Specs is an array of Spec entries.  Each Spec entry consists of two fields:</span><br>    <span class="hljs-comment">#   - Hostname:   (Required) The desired hostname, sans the domain.</span><br>    <span class="hljs-comment">#   - CommonName: (Optional) Specifies the template or explicit override for</span><br>    <span class="hljs-comment">#                 the CN.  By default, this is the template:</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#                              &quot;&#123;&#123;.Hostname&#125;&#125;.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#                 which obtains its values from the Spec.Hostname and</span><br>    <span class="hljs-comment">#                 Org.Domain, respectively.</span><br>    <span class="hljs-comment">#   - SANS:       (Optional) Specifies one or more Subject Alternative Names</span><br>    <span class="hljs-comment">#                 to be set in the resulting x509. Accepts template</span><br>    <span class="hljs-comment">#                 variables &#123;&#123;.Hostname&#125;&#125;, &#123;&#123;.Domain&#125;&#125;, &#123;&#123;.CommonName&#125;&#125;. IP</span><br>    <span class="hljs-comment">#                 addresses provided here will be properly recognized. Other</span><br>    <span class="hljs-comment">#                 values will be taken as DNS names.</span><br>    <span class="hljs-comment">#                 <span class="hljs-doctag">NOTE:</span> Two implicit entries are created for you:</span><br>    <span class="hljs-comment">#                     - &#123;&#123; .CommonName &#125;&#125;</span><br>    <span class="hljs-comment">#                     - &#123;&#123; .Hostname &#125;&#125;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Specs:</span><br>    <span class="hljs-comment">#   - Hostname: foo # implicitly &quot;foo.org1.example.com&quot;</span><br>    <span class="hljs-comment">#     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above</span><br>    <span class="hljs-comment">#     SANS:</span><br>    <span class="hljs-comment">#       - &quot;bar.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#       - &quot;altfoo.&#123;&#123;.Domain&#125;&#125;&quot;</span><br>    <span class="hljs-comment">#       - &quot;&#123;&#123;.Hostname&#125;&#125;.org6.net&quot;</span><br>    <span class="hljs-comment">#       - 172.16.10.31</span><br>    <span class="hljs-comment">#   - Hostname: bar</span><br>    <span class="hljs-comment">#   - Hostname: baz</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Template&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Allows for the definition of 1 or more hosts that are created sequentially</span><br>    <span class="hljs-comment"># from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1.</span><br>    <span class="hljs-comment"># You may override the number of nodes (Count), the starting index (Start)</span><br>    <span class="hljs-comment"># or the template used to construct the name (Hostname).</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> Template and Specs are not mutually exclusive.  You may define both</span><br>    <span class="hljs-comment"># sections and the aggregate nodes will be created for you.  Take care with</span><br>    <span class="hljs-comment"># name collisions</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Template:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># Start: 5</span><br>      <span class="hljs-comment"># Hostname: &#123;&#123;.Prefix&#125;&#125;&#123;&#123;.Index&#125;&#125; # default</span><br>      <span class="hljs-attr">SANS:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># &quot;Users&quot;</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-comment"># Count: The number of user accounts _in addition_ to Admin</span><br>    <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>    <span class="hljs-attr">Users:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-comment"># Org2: See &quot;Org1&quot; for full specification</span><br>  <span class="hljs-comment"># ---------------------------------------------------------------------------</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">Org2</span><br>    <span class="hljs-attr">Domain:</span> <span class="hljs-string">org2.example.com</span><br>    <span class="hljs-attr">EnableNodeOUs:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">Template:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">SANS:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*&quot;</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.177.128&quot;</span><br>    <span class="hljs-attr">Users:</span><br>      <span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>使用configtxgen工具生成初始区块，这个工具会依赖crypto-config/configtx.yaml文件,其中需要根据环境本身修改一些证书存放的路径以及一些地址</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   ORGANIZATIONS</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the organizational identities that can be referenced</span><br><span class="hljs-comment">#   in the configuration profiles.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># SampleOrg defines an MSP using the sampleconfig. It should never be used</span><br>    <span class="hljs-comment"># in production but may be used as a template for other definitions.</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;OrdererOrg</span><br>        <span class="hljs-comment"># Name is the key by which this org will be referenced in channel</span><br>        <span class="hljs-comment"># configuration transactions.</span><br>        <span class="hljs-comment"># Name can include alphanumeric characters as well as dots and dashes.</span><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">OrdererOrg</span><br><br>        <span class="hljs-comment"># SkipAsForeign can be set to true for org definitions which are to be</span><br>        <span class="hljs-comment"># inherited from the orderer system channel during channel creation.  This</span><br>        <span class="hljs-comment"># is especially useful when an admin of a single org without access to the</span><br>        <span class="hljs-comment"># MSP directories of the other orgs wishes to create a channel.  Note</span><br>        <span class="hljs-comment"># this property must always be set to false for orgs included in block</span><br>        <span class="hljs-comment"># creation.</span><br>        <span class="hljs-attr">SkipAsForeign:</span> <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment"># ID is the key by which this org&#x27;s MSP definition will be referenced.</span><br>        <span class="hljs-comment"># ID can include alphanumeric characters as well as dots and dashes.</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">OrdererMSP</span><br><br>        <span class="hljs-comment"># MSPDir is the filesystem path which contains the MSP configuration.</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/msp</span><br><br>        <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>        <span class="hljs-comment"># For organization policies, their canonical path is usually</span><br>        <span class="hljs-comment">#   /Channel/&lt;Application|Orderer&gt;/&lt;OrgName&gt;/&lt;PolicyName&gt;</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br>                <span class="hljs-comment"># If your MSP is configured with the new NodeOUs, you might</span><br>                <span class="hljs-comment"># want to use a more specific rule like the following:</span><br>                <span class="hljs-comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.peer&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br>                <span class="hljs-comment"># If your MSP is configured with the new NodeOUs, you might</span><br>                <span class="hljs-comment"># want to use a more specific rule like the following:</span><br>                <span class="hljs-comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;OrdererMSP.member&#x27;)&quot;</span><br><br>        <span class="hljs-comment"># OrdererEndpoints is a list of all orderers this org runs which clients</span><br>        <span class="hljs-comment"># and peers may to connect to to push transactions and receive blocks respectively.</span><br>        <span class="hljs-attr">OrdererEndpoints:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer0.example.com:7050&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer1.example.com:8050&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer2.example.com:9050&quot;</span><br><br>        <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used for</span><br>        <span class="hljs-comment"># cross-org gossip communication.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> this value should only be set when using the deprecated</span><br>        <span class="hljs-comment"># `configtxgen --outputAnchorPeersUpdate` command. It is recommended</span><br>        <span class="hljs-comment"># to instead use the channel configuration update process to set the</span><br>        <span class="hljs-comment"># anchor peers for each organization.</span><br>        <span class="hljs-comment"># AnchorPeers:</span><br>        <span class="hljs-comment">#     - Host: 127.0.0.1</span><br>        <span class="hljs-comment">#       Port: 7051</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;Org1</span><br><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">Org1MSP</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">Org1MSP</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/peerOrganizations/org1.example.com/msp</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.peer&#x27;, &#x27;Org1MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;, &#x27;Org1MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org1MSP.peer&#x27;)&quot;</span><br>        <span class="hljs-attr">AnchorPeers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">peer0.org1.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">7051</span><br><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-meta">&amp;Org2</span><br><br>        <span class="hljs-attr">Name:</span> <span class="hljs-string">Org2MSP</span><br>        <span class="hljs-attr">ID:</span> <span class="hljs-string">Org2MSP</span><br>        <span class="hljs-attr">MSPDir:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/peerOrganizations/org2.example.com/msp</span><br>        <span class="hljs-attr">Policies:</span><br>            <span class="hljs-attr">Readers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.peer&#x27;, &#x27;Org2MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Writers:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;, &#x27;Org2MSP.client&#x27;)&quot;</span><br>            <span class="hljs-attr">Admins:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.admin&#x27;)&quot;</span><br>            <span class="hljs-attr">Endorsement:</span><br>                <span class="hljs-attr">Type:</span> <span class="hljs-string">Signature</span><br>                <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;OR(&#x27;Org2MSP.peer&#x27;)&quot;</span><br>        <span class="hljs-attr">AnchorPeers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">peer0.org2.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">9051</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   CAPABILITIES</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the capabilities of fabric network. This is a new</span><br><span class="hljs-comment">#   concept as of v1.1.0 and should not be utilized in mixed networks with</span><br><span class="hljs-comment">#   v1.0.x peers and orderers.  Capabilities define features which must be</span><br><span class="hljs-comment">#   present in a fabric binary for that binary to safely participate in the</span><br><span class="hljs-comment">#   fabric network.  For instance, if a new MSP type is added, newer binaries</span><br><span class="hljs-comment">#   might recognize and validate the signatures from this type, while older</span><br><span class="hljs-comment">#   binaries without this support would be unable to validate those</span><br><span class="hljs-comment">#   transactions.  This could lead to different versions of the fabric binaries</span><br><span class="hljs-comment">#   having different world states.  Instead, defining a capability for a channel</span><br><span class="hljs-comment">#   informs those binaries without this capability that they must cease</span><br><span class="hljs-comment">#   processing transactions until they have been upgraded.  For v1.0.x if any</span><br><span class="hljs-comment">#   capabilities are defined (including a map with all capabilities turned off)</span><br><span class="hljs-comment">#   then the v1.0.x peer will deliberately crash.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Capabilities:</span><br>    <span class="hljs-comment"># Channel capabilities apply to both the orderers and the peers and must be</span><br>    <span class="hljs-comment"># supported by both.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Channel:</span> <span class="hljs-meta">&amp;ChannelCapabilities</span><br>        <span class="hljs-comment"># V2.0 for Channel is a catchall flag for behavior which has been</span><br>        <span class="hljs-comment"># determined to be desired for all orderers and peers running at the v2.0.0</span><br>        <span class="hljs-comment"># level, but which would be incompatible with orderers and peers from</span><br>        <span class="hljs-comment"># prior releases.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 channel capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers and peers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># Orderer capabilities apply only to the orderers, and may be safely</span><br>    <span class="hljs-comment"># used with prior release peers.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Orderer:</span> <span class="hljs-meta">&amp;OrdererCapabilities</span><br>        <span class="hljs-comment"># V1.1 for Orderer is a catchall flag for behavior which has been</span><br>        <span class="hljs-comment"># determined to be desired for all orderers running at the v1.1.x</span><br>        <span class="hljs-comment"># level, but which would be incompatible with orderers from prior releases.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 orderer capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># Application capabilities apply only to the peer network, and may be safely</span><br>    <span class="hljs-comment"># used with prior release orderers.</span><br>    <span class="hljs-comment"># Set the value of the capability to true to require it.</span><br>    <span class="hljs-attr">Application:</span> <span class="hljs-meta">&amp;ApplicationCapabilities</span><br>        <span class="hljs-comment"># V2.0 for Application enables the new non-backwards compatible</span><br>        <span class="hljs-comment"># features and fixes of fabric v2.0.</span><br>        <span class="hljs-comment"># Prior to enabling V2.0 orderer capabilities, ensure that all</span><br>        <span class="hljs-comment"># orderers on a channel are at v2.0.0 or later.</span><br>        <span class="hljs-attr">V2_0:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   APPLICATION</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for application-related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Application:</span> <span class="hljs-meta">&amp;ApplicationDefaults</span><br>    <span class="hljs-attr">ACLs:</span> <span class="hljs-meta">&amp;ACLsDefault</span><br>        <span class="hljs-comment"># This section provides defaults for policies for various resources</span><br>        <span class="hljs-comment"># in the system. These &quot;resources&quot; could be functions on system chaincodes</span><br>        <span class="hljs-comment"># (e.g., &quot;GetBlockByNumber&quot; on the &quot;qscc&quot; system chaincode) or other resources</span><br>        <span class="hljs-comment"># (e.g.,who can receive Block events). This section does NOT specify the resource&#x27;s</span><br>        <span class="hljs-comment"># definition or API, but just the ACL policy for it.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Users can override these defaults with their own policy mapping by defining the</span><br>        <span class="hljs-comment"># mapping under ACLs in their channel definition</span><br><br>        <span class="hljs-comment">#---New Lifecycle System Chaincode (_lifecycle) function to policy mapping for access control--#</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;CheckCommitReadiness&quot; function</span><br>        <span class="hljs-attr">_lifecycle/CheckCommitReadiness:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;CommitChaincodeDefinition&quot; function</span><br>        <span class="hljs-attr">_lifecycle/CommitChaincodeDefinition:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinition&quot; function</span><br>        <span class="hljs-attr">_lifecycle/QueryChaincodeDefinition:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinitions&quot; function</span><br>        <span class="hljs-attr">_lifecycle/QueryChaincodeDefinitions:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment">#---Lifecycle System Chaincode (lscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getid&quot; function</span><br>        <span class="hljs-attr">lscc/ChaincodeExists:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getdepspec&quot; function</span><br>        <span class="hljs-attr">lscc/GetDeploymentSpec:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for lscc&#x27;s &quot;getccdata&quot; function</span><br>        <span class="hljs-attr">lscc/GetChaincodeData:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL Policy for lscc&#x27;s &quot;getchaincodes&quot; function</span><br>        <span class="hljs-attr">lscc/GetInstantiatedChaincodes:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Query System Chaincode (qscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetChainInfo&quot; function</span><br>        <span class="hljs-attr">qscc/GetChainInfo:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetBlockByNumber&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByNumber:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s  &quot;GetBlockByHash&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByHash:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetTransactionByID&quot; function</span><br>        <span class="hljs-attr">qscc/GetTransactionByID:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for qscc&#x27;s &quot;GetBlockByTxID&quot; function</span><br>        <span class="hljs-attr">qscc/GetBlockByTxID:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Configuration System Chaincode (cscc) function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for cscc&#x27;s &quot;GetConfigBlock&quot; function</span><br>        <span class="hljs-attr">cscc/GetConfigBlock:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for cscc&#x27;s &quot;GetChannelConfig&quot; function</span><br>        <span class="hljs-attr">cscc/GetChannelConfig:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment">#---Miscellaneous peer function to policy mapping for access control---#</span><br><br>        <span class="hljs-comment"># ACL policy for invoking chaincodes on peer</span><br>        <span class="hljs-attr">peer/Propose:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment"># ACL policy for chaincode to chaincode invocation</span><br>        <span class="hljs-attr">peer/ChaincodeToChaincode:</span> <span class="hljs-string">/Channel/Application/Writers</span><br><br>        <span class="hljs-comment">#---Events resource to policy mapping for access control###---#</span><br><br>        <span class="hljs-comment"># ACL policy for sending block events</span><br>        <span class="hljs-attr">event/Block:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>        <span class="hljs-comment"># ACL policy for sending filtered block events</span><br>        <span class="hljs-attr">event/FilteredBlock:</span> <span class="hljs-string">/Channel/Application/Readers</span><br><br>    <span class="hljs-comment"># Organizations lists the orgs participating on the application side of the</span><br>    <span class="hljs-comment"># network.</span><br>    <span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Application policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/Application/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span> <span class="hljs-meta">&amp;ApplicationDefaultPolicies</span><br>        <span class="hljs-attr">LifecycleEndorsement:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Endorsement&quot;</span><br>        <span class="hljs-attr">Endorsement:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Endorsement&quot;</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br><br>    <span class="hljs-comment"># Capabilities describes the application level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   ORDERER</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for orderer related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Orderer:</span> <span class="hljs-meta">&amp;OrdererDefaults</span><br><br>    <span class="hljs-comment"># Orderer Type: The orderer implementation to start.</span><br>    <span class="hljs-comment"># Available types are &quot;solo&quot;, &quot;kafka&quot; and &quot;etcdraft&quot;.</span><br>    <span class="hljs-attr">OrdererType:</span> <span class="hljs-string">etcdraft</span><br><br>    <span class="hljs-comment"># Addresses used to be the list of orderer addresses that clients and peers</span><br>    <span class="hljs-comment"># could connect to.  However, this does not allow clients to associate orderer</span><br>    <span class="hljs-comment"># addresses and orderer organizations which can be useful for things such</span><br>    <span class="hljs-comment"># as TLS validation.  The preferred way to specify orderer addresses is now</span><br>    <span class="hljs-comment"># to include the OrdererEndpoints item in your org definition</span><br>    <span class="hljs-attr">Addresses:</span><br>        <span class="hljs-comment"># - 127.0.0.1:7050</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer0.example.com:7050&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer1.example.com:8050&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;orderer2.example.com:9050&quot;</span><br><br>    <span class="hljs-comment"># Batch Timeout: The amount of time to wait before creating a batch.</span><br>    <span class="hljs-attr">BatchTimeout:</span> <span class="hljs-string">2s</span><br><br>    <span class="hljs-comment"># Batch Size: Controls the number of messages batched into a block.</span><br>    <span class="hljs-comment"># The orderer views messages opaquely, but typically, messages may</span><br>    <span class="hljs-comment"># be considered to be Fabric transactions.  The &#x27;batch&#x27; is the group</span><br>    <span class="hljs-comment"># of messages in the &#x27;data&#x27; field of the block.  Blocks will be a few kb</span><br>    <span class="hljs-comment"># larger than the batch size, when signatures, hashes, and other metadata</span><br>    <span class="hljs-comment"># is applied.</span><br>    <span class="hljs-attr">BatchSize:</span><br><br>        <span class="hljs-comment"># Max Message Count: The maximum number of messages to permit in a</span><br>        <span class="hljs-comment"># batch.  No block will contain more than this number of messages.</span><br>        <span class="hljs-attr">MaxMessageCount:</span> <span class="hljs-number">500</span><br><br>        <span class="hljs-comment"># Absolute Max Bytes: The absolute maximum number of bytes allowed for</span><br>        <span class="hljs-comment"># the serialized messages in a batch. The maximum block size is this value</span><br>        <span class="hljs-comment"># plus the size of the associated metadata (usually a few KB depending</span><br>        <span class="hljs-comment"># upon the size of the signing identities). Any transaction larger than</span><br>        <span class="hljs-comment"># this value will be rejected by ordering.</span><br>        <span class="hljs-comment"># It is recommended not to exceed 49 MB, given the default grpc max message size of 100 MB</span><br>        <span class="hljs-comment"># configured on orderer and peer nodes (and allowing for message expansion during communication).</span><br>        <span class="hljs-attr">AbsoluteMaxBytes:</span> <span class="hljs-number">10</span> <span class="hljs-string">MB</span><br><br>        <span class="hljs-comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed</span><br>        <span class="hljs-comment"># for the serialized messages in a batch. Roughly, this field may be considered</span><br>        <span class="hljs-comment"># the best effort maximum size of a batch. A batch will fill with messages</span><br>        <span class="hljs-comment"># until this size is reached (or the max message count, or batch timeout is</span><br>        <span class="hljs-comment"># exceeded).  If adding a new message to the batch would cause the batch to</span><br>        <span class="hljs-comment"># exceed the preferred max bytes, then the current batch is closed and written</span><br>        <span class="hljs-comment"># to a block, and a new batch containing the new message is created.  If a</span><br>        <span class="hljs-comment"># message larger than the preferred max bytes is received, then its batch</span><br>        <span class="hljs-comment"># will contain only that message.  Because messages may be larger than</span><br>        <span class="hljs-comment"># preferred max bytes (up to AbsoluteMaxBytes), some batches may exceed</span><br>        <span class="hljs-comment"># the preferred max bytes, but will always contain exactly one transaction.</span><br>        <span class="hljs-attr">PreferredMaxBytes:</span> <span class="hljs-number">2</span> <span class="hljs-string">MB</span><br><br>    <span class="hljs-comment"># Max Channels is the maximum number of channels to allow on the ordering</span><br>    <span class="hljs-comment"># network. When set to 0, this implies no maximum number of channels.</span><br>    <span class="hljs-attr">MaxChannels:</span> <span class="hljs-number">0</span><br><br>    <span class="hljs-attr">Kafka:</span><br>        <span class="hljs-comment"># Brokers: A list of Kafka brokers to which the orderer connects. Edit</span><br>        <span class="hljs-comment"># this list to identify the brokers of the ordering service.</span><br>        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Use IP:port notation.</span><br>        <span class="hljs-attr">Brokers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka0:9092</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka1:9092</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">kafka2:9092</span><br><br>    <span class="hljs-comment"># EtcdRaft defines configuration which must be set when the &quot;etcdraft&quot;</span><br>    <span class="hljs-comment"># orderertype is chosen.</span><br>    <span class="hljs-attr">EtcdRaft:</span><br>        <span class="hljs-comment"># The set of Raft replicas for this network. For the etcd/raft-based</span><br>        <span class="hljs-comment"># implementation, we expect every replica to also be an OSN. Therefore,</span><br>        <span class="hljs-comment"># a subset of the host:port items enumerated in this list should be</span><br>        <span class="hljs-comment"># replicated under the Orderer.Addresses key above.</span><br>        <span class="hljs-attr">Consenters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer0.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">7050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer1.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">8050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">Host:</span> <span class="hljs-string">orderer2.example.com</span><br>              <span class="hljs-attr">Port:</span> <span class="hljs-number">9050</span><br>              <span class="hljs-attr">ClientTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br>              <span class="hljs-attr">ServerTLSCert:</span> <span class="hljs-string">/home/moindy/project/test-network/crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><br>        <span class="hljs-comment"># Options to be specified for all the etcd/raft nodes. The values here</span><br>        <span class="hljs-comment"># are the defaults for all new channels and can be modified on a</span><br>        <span class="hljs-comment"># per-channel basis via configuration updates.</span><br>        <span class="hljs-attr">Options:</span><br>            <span class="hljs-comment"># TickInterval is the time interval between two Node.Tick invocations.</span><br>            <span class="hljs-attr">TickInterval:</span> <span class="hljs-string">500ms</span><br><br>            <span class="hljs-comment"># ElectionTick is the number of Node.Tick invocations that must pass</span><br>            <span class="hljs-comment"># between elections. That is, if a follower does not receive any</span><br>            <span class="hljs-comment"># message from the leader of current term before ElectionTick has</span><br>            <span class="hljs-comment"># elapsed, it will become candidate and start an election.</span><br>            <span class="hljs-comment"># ElectionTick must be greater than HeartbeatTick.</span><br>            <span class="hljs-attr">ElectionTick:</span> <span class="hljs-number">10</span><br><br>            <span class="hljs-comment"># HeartbeatTick is the number of Node.Tick invocations that must</span><br>            <span class="hljs-comment"># pass between heartbeats. That is, a leader sends heartbeat</span><br>            <span class="hljs-comment"># messages to maintain its leadership every HeartbeatTick ticks.</span><br>            <span class="hljs-attr">HeartbeatTick:</span> <span class="hljs-number">1</span><br><br>            <span class="hljs-comment"># MaxInflightBlocks limits the max number of in-flight append messages</span><br>            <span class="hljs-comment"># during optimistic replication phase.</span><br>            <span class="hljs-attr">MaxInflightBlocks:</span> <span class="hljs-number">5</span><br><br>            <span class="hljs-comment"># SnapshotIntervalSize defines number of bytes per which a snapshot is taken</span><br>            <span class="hljs-attr">SnapshotIntervalSize:</span> <span class="hljs-number">16</span> <span class="hljs-string">MB</span><br><br>    <span class="hljs-comment"># Organizations lists the orgs participating on the orderer side of the</span><br>    <span class="hljs-comment"># network.</span><br>    <span class="hljs-attr">Organizations:</span><br><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Orderer policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/Orderer/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br>        <span class="hljs-comment"># BlockValidation specifies what signatures must be included in the block</span><br>        <span class="hljs-comment"># from the orderer for the peer to validate it.</span><br>        <span class="hljs-attr">BlockValidation:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br><br>    <span class="hljs-comment"># Capabilities describes the orderer level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   CHANNEL</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   This section defines the values to encode into a config transaction or</span><br><span class="hljs-comment">#   genesis block for channel related parameters.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Channel:</span> <span class="hljs-meta">&amp;ChannelDefaults</span><br>    <span class="hljs-comment"># Policies defines the set of policies at this level of the config tree</span><br>    <span class="hljs-comment"># For Channel policies, their canonical path is</span><br>    <span class="hljs-comment">#   /Channel/&lt;PolicyName&gt;</span><br>    <span class="hljs-attr">Policies:</span><br>        <span class="hljs-comment"># Who may invoke the &#x27;Deliver&#x27; API</span><br>        <span class="hljs-attr">Readers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Readers&quot;</span><br>        <span class="hljs-comment"># Who may invoke the &#x27;Broadcast&#x27; API</span><br>        <span class="hljs-attr">Writers:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;ANY Writers&quot;</span><br>        <span class="hljs-comment"># By default, who may modify elements at this config level</span><br>        <span class="hljs-attr">Admins:</span><br>            <span class="hljs-attr">Type:</span> <span class="hljs-string">ImplicitMeta</span><br>            <span class="hljs-attr">Rule:</span> <span class="hljs-string">&quot;MAJORITY Admins&quot;</span><br><br><br>    <span class="hljs-comment"># Capabilities describes the channel level capabilities, see the</span><br>    <span class="hljs-comment"># dedicated Capabilities section elsewhere in this file for a full</span><br>    <span class="hljs-comment"># description</span><br>    <span class="hljs-attr">Capabilities:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelCapabilities</span><br><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   PROFILES</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   Different configuration profiles may be encoded here to be specified as</span><br><span class="hljs-comment">#   parameters to the configtxgen tool. The profiles which specify consortiums</span><br><span class="hljs-comment">#   are to be used for generating the orderer genesis block. With the correct</span><br><span class="hljs-comment">#   consortium members defined in the orderer genesis block, channel creation</span><br><span class="hljs-comment">#   requests may be generated with only the org member names and a consortium</span><br><span class="hljs-comment">#   name.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">################################################################################</span><br><span class="hljs-attr">Profiles:</span><br><br>    <span class="hljs-attr">TwoOrgsOrdererGenesis:</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelDefaults</span><br>        <span class="hljs-attr">Orderer:</span><br>            <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererDefaults</span><br>            <span class="hljs-attr">Organizations:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*OrdererOrg</span><br>            <span class="hljs-attr">Capabilities:</span><br>                <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*OrdererCapabilities</span><br>        <span class="hljs-attr">Consortiums:</span><br>            <span class="hljs-attr">SampleConsortium:</span><br>                <span class="hljs-attr">Organizations:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org1</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org2</span><br><br>    <span class="hljs-attr">TwoOrgsChannel:</span><br>        <span class="hljs-attr">Consortium:</span> <span class="hljs-string">SampleConsortium</span><br>        <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ChannelDefaults</span><br>        <span class="hljs-attr">Application:</span><br>            <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationDefaults</span><br>            <span class="hljs-attr">Organizations:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org1</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-meta">*Org2</span><br>            <span class="hljs-attr">Capabilities:</span><br>                <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*ApplicationCapabilities</span><br></code></pre></td></tr></table></figure>

<p>生成创世区块</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsOrdererGenesis -channelID fabric-channel -outputBlock ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block<br></code></pre></td></tr></table></figure>

<p>生成通道文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel  -channelID businesschannel -outputCreateChannelTx ..<span class="hljs-regexp">/channel-artifacts/</span>businesschannel.tx<br></code></pre></td></tr></table></figure>

<p>生成锚节点配置更新文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel -channelID businesschannel -asOrg Org1MSP -outputAnchorPeersUpdate ..<span class="hljs-regexp">/channel-artifacts/</span>Org1MSPanchors.tx<br><br>.<span class="hljs-regexp">/configtxgen -configPath ../</span>config  -profile TwoOrgsChannel -channelID businesschannel -asOrg Org2MSP -outputAnchorPeersUpdate ..<span class="hljs-regexp">/channel-artifacts/</span>Org2MSPanchors.tx<br></code></pre></td></tr></table></figure>

<h3 id="部署orderer节点"><a href="#部署orderer节点" class="headerlink" title="部署orderer节点"></a>部署orderer节点</h3><p>参考 <a target="_blank" rel="noopener" href="https://github.com/yeasy/docker-compose-files/tree/master/hyperledger_fabri">docker-compose 文件</a></p>
<p>docker-compose-orderer.yaml（根据自己环境修改参数）</p>
<ul>
<li>extra_hosts</li>
<li>volumes</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><code class="hljs gradle">version: <span class="hljs-string">&#x27;2.0&#x27;</span><br><br>services:<br><br>    cli:<br>        image: hyperledger/fabric-tools:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: fabric-cli<br>        hostname: fabric-cli<br>        tty: <span class="hljs-keyword">true</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - CORE_PEER_ID=fabric-cli<br>            - CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span> # <span class="hljs-keyword">default</span> to operate on peer0.org1<br>            - CORE_PEER_LOCALMSPID=Org1MSP<br>            - CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>server.crt<br>            - CORE_PEER_TLS_KEY_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>server.key<br>            - CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>            - CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>            - FABRIC_LOGGING_FORMAT=%&#123;color&#125;[%&#123;id:<span class="hljs-number">03</span>x&#125; %&#123;time:<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">15</span>:<span class="hljs-number">04</span>:<span class="hljs-number">05.00</span> MST&#125;] [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.<span class="hljs-number">4</span>s&#125;%&#123;color:reset&#125; %&#123;message&#125;<br>            - CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span>  # to enable TLS, change to <span class="hljs-keyword">true</span><br>            - ORDERER_CA=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br>        volumes:<br>            - ..<span class="hljs-regexp">/config/</span>crypto-config.yaml:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config.yaml<br>            - ..<span class="hljs-regexp">/config/</span>configtx.yaml:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>configtx.yaml<br>            - ..<span class="hljs-regexp">/crypto-config:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/crypto-config<br>            - ..<span class="hljs-regexp">/channel-artifacts:/</span>tmp/channel-<span class="hljs-keyword">artifacts</span><br>            - ..<span class="hljs-regexp">/chaincodes:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/chaincodes<br>        working_dir: <span class="hljs-regexp">/opt/g</span>opath<span class="hljs-regexp">/src/gi</span>thub.com<span class="hljs-regexp">/hyperledger/</span>fabric/peer<br>        command: bash -c <span class="hljs-string">&#x27;cd /tmp; source scripts/func.sh; while true; do sleep 20170504; done&#x27;</span><br><br><br>    orderer0.example.com:  # There can be multiple orderers<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer0.example.com<br>        hostname: orderer0.example.com<br>        ports:<br>            - <span class="hljs-number">7050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8443</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        expose:<br>            - <span class="hljs-string">&quot;7050&quot;</span>  # gRPC<br>            - <span class="hljs-string">&quot;8443&quot;</span>  # Operation REST<br>        command: orderer start<br><br>    orderer1.example.com:<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer1.example.com<br>        hostname: orderer1.example.com<br>        ports:<br>            - <span class="hljs-number">8050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8444</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_SPEC=DEBUG<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=<span class="hljs-number">10</span><br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer1.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer1.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        command: orderer start    <br><br><br>    orderer2.example.com:<br>        image: hyperledger/fabric-orderer:<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span><br>        restart: always<br>        container_name: orderer2.example.com<br>        hostname: orderer2.example.com<br>        ports:<br>            - <span class="hljs-number">9050</span>:<span class="hljs-number">7050</span><br>            - <span class="hljs-number">8445</span>:<span class="hljs-number">8443</span><br>        extra_hosts:<br>            - <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span><br>            - <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span><br>        environment:<br>            - FABRIC_LOGGING_SPEC=DEBUG  # <span class="hljs-keyword">default</span>: INFO<br>            - FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span><br>            - ORDERER_GENERAL_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> # <span class="hljs-keyword">default</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>            - ORDERER_GENERAL_LISTENPORT=<span class="hljs-number">7050</span><br>            - ORDERER_GENERAL_GENESISMETHOD=<span class="hljs-keyword">file</span> # <span class="hljs-keyword">default</span>: provisional<br>            - ORDERER_GENERAL_BOOTSTRAPFILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block # by <span class="hljs-keyword">default</span>, all materials should be put under $FABRIC_CFG_PATH, which defaults to <span class="hljs-regexp">/etc/</span>hyperledger/fabric<br>            - ORDERER_GENERAL_LOCALMSPID=OrdererMSP # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">DEFAULT</span><br>            - ORDERER_GENERAL_LOCALMSPDIR=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ORDERER_GENERAL_LEDGERTYPE=<span class="hljs-keyword">file</span><br>            #- ORDERER_GENERAL_LEDGERTYPE=json  # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">file</span><br>            - ORDERER_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8443</span>  # operation RESTful API<br>            - ORDERER_METRICS_PROVIDER=prometheus  # prometheus will pull metrics <span class="hljs-keyword">from</span> orderer via /metrics RESTful API<br>            #- ORDERER_RAMLEDGER_HISTORY_SIZE=<span class="hljs-number">100</span>  #only useful when use ram ledger<br>            # enabled TLS<br>            - ORDERER_GENERAL_TLS_ENABLED=<span class="hljs-keyword">true</span> # <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span><br>            - ORDERER_GENERAL_TLS_PRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_TLS_CERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_TLS_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            # Only required by raft mode<br>            - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.key<br>            - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/server.crt<br>            - ORDERER_GENERAL_CLUSTER_ROOTCAS=[<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>tls/ca.crt]<br>            - ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=<span class="hljs-number">10</span><br>        volumes:<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer2.example.com/m</span>sp:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/m</span>sp<br>            - ..<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer2.example.com/</span>tls<span class="hljs-regexp">/:/</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric/tls<br>            - ..<span class="hljs-regexp">/channel-artifacts/</span>orderer.genesis.block:<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>orderer.genesis.block<br>        command: orderer start<br></code></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#启动服务</span><br>docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span><span class="hljs-literal">-orderer</span>.yaml up <span class="hljs-literal">-d</span><br><span class="hljs-comment">#停止服务并删除生成的文件</span><br>docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span><span class="hljs-literal">-3orderer</span>.yaml down <span class="hljs-literal">-v</span><br></code></pre></td></tr></table></figure>

<h3 id="部署org1-peer0节点"><a href="#部署org1-peer0节点" class="headerlink" title="部署org1-peer0节点"></a>部署org1-peer0节点</h3><p>docker-compose-org1-peer.yaml文件</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs haml">version: &#x27;2.0&#x27;<br><br>services:<br><br>    peer0.org1.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer0.org1.example.com<br>        hostname: peer0.org1.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9443</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer0.org1.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer0.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;7051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9443&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org1.couchdb</span><br><span class="ruby"></span><br>    peer1.org1.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer1.org1.example.com<br>        hostname: peer1.org1.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">8051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">8052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9444</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer1.org1.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">8052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">8051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer1.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;8051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;8052&quot;</span>  <span class="hljs-comment"># chaincode</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9444&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org1.couchdb</span><br><span class="ruby"></span>                    <br>    peer0.org1.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer0.org1.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">5984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br><span class="ruby"></span><br>    peer1.org1.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer1.org1.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">6984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#启动peer节点</span><br><span class="hljs-attribute">docker</span>-compose -f docker-compose-org<span class="hljs-number">1</span>-peer.yaml up -d<br></code></pre></td></tr></table></figure>

<h3 id="启动org2-peer节点"><a href="#启动org2-peer节点" class="headerlink" title="启动org2-peer节点"></a>启动org2-peer节点</h3><p>org2-peer节点docker配置文件</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs haml"><br>version: &#x27;2.0&#x27;<br><br>services:<br><br>    peer0.org2.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer0.org2.example.com<br>        hostname: peer0.org2.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">9051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9445</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer0.org2.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">9051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer0.org1.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;9051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9445&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer0.org2.couchdb</span><br><span class="ruby"></span><br><br>    peer1.org2.example.com:<br>        image: hyperledger/fabric-peer:2.4.1<br>        restart: always<br>        container_name: peer1.org2.example.com<br>        hostname: peer1.org2.example.com<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">10051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">10052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-number">9446</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span></span><br><span class="ruby"></span>        extra_hosts:<br>            -<span class="ruby"> <span class="hljs-string">&quot;orderer0.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;orderer2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org1.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer0.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;peer1.org2.example.com:192.168.177.128&quot;</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> FABRIC_LOGGING_SPEC=INFO</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_FORMAT=<span class="hljs-string">&quot;%&#123;color&#125;%&#123;time:2006-01-02 15:04:05.000 MST&#125; [%&#123;module&#125;] %&#123;shortfunc&#125; -&gt; %&#123;level:.4s&#125; %&#123;id:03x&#125;%&#123;color:reset&#125; %&#123;message&#125;&quot;</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESSAUTODETECT=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="hljs-comment"># uncomment this to use specific network</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_USELEADERELECTION=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_ORGLEADER=<span class="hljs-literal">false</span>  <span class="hljs-comment"># whether this node is the org leader, default to false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_OPERATIONS_LISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">9443</span>  <span class="hljs-comment"># operation RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_METRICS_PROVIDER=prometheus  <span class="hljs-comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_PROFILE_ENABLED=<span class="hljs-literal">false</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ENABLED=<span class="hljs-literal">true</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_CERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_PEER_TLS_KEY_FILE=/etc</span><span class="hljs-regexp">/hyperledger/fabric</span><span class="hljs-regexp">/tls/server</span>.key</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>            -<span class="ruby"><span class="hljs-regexp"> CORE_CHAINCODE_BUILDER=hyperledger/fabric</span>-<span class="hljs-symbol">ccenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">baseos:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">javaenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric-<span class="hljs-symbol">nodeenv:</span><span class="hljs-number">2.4</span>.<span class="hljs-number">1</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ID=peer1.org2.example.com</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_ADDRESS=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODELISTENADDRESS=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_CHAINCODEADDRESS=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10052</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">10051</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="ruby"></span>            -<span class="ruby"> FABRIC_LOGGING_SPEC=DEBUG <span class="hljs-comment"># info:core.chaincode=debug</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer1.org2.<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span></span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin</span><br><span class="ruby"></span>            -<span class="ruby"> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw</span><br><span class="ruby"></span>        volumes:<br>            -<span class="ruby"> /var/run/docker.<span class="hljs-symbol">sock:</span>/var/run/docker.sock</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp</span><br><span class="ruby"></span>            -<span class="ruby"> ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls</span><br><span class="ruby"></span>        expose:<br>            -<span class="ruby"> <span class="hljs-string">&quot;10051&quot;</span>  <span class="hljs-comment"># gRPC</span></span><br><span class="ruby"></span>            -<span class="ruby"> <span class="hljs-string">&quot;9446&quot;</span>  <span class="hljs-comment"># Operation REST</span></span><br><span class="ruby"></span>        #command: bash -c &#x27;bash /tmp/peer_build.sh; peer node start&#x27;<br>        command: peer node start<br>        depends_on:<br>            -<span class="ruby"> peer1.org2.couchdb</span><br><span class="ruby"></span><br><br>    peer0.org2.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer0.org2.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">7984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br><span class="ruby"></span><br>    peer1.org2.couchdb:<br>        image: couchdb:3.1.1<br>        container_name: peer1.org2.couchdb<br>        restart: always<br>        ports:<br>            -<span class="ruby"> <span class="hljs-number">8984</span><span class="hljs-symbol">:</span><span class="hljs-number">5984</span>  <span class="hljs-comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span></span><br><span class="ruby"></span>        environment:<br>            -<span class="ruby"> COUCHDB_USER=admin</span><br><span class="ruby"></span>            -<span class="ruby"> COUCHDB_PASSWORD=adminpw</span><br></code></pre></td></tr></table></figure>

<p>其中docker在启动的时候同时会启动两个couchdb容器，通过访问<a target="_blank" rel="noopener" href="http://localhost:5984/_utils/%E5%8F%AF%E4%BB%A5%E5%88%86%E5%88%AB%E8%AE%BF%E9%97%AE%E5%88%B0%E4%B8%8D%E5%90%8Cpeer%E8%8A%82%E7%82%B9%E7%9A%84couchdb%E4%B8%AD%EF%BC%8C%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81%E5%8F%AF%E4%BB%A5%E5%9C%A8docker%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E3%80%82">http://localhost:5984/_utils/可以分别访问到不同peer节点的couchdb中，账户密码可以在docker的配置文件中自定义。</a></p>
<p>启动的容器如图所示：</p>
<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200455760.png" srcset="/img/loading.gif" lazyload alt="docker容器列表"></p>
<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407200524124.png" srcset="/img/loading.gif" lazyload alt="docker容器列表"></p>
<p>通过客户端cli server中创建通道然后加入通道在私有节点上安装链码等等</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> fabric-cli bash<br></code></pre></td></tr></table></figure>

<p>创建一个bussinesschannel通道并让四个节点都加入通道中</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">APP_CHANNEL</span>=businesschannel<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">TIMEOUT</span>=30<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=Org1MSP<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>channel create -o orderer0.example.com:7050 -c <span class="hljs-variable">$&#123;APP_CHANNEL&#125;</span> -f <span class="hljs-string">&quot;/tmp/channel-artifacts/<span class="hljs-variable">$APP_CHANNEL</span>.tx&quot;</span> --timeout <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIMEOUT&#125;</span>s&quot;</span> --tls --cafile /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201129927.png" srcset="/img/loading.gif" lazyload alt="businesschannel.block生成"></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">mv businesschannel.block <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/<br></code></pre></td></tr></table></figure>

<p>加入通道</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker exec -it fabric-cli bash<br>#org1-peer0节点<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br><br>#org1-peer1节点<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer1.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer1.org1.example.com:<span class="hljs-number">8051</span><br><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201530947.png" srcset="/img/loading.gif" lazyload alt="加入通道结果图1"></p>
<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201548190.png" srcset="/img/loading.gif" lazyload alt="加入通道结果图2"></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#org2-peer0加入通道<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">9051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201853548.png" srcset="/img/loading.gif" lazyload alt="加入通道结果图3"></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#org2-peer1 加入通道<br>export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer1.org2.example.com:<span class="hljs-number">10051</span><br><br>peer channel <span class="hljs-keyword">join</span> -b <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span>/businesschannel.block<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407201925263.png" srcset="/img/loading.gif" lazyload alt="加入通道结果图4"></p>
<p>org1和org2的peer都加入通道中</p>
<h3 id="更新锚节点"><a href="#更新锚节点" class="headerlink" title="更新锚节点"></a>更新锚节点</h3><p>org1 更新锚节点：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer channel update -o orderer0.example.com:<span class="hljs-number">7050</span> -c businesschannel -f <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span><span class="hljs-regexp">/Org1MSPanchors.tx --tls --cafile /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure>

<p>org2 更新锚节点：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">7051</span><br><br>peer channel update -o orderer0.example.com:<span class="hljs-number">7050</span> -c businesschannel -f <span class="hljs-regexp">/tmp/</span>channel-<span class="hljs-keyword">artifacts</span><span class="hljs-regexp">/Org2MSPanchors.tx --tls --cafile /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>ordererOrganizations<span class="hljs-regexp">/example.com/</span>orderers<span class="hljs-regexp">/orderer0.example.com/m</span>sp<span class="hljs-regexp">/tlscacerts/</span>tlsca.example.com-cert.pem<br></code></pre></td></tr></table></figure>

<p>锚节点配置更新后，同一通道内不同组织之间的Peer也可以进行Gossip通信，共同维护通道账本。后续，用户可以通过智能合约使用通道账本。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">discover </span>--configFile <span class="hljs-keyword">discover_config.yaml </span>endorsers --channel <span class="hljs-keyword">businesschannel </span>--chaincode hyperledger-fabric-contruct-<span class="hljs-keyword">java-demo </span>--server peer0-<span class="hljs-keyword">org1-examplem.com:7051</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">discover </span>--configFile <span class="hljs-keyword">discover_config.yaml </span>peers --channel <span class="hljs-keyword">businesschannel </span>--server peer0-<span class="hljs-keyword">org1-examplem.com:7051</span><br></code></pre></td></tr></table></figure>



<h3 id="安装链码"><a href="#安装链码" class="headerlink" title="安装链码"></a>安装链码</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#编译打包源码<br>mvn <span class="hljs-keyword">compile</span> <span class="hljs-keyword">package</span> -DskipTests -Dmaven.test.skip=<span class="hljs-keyword">true</span><br>#打包链码包<br>peer lifecycle chaincode <span class="hljs-keyword">package</span> hyperledger-fabric-contract-java-demo.tar.gz --path <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>chaincodes/ --lang java --label hyperledger-fabric-contract-java-demo_1<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202612838.png" srcset="/img/loading.gif" lazyload alt="打包链码"></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#peer节点安装链码</span><br><span class="hljs-comment">#并不是所有peer节点都需要安装链码，如果peer节点要作为一个背书节点那么就需要安装链码包的</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer0.org1.example.com:7051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407202836601.png" srcset="/img/loading.gif" lazyload alt="安装链码"></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org1MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer1.org1.example.com:8051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br><br><br>return:<br>[020 04-07 12:29:10.75 UTC] [cli.lifecycle.chaincode] submitInstallProposal -&gt; <span class="hljs-builtin-name">INFO</span> Installed remotely: response:&lt;status:200 payload:<span class="hljs-string">&quot;\nhhyperledger-fabric-contract-java-demo_1:7b2d658f6068eb32c2cf030c42bf2df05bbdd3514a2a94cbbd33b8229849d90e\022&#x27;hyperledger-fabric-contract-java-demo_1&quot;</span> &gt; <br>[021 04-07 12:29:10.75 UTC] [cli.lifecycle.chaincode] submitInstallProposal -&gt; <span class="hljs-builtin-name">INFO</span> Chaincode code package identifier: hyperledger-fabric-contract-java-demo_1:7b2d658f6068eb32c2cf030c42bf2df05bbdd3514a2a94cbbd33b8229849d90e<br><br></code></pre></td></tr></table></figure>

<p>org2-peer0和peer1</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer0.org2.example.com:9051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-literal">true</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_LOCALMSPID</span>=<span class="hljs-string">&quot;Org2MSP&quot;</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_TLS_ROOTCERT_FILE</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_MSPCONFIGPATH</span>=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CORE_PEER_ADDRESS</span>=peer1.org2.example.com:10051<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">peer </span>lifecycle chaincode install hyperledger-fabric-contract-java-demo.tar.gz<br></code></pre></td></tr></table></figure>

<p>查询包ID：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">peer</span> lifecycle chaincode queryinstalled<br><br><span class="hljs-comment">#以peer1的身份，因为使用的是org2-peer1的环境变量</span><br><span class="hljs-attribute">Installed</span> chaincodes <span class="hljs-literal">on</span> peer:<br><span class="hljs-attribute">Package</span> ID: hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span>:<span class="hljs-number">7</span>b<span class="hljs-number">2</span>d<span class="hljs-number">658</span>f<span class="hljs-number">6068</span>eb<span class="hljs-number">32</span>c<span class="hljs-number">2</span>cf<span class="hljs-number">030</span>c<span class="hljs-number">42</span>bf<span class="hljs-number">2</span>df<span class="hljs-number">05</span>bbdd<span class="hljs-number">3514</span>a<span class="hljs-number">2</span>a<span class="hljs-number">94</span>cbbd<span class="hljs-number">33</span>b<span class="hljs-number">8229849</span>d<span class="hljs-number">90</span>e, Label: hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span><br><span class="hljs-comment">#包ID是链码标签和链码二进制文件的哈希值的组合,每个peer节点将生成相同的包ID</span><br><span class="hljs-comment">#将包ID保存为环境变量:</span><br><span class="hljs-attribute">export</span> CC_PACKAGE_ID=hyperledger-fabric-contract-java-demo_<span class="hljs-number">1</span>:<span class="hljs-number">7</span>b<span class="hljs-number">2</span>d<span class="hljs-number">658</span>f<span class="hljs-number">6068</span>eb<span class="hljs-number">32</span>c<span class="hljs-number">2</span>cf<span class="hljs-number">030</span>c<span class="hljs-number">42</span>bf<span class="hljs-number">2</span>df<span class="hljs-number">05</span>bbdd<span class="hljs-number">3514</span>a<span class="hljs-number">2</span>a<span class="hljs-number">94</span>cbbd<span class="hljs-number">33</span>b<span class="hljs-number">8229849</span>d<span class="hljs-number">90</span>e<br></code></pre></td></tr></table></figure>

<h3 id="批准链码定义"><a href="#批准链码定义" class="headerlink" title="批准链码定义"></a>批准链码定义</h3><p>org1</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org1MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/peers/</span>peer0.org1.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org1.example.com<span class="hljs-regexp">/users/</span>Admin@org1.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org1.example.com:<span class="hljs-number">7051</span><br><br>peer lifecycle chaincode approveformyorg -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --<span class="hljs-keyword">package</span>-id $CC_PACKAGE_ID --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>INFO txid [eb6daf1f194ae8b109500ca44099942e00710c6a4b83cb68109b4bddc3d7dd32] committed with status (VALID) at peer0.org1.example.com:<span class="hljs-number">7051</span><br></code></pre></td></tr></table></figure>

<p>org2</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">export CORE_PEER_TLS_ENABLED=<span class="hljs-keyword">true</span><br>export CORE_PEER_LOCALMSPID=<span class="hljs-string">&quot;Org2MSP&quot;</span><br>export CORE_PEER_TLS_ROOTCERT_FILE=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/peers/</span>peer0.org2.example.com<span class="hljs-regexp">/tls/</span>ca.crt<br>export CORE_PEER_MSPCONFIGPATH=<span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/peerOrganizations/</span>org2.example.com<span class="hljs-regexp">/users/</span>Admin@org2.example.com/msp<br>export CORE_PEER_ADDRESS=peer0.org2.example.com:<span class="hljs-number">9051</span><br><br>peer lifecycle chaincode approveformyorg -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --<span class="hljs-keyword">package</span>-id $CC_PACKAGE_ID --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>INFO txid [eb69f8cd075c20987a0138c906cdf294a237094624001fafce225f60aea970be] committed with status (VALID) at peer0.org2.example.com:<span class="hljs-number">9051</span><br></code></pre></td></tr></table></figure>

<p>检查通道</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle">peer lifecycle chaincode checkcommitreadiness --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem --output json<br><br><br><span class="hljs-keyword">return</span>:<br>&#123;<br>	<span class="hljs-string">&quot;approvals&quot;</span>: &#123;<br>		<span class="hljs-string">&quot;Org1MSP&quot;</span>: <span class="hljs-keyword">true</span>,<br>		<span class="hljs-string">&quot;Org2MSP&quot;</span>: <span class="hljs-keyword">true</span><br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>将链码提交到通道：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">peer lifecycle chaincode commit -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --channelID businesschannel --name hyperledger-fabric-contract-java-demo --version <span class="hljs-number">1.0</span> --sequence <span class="hljs-number">1</span> --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts<span class="hljs-regexp">/tlsca.example.com-cert.pem --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer0.org2.example.com/</span>tls/ca.crt<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407203900445.png" srcset="/img/loading.gif" lazyload alt="将链码提交到通道"></p>
<p>用<code>peer lifecycle chaincode querycommitted</code>命令来确认链码定义已提交给通道:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">peer lifecycle chaincode querycommitted --channelID businesschannel --name hyperledger-fabric-contract-java-demo --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts/tlsca.example.com-cert.pem<br><br><br><span class="hljs-keyword">return</span>:<br>Committed chaincode definition <span class="hljs-keyword">for</span> chaincode <span class="hljs-string">&#x27;hyperledger-fabric-contract-java-demo&#x27;</span> on channel <span class="hljs-string">&#x27;businesschannel&#x27;</span>:<br>Version: <span class="hljs-number">1.0</span>, Sequence: <span class="hljs-number">1</span>, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: <span class="hljs-keyword">true</span>, Org2MSP: <span class="hljs-keyword">true</span>]<br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407204001783.png" srcset="/img/loading.gif" lazyload alt="确认链码"></p>
<p>调用链码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 调用 createCat 函数</span><br>peer chaincode invoke -o orderer0.example.com:<span class="hljs-number">7050</span> --ordererTLSHostnameOverride orderer0.example.com --tls --cafile <span class="hljs-regexp">/etc/</span>hyperledger<span class="hljs-regexp">/fabric/</span>crypto-config<span class="hljs-regexp">/ordererOrganizations/</span>example.com<span class="hljs-regexp">/orderers/</span>orderer0.example.com<span class="hljs-regexp">/msp/</span>tlscacerts<span class="hljs-regexp">/tlsca.example.com-cert.pem -C businesschannel -n hyperledger-fabric-contract-java-demo --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org1.example.com/</span>peers<span class="hljs-regexp">/peer0.org1.example.com/</span>tls<span class="hljs-regexp">/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /</span>etc<span class="hljs-regexp">/hyperledger/</span>fabric<span class="hljs-regexp">/crypto-config/</span>peerOrganizations<span class="hljs-regexp">/org2.example.com/</span>peers<span class="hljs-regexp">/peer0.org2.example.com/</span>tls/ca.crt -c <span class="hljs-string">&#x27;&#123;&quot;function&quot;:&quot;createCat&quot;,&quot;Args&quot;:[&quot;cat-KEY&quot;,&quot;test - KEY&quot;,&quot;12&quot;, &quot;red&quot;, &quot;aaa&quot;]&#125;&#x27;</span><br><br><span class="hljs-comment"># 调用 queryCat 函数</span><br>peer chaincode query -C businesschannel -n hyperledger-fabric-contract-java-demo -c <span class="hljs-string">&#x27;&#123;&quot;Args&quot;:[&quot;queryCat&quot; , &quot;cat-KEY&quot;]&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407205722777.png" srcset="/img/loading.gif" lazyload alt="调用链码"></p>
<p>couchdb存储的信息</p>
<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210112843.png" srcset="/img/loading.gif" lazyload alt="couchdb存储"></p>
<p><img src="/2022/04/13/docker%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%BD%91%E7%BB%9C/image-20220407210136865.png" srcset="/img/loading.gif" lazyload alt="couchdb存储"></p>
<p>表明这几笔交易都已经成功执行，并且已经出块了。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/chaincode/">chaincode</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/03/%E9%85%8D%E7%BD%AEfabric%E4%B8%AD%E7%9A%84orderer%E8%8A%82%E7%82%B9%E5%92%8Cpeer%E8%8A%82%E7%82%B9/">
                        <span class="hidden-mobile">配置fabric中的orderer节点和peer节点</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
  <!--添加运行时间-->
<span id="sitetime"></span>
<script language=javascript>
	function siteTime(){
		window.setTimeout("siteTime()", 1000);
		var seconds = 1000;
		var minutes = seconds * 60;
		var hours = minutes * 60;
		var days = hours * 24;
		var years = days * 365;
		var today = new Date();
		var todayYear = today.getFullYear();
		var todayMonth = today.getMonth()+1;
		var todayDate = today.getDate();
		var todayHour = today.getHours();
		var todayMinute = today.getMinutes();
		var todaySecond = today.getSeconds();
		/* 
      Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
      year - 作为date对象的年份，为4位年份值
      month - 0-11之间的整数，做为date对象的月份
      day - 1-31之间的整数，做为date对象的天数
      hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
      minutes - 0-59之间的整数，做为date对象的分钟数
      seconds - 0-59之间的整数，做为date对象的秒数
      microseconds - 0-999之间的整数，做为date对象的毫秒数
     */
		var t1 = Date.UTC(2021,10,24,18,12,20); //北京时间2018-2-13 00:00:00
		var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
		var diff = t2-t1;
		var diffYears = Math.floor(diff/years);
		var diffDays = Math.floor((diff/days)-diffYears*365);
		var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
		var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
		var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
		document.getElementById("sitetime").innerHTML=" 本博客已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒(●'◡'●)";
	}
	siteTime();
</script>
<!--// 添加运行时间-->

<!-- 新增访客统计代码 -->
<!-- <div class="busuanzi-count">
    <script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="site-uv">
      <i class="fa fa-user"></i>
      访问量 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 次
      <span class="post-meta-divider">|</span>
    </span>
    <div class="powered-by"></div>
    <span class="site-uv">
      <i class="fa fa-eye"></i>
      总访客 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 人
    </span> -->
    <!--
    <span class="site-pv">
      <i class="fa fa-pencil"></i>
      本站博客共 <span class="post-count">{{ totalcount(site) }}</span> 字
    </span>
    -->
</div>
<!-- 新增访客统计代码 END-->
<!-- <script type="text/javascript" src="../../source/js/click.js"></script> -->
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?099cc08191e54f6c390011944cda9157";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/timeDate.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>
<script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/metowolf/Metingjs@1.2/dist/Meting.min.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
